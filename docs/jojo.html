<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-10-16 Mon 01:19 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo's programming adventure in python</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="xieyuheng" />
<link rel="stylesheet" href="css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo's programming adventure in python</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf1cc1dd">------</a></li>
<li><a href="#orgff3865d">prolog</a>
<ul>
<li><a href="#org3bad960">import</a></li>
<li><a href="#org8c2487d">utility</a>
<ul>
<li><a href="#orgf0173e6">get_signature</a></li>
<li><a href="#orgfa4123b">fun_p</a></li>
<li><a href="#orgd3fc020">method_p</a></li>
<li><a href="#orgfe623c7">class_p</a></li>
<li><a href="#org66e0e5e">Vect</a></li>
<li><a href="#orga95de3d">vect_p</a></li>
<li><a href="#org90bdf72">string_p</a></li>
<li><a href="#org90f58be">fill_vect</a></li>
<li><a href="#org2822f94">fill_tuple</a></li>
</ul>
</li>
<li><a href="#org1f7bff6">error handling</a>
<ul>
<li><a href="#orgee8f535">JOJO_ERROR</a></li>
<li><a href="#org71388ca">error</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1beb52d">------</a></li>
<li><a href="#orgca34bb4">vm</a>
<ul>
<li><a href="#org6978930">RP</a></li>
<li><a href="#orgb9bf570">VM</a></li>
<li><a href="#org908d780">VALUES</a></li>
<li><a href="#orgf4fbc7b">push_result_to_vm</a></li>
<li><a href="#orge8e10a9">exe_one_step</a></li>
<li><a href="#org38db44">exe_jo</a></li>
<li><a href="#orge90ee8c">exe_fun</a>
<ul>
<li><a href="#org9af7e2"><span class="todo _note_">[note]</span> python funtion arguments</a></li>
<li><a href="#org795c6aa">exe_fun</a></li>
<li><a href="#org12cd317">get_positional_para_length</a></li>
<li><a href="#org35cf398">has_para_vect</a></li>
<li><a href="#org5777604">has_para_dict</a></li>
<li><a href="#orgf37cc37">get_default_arg_dict</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgefade50">jo</a>
<ul>
<li><a href="#org83c51dc">top level</a>
<ul>
<li><a href="#org2859586">JOJO</a></li>
</ul>
</li>
<li><a href="#org43599f4">closure</a>
<ul>
<li><a href="#orgdcb008d">CLO</a></li>
<li><a href="#org9c2b7b3">APPLY</a></li>
</ul>
</li>
<li><a href="#orgd3d51c">branching</a>
<ul>
<li><a href="#orgda7c4fc">IFTE</a></li>
</ul>
</li>
<li><a href="#orgebea46f">CALL &#x2013; call a name from a module</a></li>
<li><a href="#orgc0f068c">local variable</a>
<ul>
<li><a href="#org20a9d0d">GET</a></li>
<li><a href="#org8c0cc62">SET</a></li>
</ul>
</li>
<li><a href="#org88dc448">mark and collect</a>
<ul>
<li><a href="#org910395f">MARK &#x2013; for collectors</a></li>
<li><a href="#org891c580">COLLECT_VECT &#x2013; collect values before mark to vect</a></li>
<li><a href="#org49e24e">VECT_SPREAD &#x2013; spread values to data stack</a></li>
<li><a href="#org421cb7">COLLECT_LIST &#x2013; collect values before mark to list</a></li>
<li><a href="#orgf6f2fad">LIST_SPREAD &#x2013; spread values to data stack</a></li>
</ul>
</li>
<li><a href="#orgd676ee6">data</a>
<ul>
<li><a href="#org4881ea">DATA_PRED &#x2013; for data predicate</a></li>
</ul>
</li>
<li><a href="#org80eb765">NEW &#x2013; create object from data and class</a></li>
<li><a href="#orgb9253e4">MSG &#x2013; message to object</a></li>
<li><a href="#org21a2ba0">GENE</a></li>
</ul>
</li>
<li><a href="#org896363a">------</a></li>
<li><a href="#org25ad138">scan &#x2013; lexer for sexp</a>
<ul>
<li><a href="#orgdf93815">scan_string_vect</a></li>
<li><a href="#org894f3b">find_end</a></li>
<li><a href="#orgdcb009f">space_p</a></li>
<li><a href="#org569d1b">delimiter_p</a></li>
<li><a href="#orgd9bf4b5">doublequote_p</a></li>
</ul>
</li>
<li><a href="#orgd6d4535">null &amp; cons</a>
<ul>
<li><a href="#orgf6df0ce">Null</a></li>
<li><a href="#orgd915231">null</a></li>
<li><a href="#org484b263">null_p</a></li>
<li><a href="#org3e52851">Cons</a></li>
<li><a href="#org6efac3d">cons</a></li>
<li><a href="#orga7fa478">cons_p</a></li>
<li><a href="#org85e1a6c">cdr</a></li>
<li><a href="#org1e88db0">car</a></li>
</ul>
</li>
<li><a href="#orgeed437d">sexp &#x2013; string expression</a>
<ul>
<li><a href="#orgd0af1da"><span class="todo _note_">[note]</span> syntax sugar</a></li>
<li><a href="#org95e8607">parse_sexp_vect &#x2013; string vect to sexp vect</a></li>
<li><a href="#org283b6ce">parse_sexp</a></li>
<li><a href="#org128df39">parse_sexp_cons_until_ket</a></li>
<li><a href="#org8cd47bd">p_print</a></li>
<li><a href="#org153c7e1">sexp_print</a></li>
<li><a href="#orga028fee">sexp_list_print</a></li>
</ul>
</li>
<li><a href="#org1636fa9"><span class="todo _note_">[note]</span> syntax</a>
<ul>
<li><a href="#org6146c9f">top level</a></li>
<li><a href="#orgef96153">control</a></li>
<li><a href="#org848dc69">sexp quote</a></li>
<li><a href="#org2c47c93">data</a></li>
<li><a href="#org6b29826">key jo</a></li>
<li><a href="#orgf48bffd">jo pattern</a></li>
</ul>
</li>
<li><a href="#org92b441">compiler</a>
<ul>
<li><a href="#org9bfb56b">new_module</a></li>
<li><a href="#org18b4801">filter_name_vect</a></li>
<li><a href="#orgabfcc2f">get_jojo_name_vect</a></li>
<li><a href="#orgd31bb7a">get_data_name_vect</a></li>
<li><a href="#org4dd17b0">jojo_define</a></li>
<li><a href="#org5605ae2">merge_prim_dict</a></li>
<li><a href="#org8a79343">merge_module</a></li>
<li><a href="#org8f6072a">merge_sexp_vect</a></li>
<li><a href="#orgdd216ea">compile_module</a></li>
<li><a href="#org1f9dfcc">compile_core_module</a></li>
<li><a href="#org799626b">sexp_list_emit</a></li>
<li><a href="#orgb25ab10">sexp_emit</a></li>
<li><a href="#orgb9f9373">null_emit</a></li>
<li><a href="#org5cf2ece">cons_emit</a></li>
<li><a href="#orgba2401d">string_emit</a></li>
<li><a href="#orgc30cd1">sexp_value</a></li>
</ul>
</li>
<li><a href="#org12b18ce">------</a></li>
<li><a href="#org34173c9">string_emitter_vect</a>
<ul>
<li><a href="#org3d667ba">string_emitter_vect</a></li>
<li><a href="#org6462d76">string_emitter</a></li>
<li><a href="#orgb8b21ef">int_string</a>
<ul>
<li><a href="#org7be67f1">int_string_p</a></li>
<li><a href="#orgaf8c056">nat_string_p</a></li>
<li><a href="#orge87d740">int_string_emitter</a></li>
<li><a href="#org5ff4b0e">record</a></li>
</ul>
</li>
<li><a href="#org1701180">doublequoted_string</a>
<ul>
<li><a href="#org5df43cc">doublequoted_string_p</a></li>
<li><a href="#orgfa42e08">doublequoted_string_emitter</a></li>
<li><a href="#org4fd87ac">record</a></li>
</ul>
</li>
<li><a href="#org9402e67">local_string</a>
<ul>
<li><a href="#org94ba7c1">local_string_p</a></li>
<li><a href="#org48721a6">local_string_emitter</a></li>
<li><a href="#orgf29cd2c">record</a></li>
</ul>
</li>
<li><a href="#org4cc4a0f">set_local_string</a>
<ul>
<li><a href="#orgcd8b35a">set_local_string_p</a></li>
<li><a href="#orga1e1f46">set_local_string_emitter</a></li>
<li><a href="#org1513126">record</a></li>
</ul>
</li>
<li><a href="#org3cda488">message_string</a>
<ul>
<li><a href="#orgdf94d59">message_string_p</a></li>
<li><a href="#orgbac90e8">message_string_emitter</a></li>
<li><a href="#orgf14bee7">record</a></li>
</ul>
</li>
<li><a href="#org71e5066">name_message_string</a>
<ul>
<li><a href="#orgd16b08d">name_message_string_p</a></li>
<li><a href="#org86143d2">name_message_string_emitter</a></li>
<li><a href="#orgf1fca59">record</a></li>
</ul>
</li>
<li><a href="#org239b552">local_message_string</a>
<ul>
<li><a href="#org1e1617c">local_message_string_p</a></li>
<li><a href="#org94b8a3b">local_message_string_emitter</a></li>
<li><a href="#orgb8f6e52">record</a></li>
</ul>
</li>
<li><a href="#org4641de">message_message_string</a>
<ul>
<li><a href="#org834ef4c">message_message_string_p</a></li>
<li><a href="#org5cb593">message_message_string_emitter</a></li>
<li><a href="#orgfb8893a">record</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdf18651">prim_dict</a>
<ul>
<li><a href="#org6357587">prim_dict</a></li>
<li><a href="#org560419f">@prim</a></li>
</ul>
</li>
<li><a href="#org140e195">------</a></li>
<li><a href="#org7592308"><b>stack operation</b></a></li>
<li><a href="#org334757f"><b>int</b></a>
<ul>
<li><a href="#org625136c">Int</a></li>
<li><a href="#org620d6a3">int_p</a></li>
<li><a href="#org62a3cb">primary school</a></li>
<li><a href="#orgc3d968">compare</a>
<ul>
<li><a href="#org11d8b38">lt_p &#x2013; less then</a></li>
<li><a href="#org1bbc66">gt_p &#x2013; greater then</a></li>
<li><a href="#orgbac4d7d">lteq_p &#x2013; less then or equal to</a></li>
<li><a href="#orgd0a3f9b">gteq_p &#x2013; greater then or equal to</a></li>
</ul>
</li>
<li><a href="#org5c03454">int_print</a></li>
</ul>
</li>
<li><a href="#orgc871e98"><b>bool</b></a>
<ul>
<li><a href="#orgbdfac3f">Bool</a></li>
<li><a href="#org2d36d2e">basic</a></li>
</ul>
</li>
<li><a href="#org3e293ae"><b>equivalence</b></a></li>
<li><a href="#orgf713c49"><b>sexp</b></a></li>
<li><a href="#org6cb1777"><b>string</b></a>
<ul>
<li><a href="#orga34ff4a">String</a></li>
<li><a href="#orgde6a276">string_p</a></li>
<li><a href="#orgfadec5">string_print</a></li>
<li><a href="#org2a87c7b">string_length</a></li>
<li><a href="#org2ee043d">string_ref</a></li>
<li><a href="#orgc6e00fc">string_append</a></li>
<li><a href="#orga83c320">string_slice</a></li>
<li><a href="#org61e51">string_empty_p</a></li>
<li><a href="#org9c7e2fe">string_eq_p</a></li>
<li><a href="#org8c4762f">string_to_int</a></li>
<li><a href="#orge46e883">string predicates</a></li>
</ul>
</li>
<li><a href="#orgc3f345c"><b>vect</b></a>
<ul>
<li><a href="#orge4dd4ae"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org7ff54e5">vect_p</a></li>
<li><a href="#orgeb88ba8">vect_copy</a></li>
<li><a href="#orgf373d67">vect_member_p</a></li>
<li><a href="#orgedc1142">vect_to_sexp</a></li>
<li><a href="#org9420999">vect_length</a></li>
<li><a href="#org252f302">vect_ref</a></li>
<li><a href="#org43504c4">vect_append &#x2013; no-side-effect</a></li>
</ul>
</li>
<li><a href="#orgc774244"><b>list</b></a>
<ul>
<li><a href="#org8761c50">Null &amp; Cons</a></li>
<li><a href="#orgbb11826">list_p</a></li>
<li><a href="#org2230774">vect_to_list</a></li>
<li><a href="#orgc0a1407">list_to_vect</a></li>
<li><a href="#org422e601">list_length</a></li>
<li><a href="#org90847e6">list_ref</a></li>
<li><a href="#orgb49a82e">list_append</a></li>
<li><a href="#orgd5ea6d5">tail_cons</a></li>
</ul>
</li>
<li><a href="#org56e2fe7"><b>dict</b></a>
<ul>
<li><a href="#org3b95ca9">Dict</a></li>
<li><a href="#org37ef3a">dict_p</a></li>
<li><a href="#orgd0fc63b">dict_copy</a></li>
<li><a href="#orgafba338">vect_to_dict</a></li>
<li><a href="#orgf7b5471">dict_length</a></li>
<li><a href="#org3782057">dict_find</a></li>
<li><a href="#org3859a0d">dict_update &#x2013; no-side-effect</a></li>
<li><a href="#orgc2cd528">dict_delete &#x2013; no-side-effect</a></li>
</ul>
</li>
<li><a href="#orge9f7c5c"><b>tuple</b></a>
<ul>
<li><a href="#org86e4860">Tuple</a></li>
<li><a href="#org8fe0d0b">tuple_p</a></li>
<li><a href="#org2ac8b64">vect_to_tuple</a></li>
<li><a href="#orgebf9978">tuple_to_vect</a></li>
<li><a href="#org4b4c510">tuple_length</a></li>
<li><a href="#orgeacbb24">tuple_ref</a></li>
<li><a href="#orgaba58ce">tuple_append</a></li>
</ul>
</li>
<li><a href="#orgf2740e4"><b>set</b></a>
<ul>
<li><a href="#org791e31d">Set</a></li>
<li><a href="#org7269592">set_p</a></li>
<li><a href="#org6eb173c">vect_to_set</a></li>
<li><a href="#org63fbe18">set_to_vect</a></li>
<li><a href="#org38f210b">set_length</a></li>
<li><a href="#org8ab4ed9">set_member_p</a></li>
<li><a href="#org2b99225">high school</a></li>
</ul>
</li>
<li><a href="#orgb2a7c30"><b>io</b></a>
<ul>
<li><a href="#orgd79b785">print</a></li>
<li><a href="#org20ddce3">nl &#x2013; newline</a></li>
<li><a href="#org13bb2e8">space</a></li>
</ul>
</li>
<li><a href="#orgba2f506"><b>sys</b></a>
<ul>
<li><a href="#orgd8b4882">bye</a></li>
</ul>
</li>
<li><a href="#org82aebbb"><b>repl</b></a>
<ul>
<li><a href="#org8f982cd">read_sexp</a>
<ul>
<li><a href="#org1764271">read_char</a></li>
<li><a href="#org8cd4629">read_string</a></li>
<li><a href="#org3ab8750">read_doublequoted_string</a></li>
<li><a href="#org645a771">read_sexp</a></li>
<li><a href="#orgbe0bc8d">read_sexp_list_until_ket</a></li>
</ul>
</li>
<li><a href="#org3ec1d4a">print_data_stack</a></li>
<li><a href="#orgdfea00e">print_return_stack</a>
<ul>
<li><a href="#org61227d2">print_return_stack</a></li>
<li><a href="#orgd970565">return_point_print</a></li>
<li><a href="#org6e5d163">jo_print</a></li>
</ul>
</li>
<li><a href="#org3721a71">module_repl</a>
<ul>
<li><a href="#org56ba90d"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org5e9c2fb">module_repl</a></li>
<li><a href="#orgb5101ed">EXIT_MODULE_REPL</a></li>
<li><a href="#orgd274a49">module_repl_one_step</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb14ed08"><b>error</b></a>
<ul>
<li><a href="#org78d6a5d">error</a></li>
<li><a href="#orged27ff7">module_debug</a>
<ul>
<li><a href="#orgaa3531">module_debug</a></li>
<li><a href="#org28fac5f">EXIT_MODULE_DEBUG_REPL</a></li>
<li><a href="#orgd3c3aa7">module_debug_one_step</a></li>
</ul>
</li>
<li><a href="#org8c15499">call_module_debug</a></li>
</ul>
</li>
<li><a href="#org773c1c0"><b>object</b></a>
<ul>
<li><a href="#orgebac578">Object</a></li>
</ul>
</li>
<li><a href="#org9df14ff"><b>class</b></a>
<ul>
<li><a href="#org2c8ccd9">value_to_class</a></li>
<li><a href="#org381722d">subclass_p</a></li>
</ul>
</li>
<li><a href="#orge812665"><b>misc</b></a>
<ul>
<li><a href="#orgc9089bf">nop</a></li>
</ul>
</li>
<li><a href="#orge2a6aea">------</a></li>
<li><a href="#org11d7b6f">keyword_dict</a>
<ul>
<li><a href="#org713581e"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#orga7b242f">keyword_dict</a></li>
<li><a href="#org75f8702">@keyword</a></li>
<li><a href="#orgbabbbc0">(note)</a></li>
<li><a href="#org792925d">(begin)</a></li>
<li><a href="#org28df0d">(clo)</a></li>
<li><a href="#org41dc3f3">(quote)</a></li>
<li><a href="#org7fdee02">(partquote)</a></li>
<li><a href="#orgace856">(-&gt;)</a></li>
<li><a href="#org4c5abc0">(list)</a></li>
<li><a href="#orgb513485">(vect)</a></li>
<li><a href="#orgb4e0061">(dict)</a></li>
<li><a href="#orge8d8e10">(tuple)</a></li>
<li><a href="#org5a3cc86">(set)</a></li>
</ul>
</li>
<li><a href="#orga53eba9">top_level_keywordm</a>
<ul>
<li><a href="#org9e9b566">(import)</a>
<ul>
<li><a href="#org362b046">k_import</a></li>
<li><a href="#orge7eebad">k_import_one</a></li>
<li><a href="#org141ea6b">k_import_as</a></li>
</ul>
</li>
<li><a href="#org1360565">(from)</a>
<ul>
<li><a href="#orgf78df0f">k_from</a></li>
<li><a href="#org526cb0b">k_from_syntax_check</a></li>
<li><a href="#org65cf7ef">k_from_as</a></li>
<li><a href="#org3dbc81b">k_from_as_syntax_check</a></li>
</ul>
</li>
<li><a href="#org9e35a7f">(+jojo)</a></li>
<li><a href="#org3a45c93">(+data)</a>
<ul>
<li><a href="#org54ab32f">plus_data</a></li>
<li><a href="#org8f0e614">data_name_string_p</a></li>
<li><a href="#orgccedc8b">JOJO_DATA</a></li>
<li><a href="#org6fa3f7b">create_data_class</a></li>
</ul>
</li>
<li><a href="#orgfc7d703">(+union)</a>
<ul>
<li><a href="#org9a0f46a">plus_union</a></li>
<li><a href="#orgad1e133">UNION</a></li>
</ul>
</li>
<li><a href="#orga160433"><span class="todo _note_">[note]</span> gene and disp</a></li>
<li><a href="#org4ca7d46">(+gene)</a>
<ul>
<li><a href="#org5a96483">plus_gene</a></li>
<li><a href="#org206a825">arrow_get_arity</a></li>
</ul>
</li>
<li><a href="#orgca1748e">(+disp)</a>
<ul>
<li><a href="#org1d132a7">plus_disp</a></li>
<li><a href="#org81c74f7">arrow_get_type_vect</a></li>
<li><a href="#org99eff15">type_vect_to_type_vect_vect</a></li>
<li><a href="#orgf7ef3bf">arrow_get_type_tuple_vect</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org122f325">key_jo_dict</a>
<ul>
<li><a href="#org6dcb770"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#orgb7f11d">key_jo_dict</a></li>
<li><a href="#org7e1ee0e">key_jo</a></li>
<li><a href="#orgb246b5">key_jo s</a></li>
</ul>
</li>
<li><a href="#orgdedd593">macro_dict</a>
<ul>
<li><a href="#orge845ff3"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#org285cf29">macro_dict</a></li>
<li><a href="#org2e3229f">@macro</a></li>
<li><a href="#orgcf5768f">(cond)</a></li>
<li><a href="#org44164d">(if)</a></li>
<li><a href="#org4e91516">(when)</a></li>
</ul>
</li>
<li><a href="#org9cd303e">------</a></li>
<li><a href="#orgd8dbfcf">epilog &#x2013; interface</a>
<ul>
<li><a href="#org1225edd">maybe_drop_shebang</a></li>
<li><a href="#org3d89bf8">load</a></li>
<li><a href="#orgc4e0796">run</a></li>
<li><a href="#org7811717">core_module</a>
<ul>
<li><a href="#org6737049">load_core</a></li>
<li><a href="#org1f74a48">core_module</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc711ce6">------</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf1cc1dd" class="outline-2">
<h2 id="orgf1cc1dd">------</h2>
</div>
<div id="outline-container-orgff3865d" class="outline-2">
<h2 id="orgff3865d">prolog</h2>
<div class="outline-text-2" id="text-orgff3865d">
</div><div id="outline-container-org3bad960" class="outline-3">
<h3 id="org3bad960">import</h3>
<div class="outline-text-3" id="text-org3bad960">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">import</span> inspect
<span style="color: #f92672; font-weight: bold;">import</span> types
<span style="color: #f92672; font-weight: bold;">import</span> importlib
<span style="color: #f92672; font-weight: bold;">import</span> sys
<span style="color: #f92672; font-weight: bold;">import</span> os
<span style="color: #f92672; font-weight: bold;">import</span> itertools
<span style="color: #f92672; font-weight: bold;">import</span> collections
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c2487d" class="outline-3">
<h3 id="org8c2487d">utility</h3>
<div class="outline-text-3" id="text-org8c2487d">
</div><div id="outline-container-orgf0173e6" class="outline-4">
<h4 id="orgf0173e6">get_signature</h4>
<div class="outline-text-4" id="text-orgf0173e6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_signature</span>(fun):
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> inspect.signature(fun)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">ValueError</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa4123b" class="outline-4">
<h4 id="orgfa4123b">fun_p</h4>
<div class="outline-text-4" id="text-orgfa4123b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fun_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #a6e22e;">isinstance</span>(x, types.LambdaType) <span style="color: #f92672; font-weight: bold;">or</span>
        <span style="color: #a6e22e;">isinstance</span>(x, types.MethodType)):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> (<span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinFunctionType) <span style="color: #f92672; font-weight: bold;">or</span>
          <span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinMethodType)):
        <span style="color: #f92672; font-weight: bold;">return</span> get_signature(x)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3fc020" class="outline-4">
<h4 id="orgd3fc020">method_p</h4>
<div class="outline-text-4" id="text-orgd3fc020">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">method_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">isinstance</span>(x, types.MethodType):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinMethodType):
        <span style="color: #f92672; font-weight: bold;">return</span> get_signature(x)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfe623c7" class="outline-4">
<h4 id="orgfe623c7">class_p</h4>
<div class="outline-text-4" id="text-orgfe623c7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">class_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> inspect.isclass(x):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> x == <span style="color: #a6e22e;">type</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org66e0e5e" class="outline-4">
<h4 id="org66e0e5e">Vect</h4>
<div class="outline-text-4" id="text-org66e0e5e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">Vect</span> = <span style="color: #a6e22e;">list</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga95de3d" class="outline-4">
<h4 id="orga95de3d">vect_p</h4>
<div class="outline-text-4" id="text-orga95de3d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == Vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org90bdf72" class="outline-4">
<h4 id="org90bdf72">string_p</h4>
<div class="outline-text-4" id="text-org90bdf72">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">str</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org90f58be" class="outline-4">
<h4 id="org90f58be">fill_vect</h4>
<div class="outline-text-4" id="text-org90f58be">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fill_vect</span>(value, length):
    <span style="color: #fd971f;">vect</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        vect.append(value)
        <span style="color: #fd971f;">i</span> = i + 1
    <span style="color: #f92672; font-weight: bold;">return</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org2822f94" class="outline-4">
<h4 id="org2822f94">fill_tuple</h4>
<div class="outline-text-4" id="text-org2822f94">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fill_tuple</span>(value, length):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(fill_vect(value, length))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1f7bff6" class="outline-3">
<h3 id="org1f7bff6">error handling</h3>
<div class="outline-text-3" id="text-org1f7bff6">
</div><div id="outline-container-orgee8f535" class="outline-4">
<h4 id="orgee8f535">JOJO_ERROR</h4>
<div class="outline-text-4" id="text-orgee8f535">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO_ERROR</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org71388ca" class="outline-4">
<h4 id="org71388ca">error</h4>
<div class="outline-text-4" id="text-org71388ca">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">error</span>():
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org1beb52d" class="outline-2">
<h2 id="org1beb52d">------</h2>
</div>
<div id="outline-container-orgca34bb4" class="outline-2">
<h2 id="orgca34bb4">vm</h2>
<div class="outline-text-2" id="text-orgca34bb4">
</div><div id="outline-container-org6978930" class="outline-3">
<h3 id="org6978930">RP</h3>
<div class="outline-text-3" id="text-org6978930">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">RP</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.cursor = 0
        <span style="color: #f92672; font-weight: bold;">self</span>.length = jojo.length
        <span style="color: #f92672; font-weight: bold;">self</span>.body = jojo.body
        <span style="color: #f92672; font-weight: bold;">self</span>.lr = jojo.lr.copy()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9bf570" class="outline-3">
<h3 id="orgb9bf570">VM</h3>
<div class="outline-text-3" id="text-orgb9bf570">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VM</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, ds, rs):
        <span style="color: #f92672; font-weight: bold;">self</span>.ds = ds
        <span style="color: #f92672; font-weight: bold;">self</span>.rs = rs

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(<span style="color: #f92672; font-weight: bold;">self</span>.rs)
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #a6e22e;">len</span>(<span style="color: #f92672; font-weight: bold;">self</span>.rs) &gt;= length:
            exe_one_step(<span style="color: #f92672; font-weight: bold;">self</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #f92672; font-weight: bold;">self</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org908d780" class="outline-3">
<h3 id="org908d780">VALUES</h3>
<div class="outline-text-3" id="text-org908d780">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VALUES</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, *values):
        <span style="color: #f92672; font-weight: bold;">self</span>.values = values
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4fbc7b" class="outline-3">
<h3 id="orgf4fbc7b">push_result_to_vm</h3>
<div class="outline-text-3" id="text-orgf4fbc7b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">push_result_to_vm</span>(result, vm):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(result) == VALUES:
        vm.ds.extend(result.values)
    <span style="color: #f92672; font-weight: bold;">elif</span> result == <span style="color: #ae81ff;">None</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        vm.ds.append(result)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8e10a9" class="outline-3">
<h3 id="orge8e10a9">exe_one_step</h3>
<div class="outline-text-3" id="text-orge8e10a9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_one_step</span>(vm):
    <span style="color: #fd971f;">rp</span> = vm.rs.pop()
    <span style="color: #f92672; font-weight: bold;">if</span> rp.length == 0:
        <span style="color: #f92672; font-weight: bold;">return</span>

    <span style="color: #fd971f;">jo</span> = rp.body[rp.cursor]

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">handle tail call</span>
    <span style="color: #f92672; font-weight: bold;">if</span> rp.cursor &gt;= rp.length - 1:
       <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
       <span style="color: #fd971f;">rp.cursor</span> = rp.cursor + 1
       vm.rs.append(rp)

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">dispatching</span>
    exe_jo(jo, rp, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org38db44" class="outline-3">
<h3 id="org38db44">exe_jo</h3>
<div class="outline-text-3" id="text-org38db44">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_jo</span>(jo, rp, vm):
    <span style="color: #f92672; font-weight: bold;">if</span> fun_p(jo):
        exe_fun(jo, vm)
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">hasattr</span>(jo, <span style="color: #e6db74;">"jo_exe"</span>):
        jo.jo_exe(rp, vm)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        vm.ds.append(jo)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge90ee8c" class="outline-3">
<h3 id="orge90ee8c">exe_fun</h3>
<div class="outline-text-3" id="text-orge90ee8c">
</div><div id="outline-container-org9af7e2" class="outline-4">
<h4 id="org9af7e2"><span class="todo _note_">[note]</span> python funtion arguments</h4>
<div class="outline-text-4" id="text-org9af7e2">
<ul class="org-ul">
<li><p>normal arguments are called positional arguments.</p></li>

<li><p>there are also keyword-only arguments,</p><p>because after *args,</p><p>the information about position will be lost.</p></li>

<li><p>before *args</p><p>each positional arguments took one position</p><p>do not respect default arguments</p></li>

<li><p>if *args is used in a function signature</p><p>pass it as a vect</p></li>

<li><p>if **kwargs is used in a function signature</p><p>pass it as a dict</p></li></ul>
</div>
</div>

<div id="outline-container-org795c6aa" class="outline-4">
<h4 id="org795c6aa">exe_fun</h4>
<div class="outline-text-4" id="text-org795c6aa">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_fun</span>(fun, vm):
    <span style="color: #fd971f;">signature</span> = get_signature(fun)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> signature:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exe_fun fail to get signature"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
        error()

    <span style="color: #fd971f;">parameters</span> = signature.parameters

    <span style="color: #f92672; font-weight: bold;">if</span> has_para_dict(parameters):
        <span style="color: #fd971f;">arg_dict</span> = get_default_arg_dict(parameters)
        <span style="color: #fd971f;">top_of_ds</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">isinstance</span>(top_of_ds, <span style="color: #a6e22e;">dict</span>):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exe_fun fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  when fun require a arg_dict"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  the top of data stack is not a dict"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  top of data stack : {}"</span>.<span style="color: #a6e22e;">format</span>(top_of_ds))
            error()
        arg_dict.update(top_of_ds)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">arg_dict</span> = <span style="color: #ae81ff;">None</span>

    <span style="color: #f92672; font-weight: bold;">if</span> has_para_vect(parameters):
        <span style="color: #fd971f;">top_of_ds</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> vect_p(top_of_ds):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exe_fun fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  when fun require a arg_vect"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  the top of data stack is not a vect"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  top of data stack : {}"</span>.<span style="color: #a6e22e;">format</span>(top_of_ds))
            error()
        <span style="color: #fd971f;">arg_vect</span> = top_of_ds
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">arg_vect</span> = []

    <span style="color: #fd971f;">positional_para_length</span> = get_positional_para_length(parameters)
    <span style="color: #fd971f;">args</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; positional_para_length:
        args.append(vm.ds.pop())
        <span style="color: #fd971f;">i</span> = i + 1
    args.reverse()
    args.extend(arg_vect)

    <span style="color: #f92672; font-weight: bold;">if</span> arg_dict == <span style="color: #ae81ff;">None</span>:
        <span style="color: #fd971f;">result</span> = fun(*args)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">result</span> = fun(*args, **arg_dict)

    push_result_to_vm(result, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org12cd317" class="outline-4">
<h4 id="org12cd317">get_positional_para_length</h4>
<div class="outline-text-4" id="text-org12cd317">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_positional_para_length</span>(parameters):
    <span style="color: #fd971f;">n</span> = 0
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.POSITIONAL_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
            v.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD):
            <span style="color: #fd971f;">n</span> = n + 1
    <span style="color: #f92672; font-weight: bold;">return</span> n
</pre>
</div>
</div>
</div>

<div id="outline-container-org35cf398" class="outline-4">
<h4 id="org35cf398">has_para_vect</h4>
<div class="outline-text-4" id="text-org35cf398">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">has_para_vect</span>(parameters):
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.VAR_POSITIONAL):
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5777604" class="outline-4">
<h4 id="org5777604">has_para_dict</h4>
<div class="outline-text-4" id="text-org5777604">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">has_para_dict</span>(parameters):
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.KEYWORD_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
            v.kind == inspect.Parameter.VAR_KEYWORD):
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf37cc37" class="outline-4">
<h4 id="orgf37cc37">get_default_arg_dict</h4>
<div class="outline-text-4" id="text-orgf37cc37">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_default_arg_dict</span>(parameters):
    <span style="color: #fd971f;">default_dict</span> = {}
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.KEYWORD_ONLY <span style="color: #f92672; font-weight: bold;">and</span>
            v.default != inspect.Parameter.empty):
            <span style="color: #fd971f;">default_dict</span>[v.name] = v.default
    <span style="color: #f92672; font-weight: bold;">return</span> default_dict
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgefade50" class="outline-2">
<h2 id="orgefade50">jo</h2>
<div class="outline-text-2" id="text-orgefade50">
</div><div id="outline-container-org83c51dc" class="outline-3">
<h3 id="org83c51dc">top level</h3>
<div class="outline-text-3" id="text-org83c51dc">
</div><div id="outline-container-org2859586" class="outline-4">
<h4 id="org2859586">JOJO</h4>
<div class="outline-text-4" id="text-org2859586">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, body):
        <span style="color: #f92672; font-weight: bold;">self</span>.length = <span style="color: #a6e22e;">len</span>(body)
        <span style="color: #f92672; font-weight: bold;">self</span>.body = Vect(body)
        <span style="color: #f92672; font-weight: bold;">self</span>.lr = {}

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.rs.append(RP(<span style="color: #f92672; font-weight: bold;">self</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org43599f4" class="outline-3">
<h3 id="org43599f4">closure</h3>
<div class="outline-text-3" id="text-org43599f4">
</div><div id="outline-container-orgdcb008d" class="outline-4">
<h4 id="orgdcb008d">CLO</h4>
<div class="outline-text-4" id="text-orgdcb008d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CLO</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, body):
        <span style="color: #f92672; font-weight: bold;">self</span>.body = body

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">new_jojo</span> = JOJO(<span style="color: #f92672; font-weight: bold;">self</span>.body)
        <span style="color: #fd971f;">new_jojo.lr</span> = rp.lr
        vm.ds.append(new_jojo)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"(clo "</span>)
        <span style="color: #f92672; font-weight: bold;">for</span> jo <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #f92672; font-weight: bold;">self</span>.body[:-1]:
            jo_print(jo)
            space()
        jo_print(<span style="color: #f92672; font-weight: bold;">self</span>.body[-1])
        p_print(<span style="color: #e6db74;">")"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c2b7b3" class="outline-4">
<h4 id="org9c2b7b3">APPLY</h4>
<div class="outline-text-4" id="text-org9c2b7b3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">APPLY</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">clo</span> = vm.ds.pop()
        clo.jo_exe(rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"apply"</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd3d51c" class="outline-3">
<h3 id="orgd3d51c">branching</h3>
<div class="outline-text-3" id="text-orgd3d51c">
</div><div id="outline-container-orgda7c4fc" class="outline-4">
<h4 id="orgda7c4fc">IFTE</h4>
<div class="outline-text-4" id="text-orgda7c4fc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">IFTE</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">clo2</span> = vm.ds.pop()
        <span style="color: #fd971f;">clo1</span> = vm.ds.pop()
        <span style="color: #fd971f;">test</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> test:
            vm.rs.append(RP(clo1))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            vm.rs.append(RP(clo2))

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"ifte"</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgebea46f" class="outline-3">
<h3 id="orgebea46f">CALL &#x2013; call a name from a module</h3>
<div class="outline-text-3" id="text-orgebea46f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CALL</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, module, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.module = module
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">jo</span> = <span style="color: #a6e22e;">getattr</span>(<span style="color: #f92672; font-weight: bold;">self</span>.module, <span style="color: #f92672; font-weight: bold;">self</span>.name)
        exe_jo(jo, rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #FF8888;"># </span><span style="color: #FF8888;">p_print("(call {} from {})".format(self.name, self.module.__name__))</span>
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.name)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0f068c" class="outline-3">
<h3 id="orgc0f068c">local variable</h3>
<div class="outline-text-3" id="text-orgc0f068c">
</div><div id="outline-container-org20a9d0d" class="outline-4">
<h4 id="org20a9d0d">GET</h4>
<div class="outline-text-4" id="text-org20a9d0d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GET</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value</span> = rp.lr[<span style="color: #f92672; font-weight: bold;">self</span>.name]
        vm.ds.append(value)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.name)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c0cc62" class="outline-4">
<h4 id="org8c0cc62">SET</h4>
<div class="outline-text-4" id="text-org8c0cc62">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">SET</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value</span> = vm.ds.pop()
        <span style="color: #fd971f;">rp.lr</span>[<span style="color: #f92672; font-weight: bold;">self</span>.name] = value

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.name)
        p_print(<span style="color: #e6db74;">'!'</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org88dc448" class="outline-3">
<h3 id="org88dc448">mark and collect</h3>
<div class="outline-text-3" id="text-org88dc448">
</div><div id="outline-container-org910395f" class="outline-4">
<h4 id="org910395f">MARK &#x2013; for collectors</h4>
<div class="outline-text-4" id="text-org910395f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MARK</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.ds.append(<span style="color: #f92672; font-weight: bold;">self</span>)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"mark"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org891c580" class="outline-4">
<h4 id="org891c580">COLLECT_VECT &#x2013; collect values before mark to vect</h4>
<div class="outline-text-4" id="text-org891c580">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">COLLECT_VECT</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vect</span> = []
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            <span style="color: #fd971f;">value</span> = vm.ds.pop()
            <span style="color: #f92672; font-weight: bold;">if</span> value == MARK:
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                vect.append(value)
        vect.reverse()
        vm.ds.append(vect)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"collect-vect"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org49e24e" class="outline-4">
<h4 id="org49e24e">VECT_SPREAD &#x2013; spread values to data stack</h4>
<div class="outline-text-4" id="text-org49e24e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VECT_SPREAD</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vect</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">for</span> value <span style="color: #f92672; font-weight: bold;">in</span> vect:
            vm.ds.append(value)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"vect-spread"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org421cb7" class="outline-4">
<h4 id="org421cb7">COLLECT_LIST &#x2013; collect values before mark to list</h4>
<div class="outline-text-4" id="text-org421cb7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">COLLECT_LIST</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(rest):
            <span style="color: #fd971f;">value</span> = vm.ds.pop()
            <span style="color: #f92672; font-weight: bold;">if</span> value == MARK:
                <span style="color: #f92672; font-weight: bold;">return</span> rest
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> recur(cons(value, rest))
        vm.ds.append(recur(null))

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"collect-list"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6f2fad" class="outline-4">
<h4 id="orgf6f2fad">LIST_SPREAD &#x2013; spread values to data stack</h4>
<div class="outline-text-4" id="text-orgf6f2fad">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">LIST_SPREAD</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(l):
            <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
                <span style="color: #f92672; font-weight: bold;">pass</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                vm.ds.append(car(l))
                recur(cdr(l))
        recur(vm.ds.pop())

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"list-spread"</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd676ee6" class="outline-3">
<h3 id="orgd676ee6">data</h3>
<div class="outline-text-3" id="text-orgd676ee6">
</div><div id="outline-container-org4881ea" class="outline-4">
<h4 id="org4881ea">DATA_PRED &#x2013; for data predicate</h4>
<div class="outline-text-4" id="text-org4881ea">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">DATA_PRED</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, data_class):
        <span style="color: #f92672; font-weight: bold;">self</span>.data_class = data_class

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">x</span> = vm.ds.pop()
        vm.ds.append(<span style="color: #a6e22e;">type</span>(x) == <span style="color: #f92672; font-weight: bold;">self</span>.data_class)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(data_class.<span style="color: #a6e22e;">__name__</span>)
        p_print(<span style="color: #e6db74;">'?'</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org80eb765" class="outline-3">
<h3 id="org80eb765">NEW &#x2013; create object from data and class</h3>
<div class="outline-text-3" id="text-org80eb765">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">NEW</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">x</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> class_p(x):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- NEW.jo_exe fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  argument is not a class : {}"</span>.<span style="color: #a6e22e;">format</span>(x))
            error()
        <span style="color: #f92672; font-weight: bold;">if</span> JOJO_DATA <span style="color: #f92672; font-weight: bold;">in</span> x.__bases__:
            <span style="color: #fd971f;">data_dict</span> = {}
            <span style="color: #f92672; font-weight: bold;">for</span> field_name <span style="color: #f92672; font-weight: bold;">in</span> x.reversed_field_name_vect:
                <span style="color: #fd971f;">data_dict</span>[field_name] = vm.ds.pop()
            <span style="color: #fd971f;">data_instance</span> = x(data_dict)
            vm.ds.append(data_instance)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            exe_fun(x, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"new"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9253e4" class="outline-3">
<h3 id="orgb9253e4">MSG &#x2013; message to object</h3>
<div class="outline-text-3" id="text-orgb9253e4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MSG</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, message):
        <span style="color: #f92672; font-weight: bold;">self</span>.message = message

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">o</span> = vm.ds.pop()
        <span style="color: #fd971f;">v</span> = <span style="color: #a6e22e;">getattr</span>(o, <span style="color: #f92672; font-weight: bold;">self</span>.message)
        <span style="color: #f92672; font-weight: bold;">if</span> method_p(v):
            exe_fun(v, vm)
        <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">type</span>(v) == JOJO:
            vm.ds.append(o)
            exe_jo(v, rp, vm)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            exe_jo(v, rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"."</span>)
        p_print(message)
</pre>
</div>
</div>
</div>

<div id="outline-container-org21a2ba0" class="outline-3">
<h3 id="org21a2ba0">GENE</h3>
<div class="outline-text-3" id="text-org21a2ba0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GENE</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, arity, default_jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.arity = arity
        <span style="color: #f92672; font-weight: bold;">self</span>.default_jojo = default_jojo
        <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict = {}

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value_vect</span> = vm.ds[(- <span style="color: #f92672; font-weight: bold;">self</span>.arity):]
        <span style="color: #fd971f;">type_vect</span> = []
        <span style="color: #f92672; font-weight: bold;">for</span> value <span style="color: #f92672; font-weight: bold;">in</span> value_vect:
            type_vect.append(<span style="color: #a6e22e;">type</span>(value))

        <span style="color: #fd971f;">type_tuple</span> = <span style="color: #a6e22e;">tuple</span>(type_vect)
        <span style="color: #f92672; font-weight: bold;">if</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict:
            <span style="color: #fd971f;">jojo</span> = <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict[type_tuple]
            jojo.jo_exe(rp, vm)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">self</span>.default_jojo.jo_exe(rp, vm)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org896363a" class="outline-2">
<h2 id="org896363a">------</h2>
</div>
<div id="outline-container-org25ad138" class="outline-2">
<h2 id="org25ad138">scan &#x2013; lexer for sexp</h2>
<div class="outline-text-2" id="text-org25ad138">
</div><div id="outline-container-orgdf93815" class="outline-3">
<h3 id="orgdf93815">scan_string_vect</h3>
<div class="outline-text-3" id="text-orgdf93815">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">scan_string_vect</span>(string):
    <span style="color: #fd971f;">string_vect</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        <span style="color: #fd971f;">char</span> = string[i]

        <span style="color: #f92672; font-weight: bold;">if</span> space_p(char):
            <span style="color: #fd971f;">i</span> = i + 1

        <span style="color: #f92672; font-weight: bold;">elif</span> delimiter_p(char):
            string_vect.append(char)
            <span style="color: #fd971f;">i</span> = i + 1

        <span style="color: #f92672; font-weight: bold;">elif</span> doublequote_p(char):
            <span style="color: #fd971f;">doublequote_end_index</span> = string.find(<span style="color: #e6db74;">'"'</span>, i+1)
            <span style="color: #f92672; font-weight: bold;">if</span> doublequote_end_index == -1:
                <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- scan_string_vect fail"</span>)
                <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  doublequote mismatch"</span>)
                <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  string : {}"</span>.<span style="color: #a6e22e;">format</span>(string))
                error()
            <span style="color: #fd971f;">end</span> = doublequote_end_index + 1
            string_vect.append(string[i:end])
            <span style="color: #fd971f;">i</span> = end

        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">end</span> = find_end(string, i+1)
            string_vect.append(string[i:end])
            <span style="color: #fd971f;">i</span> = end

    <span style="color: #f92672; font-weight: bold;">return</span> string_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org894f3b" class="outline-3">
<h3 id="org894f3b">find_end</h3>
<div class="outline-text-3" id="text-org894f3b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">find_end</span>(string, begin):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #fd971f;">i</span> = begin
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
       <span style="color: #f92672; font-weight: bold;">if</span> i == length:
           <span style="color: #f92672; font-weight: bold;">return</span> i
       <span style="color: #fd971f;">char</span> = string[i]
       <span style="color: #f92672; font-weight: bold;">if</span> (space_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
           delimiter_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
           doublequote_p(char)):
           <span style="color: #f92672; font-weight: bold;">return</span> i
       <span style="color: #fd971f;">i</span> = i + 1
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdcb009f" class="outline-3">
<h3 id="orgdcb009f">space_p</h3>
<div class="outline-text-3" id="text-orgdcb009f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">space_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> char.isspace()
</pre>
</div>
</div>
</div>

<div id="outline-container-org569d1b" class="outline-3">
<h3 id="org569d1b">delimiter_p</h3>
<div class="outline-text-3" id="text-org569d1b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">delimiter_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> (char == <span style="color: #e6db74;">'('</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">')'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'['</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">']'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'{'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'}'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">','</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'`'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">"'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9bf4b5" class="outline-3">
<h3 id="orgd9bf4b5">doublequote_p</h3>
<div class="outline-text-3" id="text-orgd9bf4b5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequote_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> char == <span style="color: #e6db74;">'"'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd6d4535" class="outline-2">
<h2 id="orgd6d4535">null &amp; cons</h2>
<div class="outline-text-2" id="text-orgd6d4535">
</div><div id="outline-container-orgf6df0ce" class="outline-3">
<h3 id="orgf6df0ce">Null</h3>
<div class="outline-text-3" id="text-orgf6df0ce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Null</span>:
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd915231" class="outline-3">
<h3 id="orgd915231">null</h3>
<div class="outline-text-3" id="text-orgd915231">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">null</span> = Null()
</pre>
</div>
</div>
</div>

<div id="outline-container-org484b263" class="outline-3">
<h3 id="org484b263">null_p</h3>
<div class="outline-text-3" id="text-org484b263">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">null_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x == null
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e52851" class="outline-3">
<h3 id="org3e52851">Cons</h3>
<div class="outline-text-3" id="text-org3e52851">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Cons</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, car, cdr):
        <span style="color: #f92672; font-weight: bold;">self</span>.car = car
        <span style="color: #f92672; font-weight: bold;">self</span>.cdr = cdr
</pre>
</div>
</div>
</div>

<div id="outline-container-org6efac3d" class="outline-3">
<h3 id="org6efac3d">cons</h3>
<div class="outline-text-3" id="text-org6efac3d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons</span>(car, cdr):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(cdr) <span style="color: #f92672; font-weight: bold;">or</span> cons_p(cdr):
        <span style="color: #f92672; font-weight: bold;">return</span> Cons(car, cdr)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- cons fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  cdr of cons must be a cons or null"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  cdr : {}"</span>.<span style="color: #a6e22e;">format</span>(cdr))
        error()
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7fa478" class="outline-3">
<h3 id="orga7fa478">cons_p</h3>
<div class="outline-text-3" id="text-orga7fa478">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">isinstance</span>(x, Cons)
</pre>
</div>
</div>
</div>

<div id="outline-container-org85e1a6c" class="outline-3">
<h3 id="org85e1a6c">cdr</h3>
<div class="outline-text-3" id="text-org85e1a6c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cdr</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x.cdr
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e88db0" class="outline-3">
<h3 id="org1e88db0">car</h3>
<div class="outline-text-3" id="text-org1e88db0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">car</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x.car
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeed437d" class="outline-2">
<h2 id="orgeed437d">sexp &#x2013; string expression</h2>
<div class="outline-text-2" id="text-orgeed437d">
</div><div id="outline-container-orgd0af1da" class="outline-3">
<h3 id="orgd0af1da"><span class="todo _note_">[note]</span> syntax sugar</h3>
<div class="outline-text-3" id="text-orgd0af1da">
<ul class="org-ul">
<li><p>[&#x2026;] -&gt; (begin &#x2026;)</p></li>
<li><p>{&#x2026;} -&gt; (clo &#x2026;)</p></li>
<li><p>' &#x2026; -&gt; (quote &#x2026;)</p></li>
<li><p>` &#x2026; -&gt; (partquote &#x2026;)</p></li></ul>
</div>
</div>

<div id="outline-container-org95e8607" class="outline-3">
<h3 id="org95e8607">parse_sexp_vect &#x2013; string vect to sexp vect</h3>
<div class="outline-text-3" id="text-org95e8607">
<ul class="org-ul">
<li><p>sexp := Null | Cons(sexp, sexp_list) | string</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp_vect</span>(string_vect):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string_vect)
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #fd971f;">sexp_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
       <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i</span> = parse_sexp(string_vect, i)
       sexp_vect.append(s)
    <span style="color: #f92672; font-weight: bold;">return</span> sexp_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org283b6ce" class="outline-3">
<h3 id="org283b6ce">parse_sexp</h3>
<div class="outline-text-3" id="text-org283b6ce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp</span>(string_vect, i):
    <span style="color: #fd971f;">string</span> = string_vect[i]
    <span style="color: #f92672; font-weight: bold;">if</span> string == <span style="color: #e6db74;">'('</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">')'</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'['</span>:
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i1</span> = parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">']'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'begin'</span>, s_cons), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'{'</span>:
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i1</span> = parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">'}'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'clo'</span>, s_cons), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"'"</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i+1)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'quote'</span>, cons(s, null)), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"`"</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i+1)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'partquote'</span>, cons(s, null)), i1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> (string, i+1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org128df39" class="outline-3">
<h3 id="org128df39">parse_sexp_cons_until_ket</h3>
<div class="outline-text-3" id="text-org128df39">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp_cons_until_ket</span>(string_vect, i, ket):
    <span style="color: #fd971f;">string</span> = string_vect[i]
    <span style="color: #f92672; font-weight: bold;">if</span> string == ket:
        <span style="color: #f92672; font-weight: bold;">return</span> (null, i+1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i)
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i2</span> = \
            parse_sexp_cons_until_ket(string_vect, i1, ket)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(s, s_cons), i2)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cd47bd" class="outline-3">
<h3 id="org8cd47bd">p_print</h3>
<div class="outline-text-3" id="text-org8cd47bd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_print</span>(x):
    <span style="color: #f92672; font-weight: bold;">print</span>(x, end=<span style="color: #e6db74;">""</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org153c7e1" class="outline-3">
<h3 id="org153c7e1">sexp_print</h3>
<div class="outline-text-3" id="text-org153c7e1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_print</span>(s):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(s):
        p_print(<span style="color: #e6db74;">"null"</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(s):
        p_print(<span style="color: #e6db74;">"("</span>)
        sexp_list_print(s)
        p_print(<span style="color: #e6db74;">")"</span>)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga028fee" class="outline-3">
<h3 id="orga028fee">sexp_list_print</h3>
<div class="outline-text-3" id="text-orga028fee">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_list_print</span>(s_cons):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(s_cons):
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> null_p(cdr(s_cons)):
        sexp_print(car(s_cons))
    <span style="color: #f92672; font-weight: bold;">else</span>:
        sexp_print(car(s_cons))
        p_print(<span style="color: #e6db74;">" "</span>)
        sexp_list_print(cdr(s_cons))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1636fa9" class="outline-2">
<h2 id="org1636fa9"><span class="todo _note_">[note]</span> syntax</h2>
<div class="outline-text-2" id="text-org1636fa9">
</div><div id="outline-container-org6146c9f" class="outline-3">
<h3 id="org6146c9f">top level</h3>
<div class="outline-text-3" id="text-org6146c9f">
<ul class="org-ul">
<li><p>(note)</p></li>
<li><p>(import)</p></li>

<li><p>(+jojo)</p></li>
<li><p>(+macro)</p></li>

<li><p>(+data)</p></li>
<li><p>(+union)</p></li>
<li><p>(+gene)</p></li>
<li><p>(+disp)</p></li></ul>
</div>
</div>

<div id="outline-container-orgef96153" class="outline-3">
<h3 id="orgef96153">control</h3>
<div class="outline-text-3" id="text-orgef96153">
<ul class="org-ul">
<li><p>(begin)</p></li>
<li><p>(clo)</p></li>
<li><p>(cond)</p></li>

<li><p>(if)</p></li>
<li><p>(case)</p></li></ul>
</div>
</div>

<div id="outline-container-org848dc69" class="outline-3">
<h3 id="org848dc69">sexp quote</h3>
<div class="outline-text-3" id="text-org848dc69">
<ul class="org-ul">
<li><p>(quote)</p></li>
<li><p>(partquote (@))</p></li></ul>
</div>
</div>

<div id="outline-container-org2c47c93" class="outline-3">
<h3 id="org2c47c93">data</h3>
<div class="outline-text-3" id="text-org2c47c93">
<ul class="org-ul">
<li><p>(list)</p></li>
<li><p>(vect)</p></li>
<li><p>(dict)</p></li>
<li><p>(tuple) (*)</p></li>
<li><p>(set)</p></li></ul>
</div>
</div>

<div id="outline-container-org6b29826" class="outline-3">
<h3 id="org6b29826">key jo</h3>
<div class="outline-text-3" id="text-org6b29826">
<ul class="org-ul">
<li><p>apply</p></li>
<li><p>ifte</p></li>
<li><p>new</p></li></ul>
</div>
</div>

<div id="outline-container-orgf48bffd" class="outline-3">
<h3 id="orgf48bffd">jo pattern</h3>
<div class="outline-text-3" id="text-orgf48bffd">
<ul class="org-ul">
<li><p>:local</p></li>
<li><p>:local!</p></li>
<li><p>.message</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org92b441" class="outline-2">
<h2 id="org92b441">compiler</h2>
<div class="outline-text-2" id="text-org92b441">
</div><div id="outline-container-org9bfb56b" class="outline-3">
<h3 id="org9bfb56b">new_module</h3>
<div class="outline-text-3" id="text-org9bfb56b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">new_module</span>(name):
    <span style="color: #fd971f;">module</span> = types.ModuleType(name)
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">for top level sexp</span>
    <span style="color: #fd971f;">module.vm</span> = VM([], [])
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">for name can occur before been defined</span>
    <span style="color: #fd971f;">module.defined_name_set</span> = <span style="color: #a6e22e;">set</span>()
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org18b4801" class="outline-3">
<h3 id="org18b4801">filter_name_vect</h3>
<div class="outline-text-3" id="text-org18b4801">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">filter_name_vect</span>(keyword, sexp_vect):
    <span style="color: #fd971f;">name_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> cons_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> car(sexp) == keyword:
            <span style="color: #fd971f;">body</span> = cdr(sexp)
            <span style="color: #fd971f;">name</span> = car(body)
            name_vect.append(name)
    <span style="color: #f92672; font-weight: bold;">return</span> name_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgabfcc2f" class="outline-3">
<h3 id="orgabfcc2f">get_jojo_name_vect</h3>
<div class="outline-text-3" id="text-orgabfcc2f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_jojo_name_vect</span>(sexp_vect):
    <span style="color: #fd971f;">name_vect</span> = filter_name_vect(<span style="color: #e6db74;">'+jojo'</span>, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> name_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd31bb7a" class="outline-3">
<h3 id="orgd31bb7a">get_data_name_vect</h3>
<div class="outline-text-3" id="text-orgd31bb7a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_data_name_vect</span>(sexp_vect):
    <span style="color: #fd971f;">name_vect</span> = filter_name_vect(<span style="color: #e6db74;">'+data'</span>, sexp_vect)
    <span style="color: #fd971f;">cons_name_vect</span> = []
    <span style="color: #fd971f;">pred_name_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        <span style="color: #fd971f;">cons_name</span> = name[1:-1]
        <span style="color: #fd971f;">pred_name</span> = <span style="color: #e6db74;">""</span>.join([cons_name, <span style="color: #e6db74;">'?'</span>])
        cons_name_vect.append(cons_name)
        pred_name_vect.append(pred_name)

    name_vect.extend(cons_name_vect)
    name_vect.extend(pred_name_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> name_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org4dd17b0" class="outline-3">
<h3 id="org4dd17b0">jojo_define</h3>
<div class="outline-text-3" id="text-org4dd17b0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jojo_define</span>(module, name, value):
    <span style="color: #fd971f;">defined_name_set</span> = <span style="color: #a6e22e;">getattr</span>(module, <span style="color: #e6db74;">'defined_name_set'</span>)
    defined_name_set.add(name)
    <span style="color: #a6e22e;">setattr</span>(module, name, value)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5605ae2" class="outline-3">
<h3 id="org5605ae2">merge_prim_dict</h3>
<div class="outline-text-3" id="text-org5605ae2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_prim_dict</span>(module):
    <span style="color: #f92672; font-weight: bold;">for</span> name, value <span style="color: #f92672; font-weight: bold;">in</span> prim_dict.items():
        jojo_define(module, name, value)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a79343" class="outline-3">
<h3 id="org8a79343">merge_module</h3>
<div class="outline-text-3" id="text-org8a79343">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_module</span>(module, src_module):
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> src_module.defined_name_set:
        <span style="color: #fd971f;">jojo</span> = <span style="color: #a6e22e;">getattr</span>(src_module, name)
        jojo_define(module, name, jojo)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f6072a" class="outline-3">
<h3 id="org8f6072a">merge_sexp_vect</h3>
<div class="outline-text-3" id="text-org8f6072a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_sexp_vect</span>(module, sexp_vect):
    module.defined_name_set.update(get_jojo_name_vect(sexp_vect))
    module.defined_name_set.update(get_data_name_vect(sexp_vect))
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #fd971f;">jo_vect</span> = sexp_emit(module, sexp)
        module.vm.rs.append(RP(JOJO(jo_vect)))
        module.vm.exe()
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd216ea" class="outline-3">
<h3 id="orgdd216ea">compile_module</h3>
<div class="outline-text-3" id="text-orgdd216ea">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">compile_module</span>(name, sexp_vect):
    <span style="color: #fd971f;">module</span> = new_module(name)
    merge_prim_dict(module)
    merge_module(module, core_module)
    merge_sexp_vect(module, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f9dfcc" class="outline-3">
<h3 id="org1f9dfcc">compile_core_module</h3>
<div class="outline-text-3" id="text-org1f9dfcc">
<ul class="org-ul">
<li><p>compile the core_module itself</p><p>without merging core_module</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">compile_core_module</span>(name, sexp_vect):
    <span style="color: #fd971f;">module</span> = new_module(name)
    merge_prim_dict(module)
    merge_sexp_vect(module, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org799626b" class="outline-3">
<h3 id="org799626b">sexp_list_emit</h3>
<div class="outline-text-3" id="text-org799626b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_list_emit</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        jo_vect.extend(sexp_emit(module, sexp))
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb25ab10" class="outline-3">
<h3 id="orgb25ab10">sexp_emit</h3>
<div class="outline-text-3" id="text-orgb25ab10">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_emit</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> null_emit(module, sexp)
    <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> cons_emit(module, sexp)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> string_emit(module, sexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9f9373" class="outline-3">
<h3 id="orgb9f9373">null_emit</h3>
<div class="outline-text-3" id="text-orgb9f9373">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">null_emit</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">return</span> [null]
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cf2ece" class="outline-3">
<h3 id="org5cf2ece">cons_emit</h3>
<div class="outline-text-3" id="text-org5cf2ece">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons_emit</span>(module, cons):
    <span style="color: #fd971f;">keyword</span> = car(cons)
    <span style="color: #f92672; font-weight: bold;">if</span> keyword <span style="color: #f92672; font-weight: bold;">in</span> keyword_dict.keys():
        <span style="color: #fd971f;">fun</span> = keyword_dict[keyword]
        <span style="color: #f92672; font-weight: bold;">return</span> fun(module, cdr(cons))
    <span style="color: #f92672; font-weight: bold;">elif</span> keyword <span style="color: #f92672; font-weight: bold;">in</span> macro_dict.keys():
        <span style="color: #fd971f;">fun</span> = macro_dict[keyword]
        <span style="color: #fd971f;">new_sexp</span> = fun(cdr(cons))
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_emit(module, new_sexp)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">vm</span> = VM([cdr(cons)],
                [RP(JOJO(string_emit(module, keyword)))])
        vm.exe()
        <span style="color: #fd971f;">new_sexp</span> = vm.ds[0]
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_emit(module, new_sexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba2401d" class="outline-3">
<h3 id="orgba2401d">string_emit</h3>
<div class="outline-text-3" id="text-orgba2401d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_emit</span>(module, string):
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; <span style="color: #a6e22e;">len</span>(string_emitter_vect):
        <span style="color: #fd971f;">p</span> = string_emitter_vect[i][0]
        <span style="color: #fd971f;">e</span> = string_emitter_vect[i][1]
        <span style="color: #f92672; font-weight: bold;">if</span> p(string):
            <span style="color: #f92672; font-weight: bold;">return</span> e(module, string)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">i</span> = i + 1

    <span style="color: #f92672; font-weight: bold;">if</span> string <span style="color: #f92672; font-weight: bold;">in</span> key_jo_dict.keys():
        <span style="color: #f92672; font-weight: bold;">return</span> key_jo_dict[string]

    <span style="color: #fd971f;">defined_name_set</span> = <span style="color: #a6e22e;">getattr</span>(module, <span style="color: #e6db74;">'defined_name_set'</span>)
    <span style="color: #f92672; font-weight: bold;">if</span> string <span style="color: #f92672; font-weight: bold;">in</span> defined_name_set:
        <span style="color: #f92672; font-weight: bold;">return</span> [CALL(module, string)]

    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- string_emit fail"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  meet undefined string : {}"</span>.<span style="color: #a6e22e;">format</span>(string))
    newline()
    error()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc30cd1" class="outline-3">
<h3 id="orgc30cd1">sexp_value</h3>
<div class="outline-text-3" id="text-orgc30cd1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_value</span>(module, sexp):
    <span style="color: #fd971f;">jo_vect</span> = sexp_emit(module, sexp)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    <span style="color: #fd971f;">vm</span> = VM([], [RP(jojo)])
    vm.exe()
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vm.ds) != 1:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- sexp_value fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  sexp must return one value"</span>)
        p_print(<span style="color: #e6db74;">"  sexp : "</span>)
        sexp_print(sexp)
        newline()
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  number of values : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(vm.ds)))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  returned : {}"</span>.<span style="color: #a6e22e;">format</span>(vm.ds))
        error()

    <span style="color: #fd971f;">value</span> = vm.ds[0]
    <span style="color: #f92672; font-weight: bold;">return</span> value
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org12b18ce" class="outline-2">
<h2 id="org12b18ce">------</h2>
</div>
<div id="outline-container-org34173c9" class="outline-2">
<h2 id="org34173c9">string_emitter_vect</h2>
<div class="outline-text-2" id="text-org34173c9">
</div><div id="outline-container-org3d667ba" class="outline-3">
<h3 id="org3d667ba">string_emitter_vect</h3>
<div class="outline-text-3" id="text-org3d667ba">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">string_emitter_vect</span> = []
</pre>
</div>
</div>
</div>

<div id="outline-container-org6462d76" class="outline-3">
<h3 id="org6462d76">string_emitter</h3>
<div class="outline-text-3" id="text-org6462d76">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_emitter</span>(p, emitter):
    string_emitter_vect.append((p, emitter))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8b21ef" class="outline-3">
<h3 id="orgb8b21ef">int_string</h3>
<div class="outline-text-3" id="text-orgb8b21ef">
</div><div id="outline-container-org7be67f1" class="outline-4">
<h4 id="org7be67f1">int_string_p</h4>
<div class="outline-text-4" id="text-org7be67f1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_string_p</span>(string):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #f92672; font-weight: bold;">if</span> length == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] == <span style="color: #e6db74;">'-'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(string[1:])
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf8c056" class="outline-4">
<h4 id="orgaf8c056">nat_string_p</h4>
<div class="outline-text-4" id="text-orgaf8c056">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">nat_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> string.isdecimal()
</pre>
</div>
</div>
</div>

<div id="outline-container-orge87d740" class="outline-4">
<h4 id="orge87d740">int_string_emitter</h4>
<div class="outline-text-4" id="text-orge87d740">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_string_emitter</span>(module, string):
    <span style="color: #f92672; font-weight: bold;">return</span> [<span style="color: #a6e22e;">int</span>(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ff4b0e" class="outline-4">
<h4 id="org5ff4b0e">record</h4>
<div class="outline-text-4" id="text-org5ff4b0e">
<div class="org-src-container">

<pre class="src src-python">string_emitter(int_string_p,
               int_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1701180" class="outline-3">
<h3 id="org1701180">doublequoted_string</h3>
<div class="outline-text-3" id="text-org1701180">
</div><div id="outline-container-org5df43cc" class="outline-4">
<h4 id="org5df43cc">doublequoted_string_p</h4>
<div class="outline-text-4" id="text-org5df43cc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequoted_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa42e08" class="outline-4">
<h4 id="orgfa42e08">doublequoted_string_emitter</h4>
<div class="outline-text-4" id="text-orgfa42e08">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequoted_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [string]
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fd87ac" class="outline-4">
<h4 id="org4fd87ac">record</h4>
<div class="outline-text-4" id="text-org4fd87ac">
<div class="org-src-container">

<pre class="src src-python">string_emitter(doublequoted_string_p,
               doublequoted_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9402e67" class="outline-3">
<h3 id="org9402e67">local_string</h3>
<div class="outline-text-3" id="text-org9402e67">
</div><div id="outline-container-org94ba7c1" class="outline-4">
<h4 id="org94ba7c1">local_string_p</h4>
<div class="outline-text-4" id="text-org94ba7c1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] == <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48721a6" class="outline-4">
<h4 id="org48721a6">local_string_emitter</h4>
<div class="outline-text-4" id="text-org48721a6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_string_emitter</span>(module, string):
    <span style="color: #f92672; font-weight: bold;">return</span> [GET(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf29cd2c" class="outline-4">
<h4 id="orgf29cd2c">record</h4>
<div class="outline-text-4" id="text-orgf29cd2c">
<div class="org-src-container">

<pre class="src src-python">string_emitter(local_string_p,
               local_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4cc4a0f" class="outline-3">
<h3 id="org4cc4a0f">set_local_string</h3>
<div class="outline-text-3" id="text-org4cc4a0f">
</div><div id="outline-container-orgcd8b35a" class="outline-4">
<h4 id="orgcd8b35a">set_local_string_p</h4>
<div class="outline-text-4" id="text-orgcd8b35a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_local_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1e1f46" class="outline-4">
<h4 id="orga1e1f46">set_local_string_emitter</h4>
<div class="outline-text-4" id="text-orga1e1f46">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_local_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [SET(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org1513126" class="outline-4">
<h4 id="org1513126">record</h4>
<div class="outline-text-4" id="text-org1513126">
<div class="org-src-container">

<pre class="src src-python">string_emitter(set_local_string_p,
               set_local_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3cda488" class="outline-3">
<h3 id="org3cda488">message_string</h3>
<div class="outline-text-3" id="text-org3cda488">
</div><div id="outline-container-orgdf94d59" class="outline-4">
<h4 id="orgdf94d59">message_string_p</h4>
<div class="outline-text-4" id="text-orgdf94d59">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbac90e8" class="outline-4">
<h4 id="orgbac90e8">message_string_emitter</h4>
<div class="outline-text-4" id="text-orgbac90e8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:]
    <span style="color: #f92672; font-weight: bold;">return</span> [MSG(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf14bee7" class="outline-4">
<h4 id="orgf14bee7">record</h4>
<div class="outline-text-4" id="text-orgf14bee7">
<div class="org-src-container">

<pre class="src src-python">string_emitter(message_string_p,
               message_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org71e5066" class="outline-3">
<h3 id="org71e5066">name_message_string</h3>
<div class="outline-text-3" id="text-org71e5066">
</div><div id="outline-container-orgd16b08d" class="outline-4">
<h4 id="orgd16b08d">name_message_string_p</h4>
<div class="outline-text-4" id="text-orgd16b08d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">name_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3: <span style="color: #FF8888;"># </span><span style="color: #FF8888;">example : 'n.s'</span>
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] == <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'..'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] == <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org86143d2" class="outline-4">
<h4 id="org86143d2">name_message_string_emitter</h4>
<div class="outline-text-4" id="text-org86143d2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">name_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)

    <span style="color: #fd971f;">name_string</span> = string_vect[0]
    jo_vect.extend(string_emit(module, name_string))

    <span style="color: #fd971f;">message_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> message_string <span style="color: #f92672; font-weight: bold;">in</span> message_string_vect:
        jo_vect.append(MSG(message_string))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1fca59" class="outline-4">
<h4 id="orgf1fca59">record</h4>
<div class="outline-text-4" id="text-orgf1fca59">
<div class="org-src-container">

<pre class="src src-python">string_emitter(name_message_string_p,
               name_message_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org239b552" class="outline-3">
<h3 id="org239b552">local_message_string</h3>
<div class="outline-text-3" id="text-org239b552">
</div><div id="outline-container-org1e1617c" class="outline-4">
<h4 id="org1e1617c">local_message_string_p</h4>
<div class="outline-text-4" id="text-org1e1617c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 4:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> name_message_string_p(string[1:])
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b8a3b" class="outline-4">
<h4 id="org94b8a3b">local_message_string_emitter</h4>
<div class="outline-text-4" id="text-org94b8a3b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)

    <span style="color: #fd971f;">local_string</span> = string_vect[0]
    jo_vect.append(GET(local_string))

    <span style="color: #fd971f;">message_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> message_string <span style="color: #f92672; font-weight: bold;">in</span> message_string_vect:
        jo_vect.append(MSG(message_string))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8f6e52" class="outline-4">
<h4 id="orgb8f6e52">record</h4>
<div class="outline-text-4" id="text-orgb8f6e52">
<div class="org-src-container">

<pre class="src src-python">string_emitter(local_message_string_p,
               local_message_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4641de" class="outline-3">
<h3 id="org4641de">message_message_string</h3>
<div class="outline-text-3" id="text-org4641de">
</div><div id="outline-container-org834ef4c" class="outline-4">
<h4 id="org834ef4c">message_message_string_p</h4>
<div class="outline-text-4" id="text-org834ef4c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 4:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> name_message_string_p(string[1:])
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cb593" class="outline-4">
<h4 id="org5cb593">message_message_string_emitter</h4>
<div class="outline-text-4" id="text-org5cb593">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)

    <span style="color: #fd971f;">message_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> message_string <span style="color: #f92672; font-weight: bold;">in</span> message_string_vect:
        jo_vect.append(MSG(message_string))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb8893a" class="outline-4">
<h4 id="orgfb8893a">record</h4>
<div class="outline-text-4" id="text-orgfb8893a">
<div class="org-src-container">

<pre class="src src-python">string_emitter(message_message_string_p,
               message_message_string_emitter)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdf18651" class="outline-2">
<h2 id="orgdf18651">prim_dict</h2>
<div class="outline-text-2" id="text-orgdf18651">
</div><div id="outline-container-org6357587" class="outline-3">
<h3 id="org6357587">prim_dict</h3>
<div class="outline-text-3" id="text-org6357587">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">prim_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org560419f" class="outline-3">
<h3 id="org560419f">@prim</h3>
<div class="outline-text-3" id="text-org560419f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">prim</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">prim_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org140e195" class="outline-2">
<h2 id="org140e195">------</h2>
</div>
<div id="outline-container-org7592308" class="outline-2">
<h2 id="org7592308"><b>stack operation</b></h2>
<div class="outline-text-2" id="text-org7592308">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'drop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">drop</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">None</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dup'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dup</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(a, a)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'over'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">over</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(a, b, a)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuck'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuck</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(b, a, b)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'swap'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">swap</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(b, a)
</pre>
</div>
</div>
</div>

<div id="outline-container-org334757f" class="outline-2">
<h2 id="org334757f"><b>int</b></h2>
<div class="outline-text-2" id="text-org334757f">
</div><div id="outline-container-org625136c" class="outline-3">
<h3 id="org625136c">Int</h3>
<div class="outline-text-3" id="text-org625136c">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Int'</span>)(<span style="color: #a6e22e;">int</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org620d6a3" class="outline-3">
<h3 id="org620d6a3">int_p</h3>
<div class="outline-text-3" id="text-org620d6a3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'int?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org62a3cb" class="outline-3">
<h3 id="org62a3cb">primary school</h3>
<div class="outline-text-3" id="text-org62a3cb">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'inc'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">inc</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> a + 1

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dec'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dec</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> a - 1

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'add'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">add</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a + b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'sub'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sub</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a - b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'mul'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">mul</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a * b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'div'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">div</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a // b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'mod'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">mod</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a % b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'divmod'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_divmod</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(*<span style="color: #a6e22e;">divmod</span>(a, b))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3d968" class="outline-3">
<h3 id="orgc3d968">compare</h3>
<div class="outline-text-3" id="text-orgc3d968">
</div><div id="outline-container-org11d8b38" class="outline-4">
<h4 id="org11d8b38">lt_p &#x2013; less then</h4>
<div class="outline-text-4" id="text-org11d8b38">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'lt?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">lt_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &lt; b
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bbc66" class="outline-4">
<h4 id="org1bbc66">gt_p &#x2013; greater then</h4>
<div class="outline-text-4" id="text-org1bbc66">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'gt?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">gt_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &gt; b
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbac4d7d" class="outline-4">
<h4 id="orgbac4d7d">lteq_p &#x2013; less then or equal to</h4>
<div class="outline-text-4" id="text-orgbac4d7d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'lteq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">lteq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &lt;= b
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0a3f9b" class="outline-4">
<h4 id="orgd0a3f9b">gteq_p &#x2013; greater then or equal to</h4>
<div class="outline-text-4" id="text-orgd0a3f9b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'gteq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">gteq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &gt;= b
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5c03454" class="outline-3">
<h3 id="org5c03454">int_print</h3>
<div class="outline-text-3" id="text-org5c03454">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'int-print'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_print</span>(i):
    p_print(i)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc871e98" class="outline-2">
<h2 id="orgc871e98"><b>bool</b></h2>
<div class="outline-text-2" id="text-orgc871e98">
</div><div id="outline-container-orgbdfac3f" class="outline-3">
<h3 id="orgbdfac3f">Bool</h3>
<div class="outline-text-3" id="text-orgbdfac3f">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Bool'</span>)(<span style="color: #a6e22e;">bool</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d36d2e" class="outline-3">
<h3 id="org2d36d2e">basic</h3>
<div class="outline-text-3" id="text-org2d36d2e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'true'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">true</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'false'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">false</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'not'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_not</span>(b):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #f92672; font-weight: bold;">not</span> b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'and'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_and</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> (a <span style="color: #f92672; font-weight: bold;">and</span> b)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'or'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_or</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> (a <span style="color: #f92672; font-weight: bold;">or</span> b)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e293ae" class="outline-2">
<h2 id="org3e293ae"><b>equivalence</b></h2>
<div class="outline-text-2" id="text-org3e293ae">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'eq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">eq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">if</span> string_p(a):
        <span style="color: #f92672; font-weight: bold;">return</span> a == b
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> a <span style="color: #f92672; font-weight: bold;">is</span> b
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf713c49" class="outline-2">
<h2 id="orgf713c49"><b>sexp</b></h2>
<div class="outline-text-2" id="text-orgf713c49">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'null'</span>)(null)
prim(<span style="color: #e6db74;">'null?'</span>)(null_p)

prim(<span style="color: #e6db74;">'cons'</span>)(cons)
prim(<span style="color: #e6db74;">'cons?'</span>)(cons_p)

prim(<span style="color: #e6db74;">'car'</span>)(car)
prim(<span style="color: #e6db74;">'cdr'</span>)(cdr)

prim(<span style="color: #e6db74;">'sexp-print'</span>)(sexp_print)
prim(<span style="color: #e6db74;">'sexp-list-print'</span>)(sexp_list_print)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cb1777" class="outline-2">
<h2 id="org6cb1777"><b>string</b></h2>
<div class="outline-text-2" id="text-org6cb1777">
</div><div id="outline-container-orga34ff4a" class="outline-3">
<h3 id="orga34ff4a">String</h3>
<div class="outline-text-3" id="text-orga34ff4a">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'String'</span>)(<span style="color: #a6e22e;">str</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde6a276" class="outline-3">
<h3 id="orgde6a276">string_p</h3>
<div class="outline-text-3" id="text-orgde6a276">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'string?'</span>)(string_p)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfadec5" class="outline-3">
<h3 id="orgfadec5">string_print</h3>
<div class="outline-text-3" id="text-orgfadec5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-print'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_print</span>(string):
    p_print(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a87c7b" class="outline-3">
<h3 id="org2a87c7b">string_length</h3>
<div class="outline-text-3" id="text-org2a87c7b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string_length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_length</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ee043d" class="outline-3">
<h3 id="org2ee043d">string_ref</h3>
<div class="outline-text-3" id="text-org2ee043d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_ref</span>(string, index):
    <span style="color: #f92672; font-weight: bold;">return</span> string[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6e00fc" class="outline-3">
<h3 id="orgc6e00fc">string_append</h3>
<div class="outline-text-3" id="text-orgc6e00fc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_append</span>(string1, string2):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join([string1, string2])
</pre>
</div>
</div>
</div>

<div id="outline-container-orga83c320" class="outline-3">
<h3 id="orga83c320">string_slice</h3>
<div class="outline-text-3" id="text-orga83c320">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-slice'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_slice</span>(string, begin, end):
    <span style="color: #f92672; font-weight: bold;">return</span> string[begin:end]
</pre>
</div>
</div>
</div>

<div id="outline-container-org61e51" class="outline-3">
<h3 id="org61e51">string_empty_p</h3>
<div class="outline-text-3" id="text-org61e51">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-empty?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_empty_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(string) == 0
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c7e2fe" class="outline-3">
<h3 id="org9c7e2fe">string_eq_p</h3>
<div class="outline-text-3" id="text-org9c7e2fe">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-eq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_eq_p</span>(string1, string2):
    <span style="color: #f92672; font-weight: bold;">return</span> string1 == string2
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c4762f" class="outline-3">
<h3 id="org8c4762f">string_to_int</h3>
<div class="outline-text-3" id="text-org8c4762f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-&gt;int'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_to_int</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">int</span>(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge46e883" class="outline-3">
<h3 id="orge46e883">string predicates</h3>
<div class="outline-text-3" id="text-orge46e883">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'int-string?'</span>)(int_string_p)
prim(<span style="color: #e6db74;">'local-string?'</span>)(local_string_p)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc3f345c" class="outline-2">
<h2 id="orgc3f345c"><b>vect</b></h2>
<div class="outline-text-2" id="text-orgc3f345c">
</div><div id="outline-container-orge4dd4ae" class="outline-3">
<h3 id="orge4dd4ae"><span class="todo _note_">[note]</span> </h3>
<div class="outline-text-3" id="text-orge4dd4ae">
<ul class="org-ul">
<li><p>vect is the pivot among :</p><p><ul class="org-ul"></p><p><li><p>list</p></li></p><p><li><p>dict</p></li></p><p><li><p>tuple</p></li></p><p><li><p>set</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-org7ff54e5" class="outline-3">
<h3 id="org7ff54e5">vect_p</h3>
<div class="outline-text-3" id="text-org7ff54e5">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'vect?'</span>)(vect_p)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb88ba8" class="outline-3">
<h3 id="orgeb88ba8">vect_copy</h3>
<div class="outline-text-3" id="text-orgeb88ba8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-copy'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_copy</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> vect[:]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf373d67" class="outline-3">
<h3 id="orgf373d67">vect_member_p</h3>
<div class="outline-text-3" id="text-orgf373d67">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-member?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_member_p</span>(x, vect):
    <span style="color: #f92672; font-weight: bold;">return</span> x <span style="color: #f92672; font-weight: bold;">in</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgedc1142" class="outline-3">
<h3 id="orgedc1142">vect_to_sexp</h3>
<div class="outline-text-3" id="text-orgedc1142">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;sexp'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_sexp</span>(vect):
    <span style="color: #f92672; font-weight: bold;">if</span> vect == []:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #f92672; font-weight: bold;">not</span> vect_p(vect):
        <span style="color: #f92672; font-weight: bold;">return</span> vect
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(vect_to_sexp(vect[0]),
                    vect_to_sexp(vect[1:]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9420999" class="outline-3">
<h3 id="org9420999">vect_length</h3>
<div class="outline-text-3" id="text-org9420999">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_length</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org252f302" class="outline-3">
<h3 id="org252f302">vect_ref</h3>
<div class="outline-text-3" id="text-org252f302">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_ref</span>(vect, index):
    <span style="color: #f92672; font-weight: bold;">return</span> vect[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org43504c4" class="outline-3">
<h3 id="org43504c4">vect_append &#x2013; no-side-effect</h3>
<div class="outline-text-3" id="text-org43504c4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_append</span>(vect1, vect2):
    <span style="color: #fd971f;">vect1_copy</span> = vect_copy(vect1)
    vect1_copy.extend(vect2)
    <span style="color: #f92672; font-weight: bold;">return</span> vect1_copy
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc774244" class="outline-2">
<h2 id="orgc774244"><b>list</b></h2>
<div class="outline-text-2" id="text-orgc774244">
</div><div id="outline-container-org8761c50" class="outline-3">
<h3 id="org8761c50">Null &amp; Cons</h3>
<div class="outline-text-3" id="text-org8761c50">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'&lt;null&gt;'</span>)(Null)
prim(<span style="color: #e6db74;">'&lt;cons&gt;'</span>)(Cons)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb11826" class="outline-3">
<h3 id="orgbb11826">list_p</h3>
<div class="outline-text-3" id="text-orgbb11826">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> null_p(x) <span style="color: #f92672; font-weight: bold;">or</span> cons_p(x)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2230774" class="outline-3">
<h3 id="org2230774">vect_to_list</h3>
<div class="outline-text-3" id="text-org2230774">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;list'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_list</span>(vect):
    <span style="color: #f92672; font-weight: bold;">if</span> vect == []:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(vect[0], vect_to_list(vect[1:]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0a1407" class="outline-3">
<h3 id="orgc0a1407">list_to_vect</h3>
<div class="outline-text-3" id="text-orgc0a1407">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_to_vect</span>(l):
    <span style="color: #fd971f;">vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(l):
        vect.append(car(l))
        <span style="color: #fd971f;">l</span> = cdr(l)
    <span style="color: #f92672; font-weight: bold;">return</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org422e601" class="outline-3">
<h3 id="org422e601">list_length</h3>
<div class="outline-text-3" id="text-org422e601">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_length</span>(l):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
        <span style="color: #f92672; font-weight: bold;">return</span> 0
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> list_length(cdr(l)) + 1
</pre>
</div>
</div>
</div>

<div id="outline-container-org90847e6" class="outline-3">
<h3 id="org90847e6">list_ref</h3>
<div class="outline-text-3" id="text-org90847e6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_ref</span>(l, i):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- list_ref fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  index greater then length of list"</span>)
        error()
    <span style="color: #f92672; font-weight: bold;">elif</span> i == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> car(l)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> list_ref(cdr(l), i-1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb49a82e" class="outline-3">
<h3 id="orgb49a82e">list_append</h3>
<div class="outline-text-3" id="text-orgb49a82e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_append</span>(ante, succ):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(ante):
        <span style="color: #f92672; font-weight: bold;">return</span> succ
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(car(ante),
                    list_append(cdr (ante), succ))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5ea6d5" class="outline-3">
<h3 id="orgd5ea6d5">tail_cons</h3>
<div class="outline-text-3" id="text-orgd5ea6d5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tail_cons</span>(ante, value):
    <span style="color: #f92672; font-weight: bold;">return</span> list_append(ante, cons(value, null))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org56e2fe7" class="outline-2">
<h2 id="org56e2fe7"><b>dict</b></h2>
<div class="outline-text-2" id="text-org56e2fe7">
</div><div id="outline-container-org3b95ca9" class="outline-3">
<h3 id="org3b95ca9">Dict</h3>
<div class="outline-text-3" id="text-org3b95ca9">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Dict'</span>)(<span style="color: #a6e22e;">dict</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org37ef3a" class="outline-3">
<h3 id="org37ef3a">dict_p</h3>
<div class="outline-text-3" id="text-org37ef3a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">dict</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0fc63b" class="outline-3">
<h3 id="orgd0fc63b">dict_copy</h3>
<div class="outline-text-3" id="text-orgd0fc63b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-copy'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_copy</span>(d):
    <span style="color: #f92672; font-weight: bold;">return</span> d.copy()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgafba338" class="outline-3">
<h3 id="orgafba338">vect_to_dict</h3>
<div class="outline-text-3" id="text-orgafba338">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_dict</span>(vect):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(vect)
    <span style="color: #f92672; font-weight: bold;">if</span> length % 2 != 0:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- vect-&gt;dict fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of vect must be even"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  vect : {}"</span>.<span style="color: #a6e22e;">format</span>(vect))
        error()

    <span style="color: #fd971f;">d</span> = {}
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        <span style="color: #fd971f;">k</span> = vect[i]
        <span style="color: #fd971f;">v</span> = vect[i+1]
        <span style="color: #fd971f;">d</span>[k] = v
        <span style="color: #fd971f;">i</span> = i + 2

    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7b5471" class="outline-3">
<h3 id="orgf7b5471">dict_length</h3>
<div class="outline-text-3" id="text-orgf7b5471">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_length</span>(d):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(d)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3782057" class="outline-3">
<h3 id="org3782057">dict_find</h3>
<div class="outline-text-3" id="text-org3782057">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-find'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_find</span>(d, k):
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> VALUES(d[k], <span style="color: #ae81ff;">True</span>)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyError</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3859a0d" class="outline-3">
<h3 id="org3859a0d">dict_update &#x2013; no-side-effect</h3>
<div class="outline-text-3" id="text-org3859a0d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-update'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_update</span>(d1, d2):
    <span style="color: #fd971f;">d1</span> = dict_copy(d1)
    <span style="color: #f92672; font-weight: bold;">return</span> d1.update(d2)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2cd528" class="outline-3">
<h3 id="orgc2cd528">dict_delete &#x2013; no-side-effect</h3>
<div class="outline-text-3" id="text-orgc2cd528">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-delete'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_delete</span>(d, k):
    <span style="color: #fd971f;">d</span> = dict_copy(d)
    <span style="color: #f92672; font-weight: bold;">del</span> d[k]
    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge9f7c5c" class="outline-2">
<h2 id="orge9f7c5c"><b>tuple</b></h2>
<div class="outline-text-2" id="text-orge9f7c5c">
</div><div id="outline-container-org86e4860" class="outline-3">
<h3 id="org86e4860">Tuple</h3>
<div class="outline-text-3" id="text-org86e4860">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Tuple'</span>)(<span style="color: #a6e22e;">tuple</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8fe0d0b" class="outline-3">
<h3 id="org8fe0d0b">tuple_p</h3>
<div class="outline-text-3" id="text-org8fe0d0b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">tuple</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ac8b64" class="outline-3">
<h3 id="org2ac8b64">vect_to_tuple</h3>
<div class="outline-text-3" id="text-org2ac8b64">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;tuple'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_tuple</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgebf9978" class="outline-3">
<h3 id="orgebf9978">tuple_to_vect</h3>
<div class="outline-text-3" id="text-orgebf9978">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_to_vect</span>(tu):
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(tu)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b4c510" class="outline-3">
<h3 id="org4b4c510">tuple_length</h3>
<div class="outline-text-3" id="text-org4b4c510">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_length</span>(tu):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(tu)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeacbb24" class="outline-3">
<h3 id="orgeacbb24">tuple_ref</h3>
<div class="outline-text-3" id="text-orgeacbb24">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_ref</span>(tu, index):
    <span style="color: #f92672; font-weight: bold;">return</span> tu[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaba58ce" class="outline-3">
<h3 id="orgaba58ce">tuple_append</h3>
<div class="outline-text-3" id="text-orgaba58ce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_append</span>(tu1, tu2):
    <span style="color: #fd971f;">vect1</span> = Vect(tu1)
    vect1.extend(tu2)
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(vect1)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf2740e4" class="outline-2">
<h2 id="orgf2740e4"><b>set</b></h2>
<div class="outline-text-2" id="text-orgf2740e4">
</div><div id="outline-container-org791e31d" class="outline-3">
<h3 id="org791e31d">Set</h3>
<div class="outline-text-3" id="text-org791e31d">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Set'</span>)(<span style="color: #a6e22e;">set</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7269592" class="outline-3">
<h3 id="org7269592">set_p</h3>
<div class="outline-text-3" id="text-org7269592">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">set</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6eb173c" class="outline-3">
<h3 id="org6eb173c">vect_to_set</h3>
<div class="outline-text-3" id="text-org6eb173c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;set'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_set</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">set</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org63fbe18" class="outline-3">
<h3 id="org63fbe18">set_to_vect</h3>
<div class="outline-text-3" id="text-org63fbe18">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_to_vect</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-org38f210b" class="outline-3">
<h3 id="org38f210b">set_length</h3>
<div class="outline-text-3" id="text-org38f210b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_length</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ab4ed9" class="outline-3">
<h3 id="org8ab4ed9">set_member_p</h3>
<div class="outline-text-3" id="text-org8ab4ed9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-member?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_member_p</span>(x, s):
    <span style="color: #f92672; font-weight: bold;">return</span> x <span style="color: #f92672; font-weight: bold;">in</span> s
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b99225" class="outline-3">
<h3 id="org2b99225">high school</h3>
<div class="outline-text-3" id="text-org2b99225">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-disjoint?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_disjoint_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.isdisjoint(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-subset?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_subset_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.issubset(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-superset?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_superset_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.issuperset(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-union'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_union</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.union(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-intersection'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_intersection</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.intersection(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-difference'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_difference</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.difference(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-symmetric-difference'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_symmetric_difference</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.symmetric_difference(s2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb2a7c30" class="outline-2">
<h2 id="orgb2a7c30"><b>io</b></h2>
<div class="outline-text-2" id="text-orgb2a7c30">
</div><div id="outline-container-orgd79b785" class="outline-3">
<h3 id="orgd79b785">print</h3>
<div class="outline-text-3" id="text-orgd79b785">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'print'</span>)(p_print)
</pre>
</div>
</div>
</div>

<div id="outline-container-org20ddce3" class="outline-3">
<h3 id="org20ddce3">nl &#x2013; newline</h3>
<div class="outline-text-3" id="text-org20ddce3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'newline'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">newline</span>():
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">""</span>)

prim(<span style="color: #e6db74;">'nl'</span>)(newline)
</pre>
</div>
</div>
</div>

<div id="outline-container-org13bb2e8" class="outline-3">
<h3 id="org13bb2e8">space</h3>
<div class="outline-text-3" id="text-org13bb2e8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'space'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">space</span>():
    p_print(<span style="color: #e6db74;">" "</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgba2f506" class="outline-2">
<h2 id="orgba2f506"><b>sys</b></h2>
<div class="outline-text-2" id="text-orgba2f506">
</div><div id="outline-container-orgd8b4882" class="outline-3">
<h3 id="orgd8b4882">bye</h3>
<div class="outline-text-3" id="text-orgd8b4882">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'bye'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">bye</span>():
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"bye bye ^-^/"</span>)
    sys.<span style="color: #ae81ff;">exit</span>()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org82aebbb" class="outline-2">
<h2 id="org82aebbb"><b>repl</b></h2>
<div class="outline-text-2" id="text-org82aebbb">
</div><div id="outline-container-org8f982cd" class="outline-3">
<h3 id="org8f982cd">read_sexp</h3>
<div class="outline-text-3" id="text-org8f982cd">
</div><div id="outline-container-org1764271" class="outline-4">
<h4 id="org1764271">read_char</h4>
<div class="outline-text-4" id="text-org1764271">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_char</span>(char_stack):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(char_stack) == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> sys.stdin.read(1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> char_stack.pop()
</pre>
</div>
</div>
</div>

<div id="outline-container-org8cd4629" class="outline-4">
<h4 id="org8cd4629">read_string</h4>
<div class="outline-text-4" id="text-org8cd4629">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_string</span>(char_stack):
    <span style="color: #fd971f;">char_vect</span> = []
    <span style="color: #fd971f;">collecting_bytes_p</span> = <span style="color: #ae81ff;">False</span>

    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
        <span style="color: #fd971f;">char</span> = read_char(char_stack)
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> collecting_bytes_p:
            <span style="color: #f92672; font-weight: bold;">if</span> space_p(char):
                <span style="color: #f92672; font-weight: bold;">pass</span>
            <span style="color: #f92672; font-weight: bold;">elif</span> doublequote_p(char):
                <span style="color: #f92672; font-weight: bold;">return</span> read_doublequoted_string(char_stack)
            <span style="color: #f92672; font-weight: bold;">elif</span> delimiter_p(char):
                char_vect.append(char)
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                char_vect.append(char)
                <span style="color: #fd971f;">collecting_bytes_p</span> = <span style="color: #ae81ff;">True</span>

        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">if</span> (doublequote_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
                delimiter_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
                space_p(char)):
                char_stack.append(char)
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                char_vect.append(char)

    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join(char_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ab8750" class="outline-4">
<h4 id="org3ab8750">read_doublequoted_string</h4>
<div class="outline-text-4" id="text-org3ab8750">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_doublequoted_string</span>(char_stack):
    <span style="color: #fd971f;">char_vect</span> = []
    char_vect.append(<span style="color: #e6db74;">'"'</span>)
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
        <span style="color: #fd971f;">char</span> = read_char(char_stack)
        <span style="color: #f92672; font-weight: bold;">if</span> char == <span style="color: #e6db74;">'"'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            char_vect.append(char)
    char_vect.append(<span style="color: #e6db74;">'"'</span>)
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join(char_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org645a771" class="outline-4">
<h4 id="org645a771">read_sexp</h4>
<div class="outline-text-4" id="text-org645a771">
<ul class="org-ul">
<li><p>with a char_stack,</p><p>read a sexp from stdin.</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_sexp</span>(char_stack):
    <span style="color: #fd971f;">string</span> = read_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> string == <span style="color: #e6db74;">'('</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">')'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_list
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'['</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">']'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'begin'</span>, sexp_list)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'{'</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">'}'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'clo'</span>, sexp_list)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> read_doublequoted_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"'"</span>:
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'quote'</span>, cons(sexp, null))
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"`"</span>:
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'partquote'</span>, cons(sexp, null))
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> string
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe0bc8d" class="outline-4">
<h4 id="orgbe0bc8d">read_sexp_list_until_ket</h4>
<div class="outline-text-4" id="text-orgbe0bc8d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_sexp_list_until_ket</span>(char_stack, ket):
    <span style="color: #fd971f;">string</span> = read_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> string == ket:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">char_vect</span> = Vect(string)
        char_vect.reverse()
        char_stack.extend(char_vect)
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #fd971f;">recur</span> = read_sexp_list_until_ket(char_stack, ket)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(sexp, recur)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3ec1d4a" class="outline-3">
<h3 id="org3ec1d4a">print_data_stack</h3>
<div class="outline-text-3" id="text-org3ec1d4a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">print_data_stack</span>(ds):
    p_print(<span style="color: #e6db74;">"  * {} *  "</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(ds)))
    <span style="color: #f92672; font-weight: bold;">print</span>(ds)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfea00e" class="outline-3">
<h3 id="orgdfea00e">print_return_stack</h3>
<div class="outline-text-3" id="text-orgdfea00e">
</div><div id="outline-container-org61227d2" class="outline-4">
<h4 id="org61227d2">print_return_stack</h4>
<div class="outline-text-4" id="text-org61227d2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">print_return_stack</span>(rs):
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- return-stack * {} *"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(rs)))
    <span style="color: #f92672; font-weight: bold;">for</span> rp <span style="color: #f92672; font-weight: bold;">in</span> rs:
        return_point_print(rp)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd970565" class="outline-4">
<h4 id="orgd970565">return_point_print</h4>
<div class="outline-text-4" id="text-orgd970565">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">return_point_print</span>(rp):
    p_print(<span style="color: #e6db74;">"  - progress : {} / {}"</span>.<span style="color: #a6e22e;">format</span>(rp.cursor, rp.length))
    newline()

    <span style="color: #fd971f;">next_cursor</span> = rp.cursor
    <span style="color: #fd971f;">last_cursor</span> = rp.cursor - 1

    <span style="color: #f92672; font-weight: bold;">if</span> last_cursor == 0:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(<span style="color: #e6db74;">"    pass : "</span>)
        <span style="color: #fd971f;">i</span> = 0
        <span style="color: #f92672; font-weight: bold;">while</span> i &lt; last_cursor:
            jo_print(rp.body[i])
            space()
            <span style="color: #fd971f;">i</span> = i + 1
        newline()

    p_print(<span style="color: #e6db74;">"    last : "</span>)
    jo_print(rp.body[last_cursor])
    newline()

    <span style="color: #f92672; font-weight: bold;">if</span> next_cursor == rp.length:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(<span style="color: #e6db74;">"    next : "</span>)
        <span style="color: #fd971f;">i</span> = next_cursor
        <span style="color: #f92672; font-weight: bold;">while</span> i &lt; rp.length:
            jo_print(rp.body[i])
            space()
            <span style="color: #fd971f;">i</span> = i + 1
        newline()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(rp.lr) == 0:
       <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
       p_print(<span style="color: #e6db74;">"    where : {}"</span>.<span style="color: #a6e22e;">format</span>(rp.lr))
       newline()
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e5d163" class="outline-4">
<h4 id="org6e5d163">jo_print</h4>
<div class="outline-text-4" id="text-org6e5d163">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(jo):
    <span style="color: #f92672; font-weight: bold;">if</span> fun_p(jo):
        p_print(jo.__module__)
        p_print(<span style="color: #e6db74;">"."</span>)
        p_print(jo.<span style="color: #a6e22e;">__name__</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">hasattr</span>(jo, <span style="color: #e6db74;">"jo_print"</span>):
        jo.jo_print()
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(jo)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3721a71" class="outline-3">
<h3 id="org3721a71">module_repl</h3>
<div class="outline-text-3" id="text-org3721a71">
</div><div id="outline-container-org56ba90d" class="outline-4">
<h4 id="org56ba90d"><span class="todo _note_">[note]</span> </h4>
<div class="outline-text-4" id="text-org56ba90d">
<ul class="org-ul">
<li><p>a repl_char_stack is added to the module,</p><p>for reading sexp one by one.</p></li></ul>
</div>
</div>

<div id="outline-container-org5e9c2fb" class="outline-4">
<h4 id="org5e9c2fb">module_repl</h4>
<div class="outline-text-4" id="text-org5e9c2fb">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_repl</span>(module):
    <span style="color: #fd971f;">module.repl_char_stack</span> = []
    print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            module_repl_one_step(module)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyboardInterrupt</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">except</span> EXIT_MODULE_REPL:
        <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5101ed" class="outline-4">
<h4 id="orgb5101ed">EXIT_MODULE_REPL</h4>
<div class="outline-text-4" id="text-orgb5101ed">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">EXIT_MODULE_REPL</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd274a49" class="outline-4">
<h4 id="orgd274a49">module_repl_one_step</h4>
<div class="outline-text-4" id="text-orgd274a49">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_repl_one_step</span>(module):
    <span style="color: #fd971f;">sexp</span> = read_sexp(module.repl_char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'exit'</span>:
        <span style="color: #f92672; font-weight: bold;">raise</span> EXIT_MODULE_REPL()
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">try</span>:
            merge_sexp_vect(module, [sexp])
            print_data_stack(module.vm.ds)
        <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">SystemExit</span>:
            sys.<span style="color: #ae81ff;">exit</span>()
        <span style="color: #f92672; font-weight: bold;">except</span>:
            <span style="color: #fd971f;">error_type</span> = sys.exc_info()[0]
            <span style="color: #fd971f;">error_name</span> = error_type.<span style="color: #a6e22e;">__name__</span>
            <span style="color: #fd971f;">error_info</span> = sys.exc_info()[1]
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- error : {}"</span>.<span style="color: #a6e22e;">format</span>(error_name))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  info : {}"</span>.<span style="color: #a6e22e;">format</span>(error_info))
            call_module_debug(module, 1)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb14ed08" class="outline-2">
<h2 id="orgb14ed08"><b>error</b></h2>
<div class="outline-text-2" id="text-orgb14ed08">
</div><div id="outline-container-org78d6a5d" class="outline-3">
<h3 id="org78d6a5d">error</h3>
<div class="outline-text-3" id="text-org78d6a5d">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'error'</span>)(error)
</pre>
</div>
</div>
</div>

<div id="outline-container-orged27ff7" class="outline-3">
<h3 id="orged27ff7">module_debug</h3>
<div class="outline-text-3" id="text-orged27ff7">
</div><div id="outline-container-orgaa3531" class="outline-4">
<h4 id="orgaa3531">module_debug</h4>
<div class="outline-text-4" id="text-orgaa3531">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'module-debug'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_debug</span>(module, level):
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- enter debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
    <span style="color: #fd971f;">module.debug_repl_char_stack</span> = []
    print_return_stack(module.vm.rs)
    print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            module_debug_one_step(module, level)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyboardInterrupt</span>:
        <span style="color: #fd971f;">module.vm.ds</span> = []
        <span style="color: #fd971f;">module.vm.rs</span> = []
        newline()
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exit debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data-stack and return-stack are cleared"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  for module : {}"</span>.<span style="color: #a6e22e;">format</span>(module.<span style="color: #a6e22e;">__name__</span>))
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">except</span> EXIT_MODULE_DEBUG_REPL:
        <span style="color: #fd971f;">module.vm.ds</span> = []
        <span style="color: #fd971f;">module.vm.rs</span> = []
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exit debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data-stack and return-stack is cleared"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  for module : {}"</span>.<span style="color: #a6e22e;">format</span>(module.<span style="color: #a6e22e;">__name__</span>))
        <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org28fac5f" class="outline-4">
<h4 id="org28fac5f">EXIT_MODULE_DEBUG_REPL</h4>
<div class="outline-text-4" id="text-org28fac5f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">EXIT_MODULE_DEBUG_REPL</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3c3aa7" class="outline-4">
<h4 id="orgd3c3aa7">module_debug_one_step</h4>
<div class="outline-text-4" id="text-orgd3c3aa7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_debug_one_step</span>(module, level):
    p_print(<span style="color: #e6db74;">"debug[{}]&gt; "</span>.<span style="color: #a6e22e;">format</span>(level))
    sys.stdout.flush()
    <span style="color: #fd971f;">sexp</span> = read_sexp(module.debug_repl_char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'exit'</span>:
        <span style="color: #f92672; font-weight: bold;">raise</span> EXIT_MODULE_DEBUG_REPL()
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">try</span>:
            merge_sexp_vect(module, [sexp])
            print_data_stack(module.vm.ds)
        <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">SystemExit</span>:
            sys.<span style="color: #ae81ff;">exit</span>()
        <span style="color: #f92672; font-weight: bold;">except</span>:
            <span style="color: #fd971f;">error_type</span> = sys.exc_info()[0]
            <span style="color: #fd971f;">error_name</span> = error_type.<span style="color: #a6e22e;">__name__</span>
            <span style="color: #fd971f;">error_info</span> = sys.exc_info()[1]
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- error : {}"</span>.<span style="color: #a6e22e;">format</span>(error_name))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  info : {}"</span>.<span style="color: #a6e22e;">format</span>(error_info))
            call_module_debug(module, level + 1)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8c15499" class="outline-3">
<h3 id="org8c15499">call_module_debug</h3>
<div class="outline-text-3" id="text-org8c15499">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">call_module_debug</span>(module, level):
    <span style="color: #fd971f;">jojo</span> = JOJO([module, level, module_debug, nop])
    module.vm.rs.append(RP(jojo))
    module.vm.exe()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org773c1c0" class="outline-2">
<h2 id="org773c1c0"><b>object</b></h2>
<div class="outline-text-2" id="text-org773c1c0">
</div><div id="outline-container-orgebac578" class="outline-3">
<h3 id="orgebac578">Object</h3>
<div class="outline-text-3" id="text-orgebac578">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Object'</span>)(<span style="color: #a6e22e;">object</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9df14ff" class="outline-2">
<h2 id="org9df14ff"><b>class</b></h2>
<div class="outline-text-2" id="text-org9df14ff">
</div><div id="outline-container-org2c8ccd9" class="outline-3">
<h3 id="org2c8ccd9">value_to_class</h3>
<div class="outline-text-3" id="text-org2c8ccd9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'value-&gt;class'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">value_to_class</span>(value):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(value)
</pre>
</div>
</div>
</div>

<div id="outline-container-org381722d" class="outline-3">
<h3 id="org381722d">subclass_p</h3>
<div class="outline-text-3" id="text-org381722d">
<ul class="org-ul">
<li><p>treat UNION specially</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'subclass?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">subclass_p</span>(c1, c2):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(c2) == UNION:
       <span style="color: #f92672; font-weight: bold;">return</span> c1 <span style="color: #f92672; font-weight: bold;">in</span> c2.get_type_vect()
    <span style="color: #f92672; font-weight: bold;">else</span>:
       <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">issubclass</span>(c1, c2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge812665" class="outline-2">
<h2 id="orge812665"><b>misc</b></h2>
<div class="outline-text-2" id="text-orge812665">
</div><div id="outline-container-orgc9089bf" class="outline-3">
<h3 id="orgc9089bf">nop</h3>
<div class="outline-text-3" id="text-orgc9089bf">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'nop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">nop</span>():
    <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge2a6aea" class="outline-2">
<h2 id="orge2a6aea">------</h2>
</div>
<div id="outline-container-org11d7b6f" class="outline-2">
<h2 id="org11d7b6f">keyword_dict</h2>
<div class="outline-text-2" id="text-org11d7b6f">
</div><div id="outline-container-org713581e" class="outline-3">
<h3 id="org713581e"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-org713581e">
<ul class="org-ul">
<li><p>keyword : (-&gt; module, body &#x2013; jo vect)</p></li></ul>
</div>
</div>

<div id="outline-container-orga7b242f" class="outline-3">
<h3 id="orga7b242f">keyword_dict</h3>
<div class="outline-text-3" id="text-orga7b242f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">keyword_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org75f8702" class="outline-3">
<h3 id="org75f8702">@keyword</h3>
<div class="outline-text-3" id="text-org75f8702">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">keyword</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">keyword_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbabbbc0" class="outline-3">
<h3 id="orgbabbbc0">(note)</h3>
<div class="outline-text-3" id="text-orgbabbbc0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"note"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_note</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org792925d" class="outline-3">
<h3 id="org792925d">(begin)</h3>
<div class="outline-text-3" id="text-org792925d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'begin'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_begin</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> sexp_list_emit(module, body)
</pre>
</div>
</div>
</div>

<div id="outline-container-org28df0d" class="outline-3">
<h3 id="org28df0d">(clo)</h3>
<div class="outline-text-3" id="text-org28df0d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'clo'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_clo</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> [CLO(sexp_list_emit(module, body))]
</pre>
</div>
</div>
</div>

<div id="outline-container-org41dc3f3" class="outline-3">
<h3 id="org41dc3f3">(quote)</h3>
<div class="outline-text-3" id="text-org41dc3f3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'quote'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_quote</span>(module, body):
    <span style="color: #fd971f;">jo_vect</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org7fdee02" class="outline-3">
<h3 id="org7fdee02">(partquote)</h3>
<div class="outline-text-3" id="text-org7fdee02">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'partquote'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_partquote</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        jo_vect.extend(k_partquote_one(module, sexp))
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_partquote_one</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> cons_p(sexp):
        <span style="color: #f92672; font-weight: bold;">if</span> car(sexp) == <span style="color: #e6db74;">'@'</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> sexp_list_emit(module, cdr(sexp))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">jo_vect</span> = []
            jo_vect.extend([MARK])
            jo_vect.extend(k_partquote(module, sexp))
            jo_vect.extend([COLLECT_LIST])
            <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> [sexp]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgace856" class="outline-3">
<h3 id="orgace856">(-&gt;)</h3>
<div class="outline-text-3" id="text-orgace856">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'-&gt;'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_arrow</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> local_string_p(sexp):
            jo_vect.append(SET(sexp))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    jo_vect.reverse()
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c5abc0" class="outline-3">
<h3 id="org4c5abc0">(list)</h3>
<div class="outline-text-3" id="text-org4c5abc0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'list'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_list</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_LIST])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb513485" class="outline-3">
<h3 id="orgb513485">(vect)</h3>
<div class="outline-text-3" id="text-orgb513485">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_vect</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4e0061" class="outline-3">
<h3 id="orgb4e0061">(dict)</h3>
<div class="outline-text-3" id="text-orgb4e0061">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_dict</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_dict])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8d8e10" class="outline-3">
<h3 id="orge8d8e10">(tuple)</h3>
<div class="outline-text-3" id="text-orge8d8e10">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'tuple'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_tuple</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_tuple])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect

keyword(<span style="color: #e6db74;">'*'</span>)(k_tuple)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a3cc86" class="outline-3">
<h3 id="org5a3cc86">(set)</h3>
<div class="outline-text-3" id="text-org5a3cc86">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'set'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_set</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_set])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga53eba9" class="outline-2">
<h2 id="orga53eba9">top_level_keywordm</h2>
<div class="outline-text-2" id="text-orga53eba9">
</div><div id="outline-container-org9e9b566" class="outline-3">
<h3 id="org9e9b566">(import)</h3>
<div class="outline-text-3" id="text-org9e9b566">
</div><div id="outline-container-org362b046" class="outline-4">
<h4 id="org362b046">k_import</h4>
<div class="outline-text-4" id="text-org362b046">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"import"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import</span>(module, body):
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(body)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        k_import_as(module, body)
        <span style="color: #f92672; font-weight: bold;">return</span> []

    <span style="color: #f92672; font-weight: bold;">if</span> null_p(body):
        <span style="color: #f92672; font-weight: bold;">return</span> []

    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'.'</span> <span style="color: #f92672; font-weight: bold;">in</span> name:
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (import) syntax error"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  module name can not contain '.'"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  module name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
            p_print(<span style="color: #e6db74;">"  import body : "</span>)
            sexp_list_print(body)
            newline()
            error()

    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        k_import_one(module, name)

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orge7eebad" class="outline-4">
<h4 id="orge7eebad">k_import_one</h4>
<div class="outline-text-4" id="text-orge7eebad">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import_one</span>(module, name):
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(name)
    jojo_define(module, name, imported_module)
</pre>
</div>
</div>
</div>

<div id="outline-container-org141ea6b" class="outline-4">
<h4 id="org141ea6b">k_import_as</h4>
<div class="outline-text-4" id="text-org141ea6b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import_as</span>(module, body):
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #a6e22e;">len</span>(name_vect) != 3 <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[0] == <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[1] != <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[2] == <span style="color: #e6db74;">'as'</span>):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (import) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  syntax for (import as) should be :"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  (import &lt;module-name&gt; as &lt;name&gt;)"</span>)
        p_print(<span style="color: #e6db74;">"  import body : "</span>)
        sexp_list_print(body)
        newline()
        error()
    <span style="color: #fd971f;">name</span> = name_vect[0]
    <span style="color: #fd971f;">as_name</span> = name_vect[2]
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(name)
    jojo_define(module, as_name, imported_module)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1360565" class="outline-3">
<h3 id="org1360565">(from)</h3>
<div class="outline-text-3" id="text-org1360565">
</div><div id="outline-container-orgf78df0f" class="outline-4">
<h4 id="orgf78df0f">k_from</h4>
<div class="outline-text-4" id="text-orgf78df0f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"from"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from</span>(module, body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">in</span> vect_body:
        k_from_as(module, body)
        <span style="color: #f92672; font-weight: bold;">return</span> []

    k_from_syntax_check(body)
    <span style="color: #fd971f;">module_name</span> = car(body)
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(cdr(cdr(body)))
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(module_name)
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        jojo_define(module, name, <span style="color: #a6e22e;">getattr</span>(imported_module, name))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org526cb0b" class="outline-4">
<h4 id="org526cb0b">k_from_syntax_check</h4>
<div class="outline-text-4" id="text-org526cb0b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_syntax_check</span>(body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vect_body) &gt; 2:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[1] == <span style="color: #e6db74;">'import'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (from) syntax error"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  syntax for (from import) should be :"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  (from &lt;module-name&gt; import &lt;name&gt; ...)"</span>)
    p_print(<span style="color: #e6db74;">"  import body : "</span>)
    sexp_list_print(body)
    newline()
    error()
</pre>
</div>
</div>
</div>

<div id="outline-container-org65cf7ef" class="outline-4">
<h4 id="org65cf7ef">k_from_as</h4>
<div class="outline-text-4" id="text-org65cf7ef">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_as</span>(module, body):
    k_from_as_syntax_check(body)
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #fd971f;">module_name</span> = vect_body[0]
    <span style="color: #fd971f;">name</span> = vect_body[2]
    <span style="color: #fd971f;">as_name</span> = vect_body[4]
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(module_name)
    jojo_define(module, as_name, <span style="color: #a6e22e;">getattr</span>(imported_module, name))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3dbc81b" class="outline-4">
<h4 id="org3dbc81b">k_from_as_syntax_check</h4>
<div class="outline-text-4" id="text-org3dbc81b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_as_syntax_check</span>(body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vect_body) == 5:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[1] == <span style="color: #e6db74;">'import'</span>:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[3] == <span style="color: #e6db74;">'as'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (from) syntax error"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  syntax for (from import as) should be :"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  (from &lt;module-name&gt; import &lt;name&gt; as &lt;name&gt;)"</span>)
    p_print(<span style="color: #e6db74;">"  import body : "</span>)
    sexp_list_print(body)
    newline()
    error()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e35a7f" class="outline-3">
<h3 id="org9e35a7f">(+jojo)</h3>
<div class="outline-text-3" id="text-org9e35a7f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+jojo"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_jojo</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">if</span> list_length(body) == 0:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+jojo) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body of (+jojo) can not be empty"</span>)
        error()

    <span style="color: #fd971f;">jojo_name</span> = car(body)
    <span style="color: #a6e22e;">setattr</span>(module, jojo_name,
            JOJO(sexp_list_emit(module, cdr(body))))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a45c93" class="outline-3">
<h3 id="org3a45c93">(+data)</h3>
<div class="outline-text-3" id="text-org3a45c93">
</div><div id="outline-container-org54ab32f" class="outline-4">
<h4 id="org54ab32f">plus_data</h4>
<div class="outline-text-4" id="text-org54ab32f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+data"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_data</span>(module, body):
    <span style="color: #fd971f;">data_name</span> = car(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> data_name_string_p(data_name):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+data) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data_name must be of form &lt;...&gt;"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data_name : {}"</span>.<span style="color: #a6e22e;">format</span>(data_name))
        error()

    <span style="color: #fd971f;">field_name_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> string <span style="color: #f92672; font-weight: bold;">in</span> list_to_vect(cdr(body)):
        <span style="color: #f92672; font-weight: bold;">if</span> message_string_p(string):
            <span style="color: #fd971f;">string</span> = string[1:]
            field_name_vect.append(string)

    <span style="color: #fd971f;">data_class</span> = create_data_class(data_name, field_name_vect)
    <span style="color: #fd971f;">data_class.__module__</span> = module

    jojo_define(module, data_name, data_class)

    <span style="color: #fd971f;">constructor_name</span> = data_name[1:-1]
    jojo_define(module, constructor_name, JOJO([data_class, NEW]))

    <span style="color: #fd971f;">predicate_name</span> = <span style="color: #e6db74;">""</span>.join([constructor_name, <span style="color: #e6db74;">"?"</span>])
    jojo_define(module, predicate_name, DATA_PRED(data_class))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f0e614" class="outline-4">
<h4 id="org8f0e614">data_name_string_p</h4>
<div class="outline-text-4" id="text-org8f0e614">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">data_name_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3: <span style="color: #FF8888;"># </span><span style="color: #FF8888;">example : '&lt;n&gt;'</span>
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'&lt;'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'&gt;'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'&lt;'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'&gt;'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccedc8b" class="outline-4">
<h4 id="orgccedc8b">JOJO_DATA</h4>
<div class="outline-text-4" id="text-orgccedc8b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO_DATA</span>:
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fa3f7b" class="outline-4">
<h4 id="org6fa3f7b">create_data_class</h4>
<div class="outline-text-4" id="text-org6fa3f7b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">create_data_class</span>(data_name, field_name_vect):
    <span style="color: #fd971f;">rev</span> = vect_copy(field_name_vect)
    rev.reverse()
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">init</span>(<span style="color: #f92672; font-weight: bold;">self</span>, kwargs):
        <span style="color: #f92672; font-weight: bold;">self</span>.__dict__.update(kwargs)
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">update_ns</span>(ns):
        ns.update({
            <span style="color: #e6db74;">'__init__'</span> : init,
            <span style="color: #e6db74;">'field_name_vect'</span>: field_name_vect,
            <span style="color: #e6db74;">'reversed_field_name_vect'</span>: rev,
        })
    <span style="color: #f92672; font-weight: bold;">return</span> types.new_class(
        data_name,
        bases = (JOJO_DATA, ),
        kwds = <span style="color: #ae81ff;">None</span>,
        exec_body = update_ns)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfc7d703" class="outline-3">
<h3 id="orgfc7d703">(+union)</h3>
<div class="outline-text-3" id="text-orgfc7d703">
</div><div id="outline-container-org9a0f46a" class="outline-4">
<h4 id="org9a0f46a">plus_union</h4>
<div class="outline-text-4" id="text-org9a0f46a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+union"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_union</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, rest)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    jojo_define(module, name, UNION(jojo))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad1e133" class="outline-4">
<h4 id="orgad1e133">UNION</h4>
<div class="outline-text-4" id="text-orgad1e133">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">UNION</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.jojo = jojo

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_type_vect</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #fd971f;">vm</span> = VM([], [RP(<span style="color: #f92672; font-weight: bold;">self</span>.jojo)])
        vm.exe()
        <span style="color: #f92672; font-weight: bold;">return</span> vm.ds
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga160433" class="outline-3">
<h3 id="orga160433"><span class="todo _note_">[note]</span> gene and disp</h3>
<div class="outline-text-3" id="text-orga160433">
<ul class="org-ul">
<li><p>a gene in a module maintains a dict</p><p>form tuple of type to disp</p></li>

<li><p><p></p><p>suppose</p><p></p></p><p></p><p><p></p><p>in module m1 we have (+gene g1 &#x2026;)</p><p></p></p><p></p><p><p></p><p>in module m2 we (import m1) and</p><p>(+disp m1.g1 &#x2026;) for data in m2</p><p></p></p><p></p><p><p></p><p>this means the the global state g1 of module m1</p><p>can be changed by module m2</p><p></p></p></li>

<li><p>in such a hopelessly dynamic language,</p><p>this is the only place we make use of the dynamic type.</p></li></ul>
</div>
</div>

<div id="outline-container-org4ca7d46" class="outline-3">
<h3 id="org4ca7d46">(+gene)</h3>
<div class="outline-text-3" id="text-org4ca7d46">
</div><div id="outline-container-org5a96483" class="outline-4">
<h4 id="org5a96483">plus_gene</h4>
<div class="outline-text-4" id="text-org5a96483">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+gene"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_gene</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">arrow</span> = car(rest)
    <span style="color: #fd971f;">arity</span> = arrow_get_arity(arrow)
    <span style="color: #f92672; font-weight: bold;">if</span> arity == 0:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+gene) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  arity of arrow is zero"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  gene dispatches on types of arguments"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  can not define gene over nothing"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        p_print(<span style="color: #e6db74;">"  arrow : "</span>)
        sexp_print(arrow)
        newline()
        error()

    <span style="color: #fd971f;">default_jojo</span> = JOJO(sexp_list_emit(module, rest))
    jojo_define(module, name, GENE(arity, default_jojo))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org206a825" class="outline-4">
<h4 id="org206a825">arrow_get_arity</h4>
<div class="outline-text-4" id="text-org206a825">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_arity</span>(arrow):
    <span style="color: #fd971f;">arity</span> = 0
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(cdr(arrow))
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> local_string_p(sexp):
            <span style="color: #fd971f;">arity</span> = arity + 1
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">pass</span>

    <span style="color: #f92672; font-weight: bold;">return</span> arity
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgca1748e" class="outline-3">
<h3 id="orgca1748e">(+disp)</h3>
<div class="outline-text-3" id="text-orgca1748e">
</div><div id="outline-container-org1d132a7" class="outline-4">
<h4 id="org1d132a7">plus_disp</h4>
<div class="outline-text-4" id="text-org1d132a7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+disp"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_disp</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">arrow</span> = car(rest)
    <span style="color: #fd971f;">type_tuple_vect</span> = arrow_get_type_tuple_vect(module, arrow)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">hasattr</span>(module, name):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+disp) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name is undefined"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        error()

    <span style="color: #fd971f;">gene</span> = <span style="color: #a6e22e;">getattr</span>(module, name)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(gene) != GENE:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+disp) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type of name must be a gene"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type of name : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">type</span>(name)))
        error()

    <span style="color: #fd971f;">jojo</span> = JOJO(sexp_list_emit(module, rest))
    <span style="color: #f92672; font-weight: bold;">for</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> type_tuple_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> gene.disp_dict:
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+disp) fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type_tuple for gene is already defined"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type_tuple : {}"</span>.<span style="color: #a6e22e;">format</span>(type_tuple))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  gene name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
            p_print(<span style="color: #e6db74;">"  arrow : "</span>)
            sexp_print(arrow)
            newline()
            error()
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">gene.disp_dict</span>[type_tuple] = jojo

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org81c74f7" class="outline-4">
<h4 id="org81c74f7">arrow_get_type_vect</h4>
<div class="outline-text-4" id="text-org81c74f7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_type_vect</span>(module, arrow):
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(cdr(arrow))
    <span style="color: #fd971f;">new_sexp_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> local_string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            new_sexp_vect.append(sexp)

    <span style="color: #fd971f;">new_sexp_list</span> = vect_to_list(new_sexp_vect)
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, new_sexp_list)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    <span style="color: #fd971f;">vm</span> = VM([], [RP(jojo)])
    vm.exe()

    <span style="color: #f92672; font-weight: bold;">return</span> vm.ds
</pre>
</div>
</div>
</div>

<div id="outline-container-org99eff15" class="outline-4">
<h4 id="org99eff15">type_vect_to_type_vect_vect</h4>
<div class="outline-text-4" id="text-org99eff15">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">type_vect_to_type_vect_vect</span>(type_vect):
    <span style="color: #fd971f;">type_vect_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> t <span style="color: #f92672; font-weight: bold;">in</span> type_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(t) == UNION:
            type_vect_vect.append(t.get_type_vect())
        <span style="color: #f92672; font-weight: bold;">else</span>:
            type_vect_vect.append([t])

    <span style="color: #f92672; font-weight: bold;">return</span> type_vect_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7ef3bf" class="outline-4">
<h4 id="orgf7ef3bf">arrow_get_type_tuple_vect</h4>
<div class="outline-text-4" id="text-orgf7ef3bf">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_type_tuple_vect</span>(module, arrow):
    <span style="color: #fd971f;">type_vect</span> = arrow_get_type_vect(module, arrow)
    <span style="color: #fd971f;">type_vect_vect</span> = type_vect_to_type_vect_vect(type_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(itertools.product(*type_vect_vect))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org122f325" class="outline-2">
<h2 id="org122f325">key_jo_dict</h2>
<div class="outline-text-2" id="text-org122f325">
</div><div id="outline-container-org6dcb770" class="outline-3">
<h3 id="org6dcb770"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-org6dcb770">
<ul class="org-ul">
<li><p>keyword : (-&gt; module &#x2013; jo vect)</p></li></ul>
</div>
</div>

<div id="outline-container-orgb7f11d" class="outline-3">
<h3 id="orgb7f11d">key_jo_dict</h3>
<div class="outline-text-3" id="text-orgb7f11d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">key_jo_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e1ee0e" class="outline-3">
<h3 id="org7e1ee0e">key_jo</h3>
<div class="outline-text-3" id="text-org7e1ee0e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">key_jo</span>(name, jo_vect):
    <span style="color: #fd971f;">key_jo_dict</span>[name] = jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb246b5" class="outline-3">
<h3 id="orgb246b5">key_jo s</h3>
<div class="outline-text-3" id="text-orgb246b5">
<div class="org-src-container">

<pre class="src src-python">key_jo(<span style="color: #e6db74;">'apply'</span>, [APPLY])
key_jo(<span style="color: #e6db74;">'ifte'</span>, [IFTE])
key_jo(<span style="color: #e6db74;">'new'</span>, [NEW])
key_jo(<span style="color: #e6db74;">','</span>, [])

key_jo(<span style="color: #e6db74;">'mark'</span>, [MARK])
key_jo(<span style="color: #e6db74;">'collect-vect'</span>, [COLLECT_VECT])
key_jo(<span style="color: #e6db74;">'vect-spread'</span>, [VECT_SPREAD])
key_jo(<span style="color: #e6db74;">'collect-list'</span>, [COLLECT_LIST])
key_jo(<span style="color: #e6db74;">'list-spread'</span>, [LIST_SPREAD])
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdedd593" class="outline-2">
<h2 id="orgdedd593">macro_dict</h2>
<div class="outline-text-2" id="text-orgdedd593">
</div><div id="outline-container-orge845ff3" class="outline-3">
<h3 id="orge845ff3"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-orge845ff3">
<ul class="org-ul">
<li><p>macro : (-&gt; body &#x2013; sexp)</p><p>where body is sexp_list</p></li></ul>
</div>
</div>

<div id="outline-container-org285cf29" class="outline-3">
<h3 id="org285cf29">macro_dict</h3>
<div class="outline-text-3" id="text-org285cf29">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">macro_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e3229f" class="outline-3">
<h3 id="org2e3229f">@macro</h3>
<div class="outline-text-3" id="text-org2e3229f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">macro</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">macro_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf5768f" class="outline-3">
<h3 id="orgcf5768f">(cond)</h3>
<div class="outline-text-3" id="text-orgcf5768f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'cond'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_cond</span>(body):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(rest):
        <span style="color: #f92672; font-weight: bold;">if</span> list_length(rest) == 2:
            <span style="color: #fd971f;">q</span> = list_ref(rest, 0)
            <span style="color: #fd971f;">a</span> = list_ref(rest, 1)
            <span style="color: #f92672; font-weight: bold;">if</span> q == <span style="color: #e6db74;">'else'</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> a
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
                    [<span style="color: #e6db74;">'begin'</span>,
                     q, [<span style="color: #e6db74;">'clo'</span>, a],
                     [<span style="color: #e6db74;">'clo'</span>,
                      [<span style="color: #e6db74;">'quote'</span>, body],
                      <span style="color: #e6db74;">'report-cond-mismatch'</span>],
                     <span style="color: #e6db74;">'ifte'</span>])
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">q</span> = list_ref(rest, 0)
            <span style="color: #fd971f;">a</span> = list_ref(rest, 1)
            <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
                [<span style="color: #e6db74;">'begin'</span>,
                 q, [<span style="color: #e6db74;">'clo'</span>, a],
                 [<span style="color: #e6db74;">'clo'</span>, recur(cdr(cdr(rest)))],
                 <span style="color: #e6db74;">'ifte'</span>])
    <span style="color: #f92672; font-weight: bold;">return</span> recur(body)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'report-cond-mismatch'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">report_cond_mismatch</span>(body):
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- cond mismatch"</span>)
    p_print(<span style="color: #e6db74;">"  body : "</span>)
    sexp_print(body)
    newline()
    error()
</pre>
</div>
</div>
</div>

<div id="outline-container-org44164d" class="outline-3">
<h3 id="org44164d">(if)</h3>
<div class="outline-text-3" id="text-org44164d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'if'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_if</span>(body):
    <span style="color: #fd971f;">length</span> = list_length(body)
    <span style="color: #f92672; font-weight: bold;">if</span> length != 3:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (if) syntax fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body of (if) must has 3 sexps"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        p_print(<span style="color: #e6db74;">"  body : "</span>)
        sexp_list_print(body)
        newline()
        error()

    <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
        [<span style="color: #e6db74;">'begin'</span>,
         car(body),
         [<span style="color: #e6db74;">'clo'</span>, car(cdr(body))],
         [<span style="color: #e6db74;">'clo'</span>, car(cdr(cdr(body)))],
         <span style="color: #e6db74;">'ifte'</span>])
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e91516" class="outline-3">
<h3 id="org4e91516">(when)</h3>
<div class="outline-text-3" id="text-org4e91516">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'when'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_when</span>(body):
    <span style="color: #fd971f;">length</span> = list_length(body)
    <span style="color: #f92672; font-weight: bold;">if</span> length != 2:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (when) syntax fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body of (when) must has 2 sexps"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        p_print(<span style="color: #e6db74;">"  body : "</span>)
        sexp_list_print(body)
        newline()
        error()

    <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
        [<span style="color: #e6db74;">'begin'</span>,
         car(body),
         [<span style="color: #e6db74;">'clo'</span>, car(cdr(body))],
         [<span style="color: #e6db74;">'clo'</span>],
         <span style="color: #e6db74;">'ifte'</span>])
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9cd303e" class="outline-2">
<h2 id="org9cd303e">------</h2>
</div>
<div id="outline-container-orgd8dbfcf" class="outline-2">
<h2 id="orgd8dbfcf">epilog &#x2013; interface</h2>
<div class="outline-text-2" id="text-orgd8dbfcf">
</div><div id="outline-container-org1225edd" class="outline-3">
<h3 id="org1225edd">maybe_drop_shebang</h3>
<div class="outline-text-3" id="text-org1225edd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">maybe_drop_shebang</span>(code):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(code)
    <span style="color: #f92672; font-weight: bold;">if</span> length &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> code
    <span style="color: #f92672; font-weight: bold;">elif</span> code[0:2] != <span style="color: #e6db74;">'#!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> code
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">end_of_first_line</span> = code.find(<span style="color: #e6db74;">'\n'</span>)
        <span style="color: #f92672; font-weight: bold;">if</span> end_of_first_line == -1:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> code[end_of_first_line:]
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d89bf8" class="outline-3">
<h3 id="org3d89bf8">load</h3>
<div class="outline-text-3" id="text-org3d89bf8">
<ul class="org-ul">
<li><p>path is used as module name</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">load</span>(path):
    <span style="color: #fd971f;">path</span> = os.path.abspath(path)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.exists(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path does not exist"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.isfile(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path is not file"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">with</span> <span style="color: #a6e22e;">open</span>(path, <span style="color: #e6db74;">"r"</span>) <span style="color: #f92672; font-weight: bold;">as</span> f:
        <span style="color: #fd971f;">code</span> = f.read()
        <span style="color: #fd971f;">code</span> = maybe_drop_shebang(code)
        <span style="color: #fd971f;">sexp_vect</span> = parse_sexp_vect(scan_string_vect(code))
        <span style="color: #fd971f;">module</span> = compile_module(path, sexp_vect)

    <span style="color: #fd971f;">module.__file__</span> = path

    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4e0796" class="outline-3">
<h3 id="orgc4e0796">run</h3>
<div class="outline-text-3" id="text-orgc4e0796">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">run</span>(data_stack, jojo_vect):
    <span style="color: #fd971f;">data_stack</span> = vect_copy(data_stack)
    <span style="color: #f92672; font-weight: bold;">for</span> jojo <span style="color: #f92672; font-weight: bold;">in</span> jojo_vect:
        run_one(data_stack, jojo)
    <span style="color: #f92672; font-weight: bold;">return</span> data_stack

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">run_one</span>(data_stack, jojo):
    <span style="color: #fd971f;">vm</span> = VM(data_stack,
            [RP(jojo)])
    vm.exe()
</pre>
</div>
</div>
</div>

<div id="outline-container-org7811717" class="outline-3">
<h3 id="org7811717">core_module</h3>
<div class="outline-text-3" id="text-org7811717">
</div><div id="outline-container-org6737049" class="outline-4">
<h4 id="org6737049">load_core</h4>
<div class="outline-text-4" id="text-org6737049">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">load_core</span>(path):
    <span style="color: #fd971f;">path</span> = os.path.abspath(path)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.exists(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load_core fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path does not exist"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.isfile(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load_core fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path is not file"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">with</span> <span style="color: #a6e22e;">open</span>(path, <span style="color: #e6db74;">"r"</span>) <span style="color: #f92672; font-weight: bold;">as</span> f:
        <span style="color: #fd971f;">code</span> = f.read()
        <span style="color: #fd971f;">sexp_vect</span> = parse_sexp_vect(scan_string_vect(code))
        <span style="color: #fd971f;">module</span> = compile_core_module(path, sexp_vect)

    <span style="color: #fd971f;">module.__file__</span> = path

    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f74a48" class="outline-4">
<h4 id="org1f74a48">core_module</h4>
<div class="outline-text-4" id="text-org1f74a48">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">current_module</span> = sys.modules[<span style="color: #a6e22e;">__name__</span>]
<span style="color: #fd971f;">current_module_dir</span> = os.path.dirname(current_module.__file__)
<span style="color: #fd971f;">core_path</span> = <span style="color: #e6db74;">"/"</span>.join([current_module_dir, <span style="color: #e6db74;">"core.jo"</span>])
<span style="color: #fd971f;">core_module</span> = load_core(core_path)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc711ce6" class="outline-2">
<h2 id="orgc711ce6">------</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: xieyuheng</p>
<p class="date">Created: 2017-10-16 Mon 01:19</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
