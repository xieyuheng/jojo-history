<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-11-28 Tue 00:37 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo's programming adventure in python</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="xieyuheng" />
<link rel="stylesheet" href="css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo's programming adventure in python</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org2e97b2d"><span class="done _todo_stack_">[todo-stack]</span> </a>
<ul>
<li><a href="#org18f5f62">(+actor)</a></li>
<li><a href="#org6f3db00">to use python decorator in jojo</a></li>
<li><a href="#org7853c2d">(+generator) &#x2013; python like generator and yield</a></li>
<li><a href="#orgc259989">parse_sexp_vect &#x2013; error handling</a></li>
<li><a href="#orge542de4">inline module_debug_one_step and module_repl_one_step</a></li>
</ul>
</li>
<li><a href="#org8f6e5a3">prolog</a>
<ul>
<li><a href="#orga0a4e86">import</a></li>
<li><a href="#orgbe14a71">utility</a>
<ul>
<li><a href="#org6f777b8">get_signature</a></li>
<li><a href="#org1fe1ab1">fun_p</a></li>
<li><a href="#org7ac0248">method_p</a></li>
<li><a href="#orgad28fab">class_p</a></li>
<li><a href="#org975e629">Vect</a></li>
<li><a href="#orgb5bd96c">vect_p</a></li>
<li><a href="#org8e5ac51">string_p</a></li>
<li><a href="#org395a130">fill_vect</a></li>
<li><a href="#org5f89fd">fill_tuple</a></li>
</ul>
</li>
<li><a href="#org9cc6e63">error handling</a>
<ul>
<li><a href="#org7c1a9a9">JOJO_ERROR</a></li>
<li><a href="#org6b1460b">error</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2f20edb">vm</a>
<ul>
<li><a href="#org92d1245">RP</a></li>
<li><a href="#orgf24d31a">VM</a></li>
<li><a href="#orgfc6e0e">exe</a></li>
<li><a href="#org4f133b1">exe_one_step</a></li>
<li><a href="#orgb1290a1">VALUES</a></li>
<li><a href="#orgf6669ab">exe_jo</a></li>
<li><a href="#orgae2eb82">exe_fun</a>
<ul>
<li><a href="#orgea93bd3"><span class="todo _note_">[note]</span> python funtion arguments</a></li>
<li><a href="#orge4df074">exe_fun</a></li>
<li><a href="#org1cc3524">push_result_to_vm</a></li>
<li><a href="#org2d1664f">get_positional_para_length</a></li>
<li><a href="#org8300e93">has_para_vect</a></li>
<li><a href="#org6d474ad">has_para_dict</a></li>
<li><a href="#orgc505823">get_default_arg_dict</a></li>
<li><a href="#orgf3d0716">get_positional_default_arg_dict</a></li>
</ul>
</li>
<li><a href="#orgd10af75">jo</a>
<ul>
<li><a href="#orgfa1c9c2">JOJO</a></li>
<li><a href="#orgfbb1ad7">CLO</a></li>
<li><a href="#org5a07464">APPLY</a></li>
<li><a href="#orgacc93fe">IFTE</a></li>
<li><a href="#org17cbd7c">CALL_FROM_MODULE</a></li>
<li><a href="#orgc748437">GET</a></li>
<li><a href="#org7d3b45">SET</a></li>
<li><a href="#org5b5b759">MARK &#x2013; for collectors</a></li>
<li><a href="#org823f246">COLLECT_VECT &#x2013; collect values before mark to vect</a></li>
<li><a href="#orge50bc8b">VECT_SPREAD &#x2013; spread values to data stack</a></li>
<li><a href="#org1f769af">COLLECT_LIST &#x2013; collect values before mark to list</a></li>
<li><a href="#org6afb860">LIST_SPREAD &#x2013; spread values to data stack</a></li>
<li><a href="#org7663cd">DATA_PRED &#x2013; for data predicate</a></li>
<li><a href="#org6ebc65f">NEW &#x2013; create object from data and class</a></li>
<li><a href="#org7c9620f">MSG &#x2013; message to object</a></li>
<li><a href="#org2ca157c">SET_FIELD</a></li>
<li><a href="#org8837b74">GENE</a></li>
<li><a href="#org7ba838d">CLEAR</a></li>
<li><a href="#org8685add">PRIMITIVE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org398421b">sexp &#x2013; string expression</a>
<ul>
<li><a href="#orgf0f4a9d">scan &#x2013; lexer for sexp</a>
<ul>
<li><a href="#orgefe583c">code_scan</a></li>
<li><a href="#org772840e">find_end</a></li>
<li><a href="#org17470e1">space_p</a></li>
<li><a href="#org51cc0b4">delimiter_p</a></li>
<li><a href="#orge41ed1">doublequote_p</a></li>
</ul>
</li>
<li><a href="#orgfa71389">null &amp; cons</a>
<ul>
<li><a href="#org51a0463">Null</a></li>
<li><a href="#org3dd83f0">null</a></li>
<li><a href="#orgdc0505">null_p</a></li>
<li><a href="#org2063d86">Cons</a></li>
<li><a href="#org396b87f">cons</a></li>
<li><a href="#orgaf9207d">cons_p</a></li>
<li><a href="#org6ac01d2">cdr</a></li>
<li><a href="#org7741c5b">car</a></li>
</ul>
</li>
<li><a href="#orgfe8c6bb"><span class="todo _note_">[note]</span> syntax sugar</a></li>
<li><a href="#org7f324bd">parse_sexp_vect &#x2013; string vect to sexp vect</a></li>
<li><a href="#org8a1d31c">parse_sexp</a></li>
<li><a href="#org8ac8c0b">parse_sexp_cons_until_ket</a></li>
<li><a href="#orgb2c7049">p_print</a></li>
<li><a href="#org1ef3db7">sexp_print</a></li>
<li><a href="#org72f30c9">sexp_list_print</a></li>
</ul>
</li>
<li><a href="#org62c1694">compiler</a>
<ul>
<li><a href="#org9361b5f">new_module</a></li>
<li><a href="#org7c555ff">jojo_define</a></li>
<li><a href="#org31edba9">merge_prim_dict</a></li>
<li><a href="#orgdccd4e8">merge_module</a></li>
<li><a href="#org7b1a68d">merge_sexp_vect</a></li>
<li><a href="#org6cc7769">compile_module</a></li>
<li><a href="#orgd93192f">compile_core_module</a></li>
<li><a href="#org5dd7b34">sexp_list_emit</a></li>
<li><a href="#org4c5f548">sexp_emit</a>
<ul>
<li><a href="#org77cf493">sexp_emit</a></li>
<li><a href="#org9942096">null_emit</a></li>
<li><a href="#orgb8374a4">cons_emit</a></li>
<li><a href="#orgf69de6c">string_emit</a></li>
<li><a href="#org6b72ecd">dot_in_string_emit</a></li>
<li><a href="#orgcca88fc">string_emitter_vect &amp; @string_emitter</a>
<ul>
<li><a href="#org2d69f8e">string_emitter_vect</a></li>
<li><a href="#orge1bf490">@string_emitter</a></li>
<li><a href="#org1bb099f">int_string_p</a></li>
<li><a href="#org2f71eef">nat_string_p</a></li>
<li><a href="#org64d909b">int_string_emitter</a></li>
<li><a href="#orgda8269f">doublequoted_string_p</a></li>
<li><a href="#orge34e7c7">doublequoted_string_emitter</a></li>
<li><a href="#orgc123894">local_string_p</a></li>
<li><a href="#orgd1f7aa">local_string_emitter</a></li>
<li><a href="#orgcc672b5">set_local_string_p</a></li>
<li><a href="#org804d9cf">set_local_string_emitter</a></li>
<li><a href="#orgf59c585">message_string_p</a></li>
<li><a href="#org26e3658">message_string_emitter</a></li>
<li><a href="#org57305eb">set_message_string_p</a></li>
<li><a href="#org3736b97">set_message_string_emitter</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org5e25feb">prim_dict</a>
<ul>
<li><a href="#org7c6fd16">prim_dict &amp; @prim</a></li>
<li><a href="#org4fd3408"><b>stack operation</b></a></li>
<li><a href="#org2ca7e41"><b>int</b></a>
<ul>
<li><a href="#orgbbc7958">Int</a></li>
<li><a href="#org28509a0">int_p</a></li>
<li><a href="#org1d4c192">primary school</a></li>
<li><a href="#org9589261">compare</a>
<ul>
<li><a href="#org407e9ba">lt_p &#x2013; less then</a></li>
<li><a href="#org6fcc1a3">gt_p &#x2013; greater then</a></li>
<li><a href="#orgdaeb455">lteq_p &#x2013; less then or equal to</a></li>
<li><a href="#orgbde813">gteq_p &#x2013; greater then or equal to</a></li>
</ul>
</li>
<li><a href="#org1859f36">int_print</a></li>
</ul>
</li>
<li><a href="#orga45c51f"><b>bool</b></a>
<ul>
<li><a href="#org8dcb765">Bool</a></li>
<li><a href="#org835d87a">basic</a></li>
</ul>
</li>
<li><a href="#orgf158587"><b>equivalence</b></a>
<ul>
<li><a href="#orge3a4cb">eq_p</a></li>
<li><a href="#orgecb8390">eqv_p</a></li>
</ul>
</li>
<li><a href="#org414ef7f"><b>sexp</b></a></li>
<li><a href="#orgf9113d0"><b>string</b></a>
<ul>
<li><a href="#org733b0aa">String</a></li>
<li><a href="#org23c485b">string_p</a></li>
<li><a href="#orgf3c6b45">string_print</a></li>
<li><a href="#org8551cea">string_length</a></li>
<li><a href="#orgbb012de">string_ref</a></li>
<li><a href="#org3b8c36a">string_append</a></li>
<li><a href="#orgdbd4a4d">string_slice</a></li>
<li><a href="#orgbf6726e">string_empty_p</a></li>
<li><a href="#orgab3d9df">string_eq_p</a></li>
<li><a href="#org9890cee">string_to_int</a></li>
<li><a href="#orgb0685d0">string predicates</a></li>
</ul>
</li>
<li><a href="#orgf8795c8"><b>vect</b></a>
<ul>
<li><a href="#org4f93aa3"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org1bdb24e">Vect</a></li>
<li><a href="#org5be39c9">vect_p</a></li>
<li><a href="#org5331b48">vect_copy</a></li>
<li><a href="#org910e3ce">vect_member_p</a></li>
<li><a href="#org9eb0d0">vect_length</a></li>
<li><a href="#org7d14a75">vect_ref</a></li>
<li><a href="#org9b6eca4">vect_append &#x2013; no-side-effect</a></li>
<li><a href="#org1b10110">vect_zip_dict</a></li>
<li><a href="#orgf58cda8">vect_to_sexp</a></li>
<li><a href="#org7a1268a">sexp_to_vect</a></li>
</ul>
</li>
<li><a href="#org22fefac"><b>stack</b></a>
<ul>
<li><a href="#org3a952d0">stack</a></li>
<li><a href="#orgf0e8a7">stack_p</a></li>
<li><a href="#org6e5587">stack_pop</a></li>
<li><a href="#orgc80b1bd">stack_push</a></li>
<li><a href="#org11cf8b3">stack_drop</a></li>
<li><a href="#orgde4f849">stack_dup</a></li>
<li><a href="#orga63cdde">stack_over</a></li>
<li><a href="#orgad0abfb">stack_tuck</a></li>
<li><a href="#org572b73f">stack_swap</a></li>
<li><a href="#org88e5da4">stack_length</a></li>
<li><a href="#orge91e831">stack_empty_p</a></li>
</ul>
</li>
<li><a href="#orgc241e16"><b>list</b></a>
<ul>
<li><a href="#orgada9b75">Null &amp; Cons</a></li>
<li><a href="#org93c302c">list_p</a></li>
<li><a href="#orgae27e63">vect_to_list</a></li>
<li><a href="#orgaab0ab9">list_to_vect</a></li>
<li><a href="#orgef86525">list_length</a></li>
<li><a href="#orgc9e32b4">list_ref</a></li>
<li><a href="#orgfbaaa7b">list_append</a></li>
<li><a href="#org1168c5d">tail_cons</a></li>
<li><a href="#org525473b">list_zip_dict</a></li>
</ul>
</li>
<li><a href="#org9b5ccc1"><b>dict</b></a>
<ul>
<li><a href="#org81257fe">Dict</a></li>
<li><a href="#orgf7754b4">dict_p</a></li>
<li><a href="#org8ce98b0">dict_copy</a></li>
<li><a href="#orgf4a7206">vect_to_dict</a></li>
<li><a href="#org7dd6082">dict_length</a></li>
<li><a href="#org50b78a7">dict_find</a></li>
<li><a href="#org36d6cdc">dict_update &#x2013; no-side-effect</a></li>
<li><a href="#org5e1a8b1">dict_delete &#x2013; no-side-effect</a></li>
</ul>
</li>
<li><a href="#orgc9efe3"><b>tuple</b></a>
<ul>
<li><a href="#org807117e">Tuple</a></li>
<li><a href="#org9a75563">tuple_p</a></li>
<li><a href="#org22b5184">vect_to_tuple</a></li>
<li><a href="#orgc63262b">tuple_to_vect</a></li>
<li><a href="#org320e7e8">tuple_length</a></li>
<li><a href="#org91031d5">tuple_ref</a></li>
<li><a href="#org381b714">tuple_append</a></li>
</ul>
</li>
<li><a href="#orgbb165ee"><b>set</b></a>
<ul>
<li><a href="#orge0a2195">Set</a></li>
<li><a href="#org6fbc302">set_p</a></li>
<li><a href="#org23cd41f">vect_to_set</a></li>
<li><a href="#org2962c05">set_to_vect</a></li>
<li><a href="#orgda9f568">set_length</a></li>
<li><a href="#orgd6a8cc0">set_member_p</a></li>
<li><a href="#orgf41d128">high school</a></li>
</ul>
</li>
<li><a href="#org43b25a8"><b>io</b></a>
<ul>
<li><a href="#org8fbf06b">print</a></li>
<li><a href="#org151c3f6">nl &#x2013; newline</a></li>
<li><a href="#orged6552">space</a></li>
</ul>
</li>
<li><a href="#org50bb495"><b>sys</b></a>
<ul>
<li><a href="#orgb51ce5a">bye</a></li>
</ul>
</li>
<li><a href="#org78b5c70"><b>repl</b></a>
<ul>
<li><a href="#org4b3d313">read_sexp</a>
<ul>
<li><a href="#orge7af1fd">read_char</a></li>
<li><a href="#org380f80a">read_string</a></li>
<li><a href="#orgc410fe8">read_doublequoted_string</a></li>
<li><a href="#orgc40a2e">read_sexp</a></li>
<li><a href="#orgdeabe8d">read_sexp_list_until_ket</a></li>
</ul>
</li>
<li><a href="#org105a2fc">print_data_stack</a></li>
<li><a href="#org5b8e003">print_return_stack</a>
<ul>
<li><a href="#org3585476">print_return_stack</a></li>
<li><a href="#org1da9331">return_point_print</a></li>
<li><a href="#org281ccd3">jo_print</a></li>
</ul>
</li>
<li><a href="#org8e34742">module_repl</a>
<ul>
<li><a href="#org20665a0"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org1c02c5e">module_repl</a></li>
<li><a href="#org2409838">EXIT_MODULE_REPL</a></li>
<li><a href="#org4c5ff25">module_repl_one_step</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4c374b3"><b>error</b></a>
<ul>
<li><a href="#org6f6e501">error</a></li>
<li><a href="#org4a329f0">module_debug</a>
<ul>
<li><a href="#org6483af0">module_debug</a></li>
<li><a href="#orge2c6a95">EXIT_MODULE_DEBUG_REPL</a></li>
<li><a href="#org6855de8">LEAVE_MODULE_DEBUG_REPL</a></li>
<li><a href="#orgd852841">module_debug_one_step</a></li>
</ul>
</li>
<li><a href="#org2424a39">call_module_debug</a></li>
</ul>
</li>
<li><a href="#org2b1fc09"><b>object</b></a>
<ul>
<li><a href="#org265a2f8">Object</a></li>
</ul>
</li>
<li><a href="#orgc425648"><b>class</b></a>
<ul>
<li><a href="#org837cf4b">value_to_class</a></li>
<li><a href="#org18f49e0">subclass_p</a></li>
</ul>
</li>
<li><a href="#org4524105"><b>misc</b></a>
<ul>
<li><a href="#orgfa62d47">nop</a></li>
<li><a href="#orgd69166a">none</a></li>
<li><a href="#org51c08f7">fun_to_positional_default_arg_dict</a></li>
<li><a href="#orgda95f89">prepare_data_arguments</a></li>
<li><a href="#orgb40d6b7">keyword_apply</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6322a84">keyword_dict</a>
<ul>
<li><a href="#orgf45f98d"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#orgc04cba6">keyword_dict</a></li>
<li><a href="#orgaaf8eda">@keyword</a></li>
<li><a href="#orgac7612c">(note)</a></li>
<li><a href="#orgb3b42d7">(begin)</a></li>
<li><a href="#orgb3ce4aa">(clo)</a></li>
<li><a href="#org86e5d48">(quote)</a></li>
<li><a href="#org94b7955">(partquote)</a></li>
<li><a href="#org69dcfd8">(-&gt;)</a></li>
<li><a href="#orgf49169b">(list)</a></li>
<li><a href="#org6ba42c1">(vect)</a></li>
<li><a href="#org755bd04">(stack)</a></li>
<li><a href="#org3992405">(dict)</a></li>
<li><a href="#org3ec9741">(tuple)</a></li>
<li><a href="#org6515107">(set)</a></li>
<li><a href="#orgeb92f9">(primitive)</a></li>
</ul>
</li>
<li><a href="#orgef1a66f">top_level_keyword</a>
<ul>
<li><a href="#org5839830">(import)</a>
<ul>
<li><a href="#org2b58e30">k_import</a></li>
<li><a href="#orgc204695">k_import_one</a></li>
<li><a href="#orgf2783a3">k_import_as</a></li>
</ul>
</li>
<li><a href="#org8139019">(from)</a>
<ul>
<li><a href="#org6638cd7">k_from</a></li>
<li><a href="#org23c033e">k_from_syntax_check</a></li>
<li><a href="#org109eb89">k_from_as</a></li>
<li><a href="#orga1307dd">k_from_as_syntax_check</a></li>
</ul>
</li>
<li><a href="#orgaf90d9f">(+jojo)</a></li>
<li><a href="#org34c6049">(+data)</a>
<ul>
<li><a href="#orgec4c9ea">plus_data</a></li>
<li><a href="#org1c844a7">body_to_field_name_vect</a></li>
<li><a href="#orgd8d07fc">data_name_string_p</a></li>
<li><a href="#orgccc1f52">create_data_init</a></li>
<li><a href="#org6d9a975">create_data_class</a></li>
</ul>
</li>
<li><a href="#org67bafa">(+union)</a>
<ul>
<li><a href="#orga12d365">plus_union</a></li>
<li><a href="#org89525ca">UNION</a></li>
</ul>
</li>
<li><a href="#org38975ca"><span class="todo _note_">[note]</span> gene and disp</a></li>
<li><a href="#orgb6dde6e">(+gene)</a>
<ul>
<li><a href="#orgaafd7b5">plus_gene</a></li>
<li><a href="#orgfed1bed">arrow_get_arity</a></li>
</ul>
</li>
<li><a href="#org73ddc8d">(+disp)</a>
<ul>
<li><a href="#org72d1633">plus_disp</a></li>
<li><a href="#orgd58ce9f">arrow_get_type_vect</a></li>
<li><a href="#org8f0c599">type_vect_to_type_vect_vect</a></li>
<li><a href="#org1ec7f04">arrow_get_type_tuple_vect</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc2fbef3">key_jo_dict</a>
<ul>
<li><a href="#org7fcbc04"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#orgfa14b9d">key_jo_dict</a></li>
<li><a href="#org377c6e1">key_jo</a></li>
<li><a href="#org497ee7f">key_jo s</a></li>
</ul>
</li>
<li><a href="#org1baff66">macro_dict</a>
<ul>
<li><a href="#org477e2fd"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#orga3b081b">macro_dict</a></li>
<li><a href="#org95b564d">@macro</a></li>
<li><a href="#org9d291c">(cond)</a></li>
<li><a href="#orgaa42d61">(if)</a></li>
<li><a href="#org1936528">(when)</a></li>
<li><a href="#org33c63e5">(call)</a></li>
<li><a href="#orgec8f860">(create)</a></li>
</ul>
</li>
<li><a href="#org891b9c2">epilog &#x2013; interface</a>
<ul>
<li><a href="#orged1b1da">maybe_drop_shebang</a></li>
<li><a href="#orgc5a18bd">load</a></li>
<li><a href="#orga754c0">run</a></li>
<li><a href="#orge2daccd">core_module</a>
<ul>
<li><a href="#org35d9f9a">load_core</a></li>
<li><a href="#org13ede74">core_module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org2e97b2d" class="outline-2">
<h2 id="org2e97b2d"><span class="done _todo_stack_">[todo-stack]</span> </h2>
<div class="outline-text-2" id="text-org2e97b2d">
</div><div id="outline-container-org18f5f62" class="outline-3">
<h3 id="org18f5f62">(+actor)</h3>
</div>

<div id="outline-container-org6f3db00" class="outline-3">
<h3 id="org6f3db00">to use python decorator in jojo</h3>
<div class="outline-text-3" id="text-org6f3db00">
<ul class="org-ul">
<li><p>for flask and celery</p></li></ul>
</div>
</div>

<div id="outline-container-org7853c2d" class="outline-3">
<h3 id="org7853c2d">(+generator) &#x2013; python like generator and yield</h3>
<div class="outline-text-3" id="text-org7853c2d">
<ul class="org-ul">
<li><p>for scrapy</p></li>

<li><p>(+generator k1 1 give k1)</p><p>k1 next</p></li></ul>
</div>
</div>

<div id="outline-container-orgc259989" class="outline-3">
<h3 id="orgc259989">parse_sexp_vect &#x2013; error handling</h3>
<div class="outline-text-3" id="text-orgc259989">
<ul class="org-ul">
<li><p>to be able to use it in jojo</p></li></ul>
</div>
</div>

<div id="outline-container-orge542de4" class="outline-3">
<h3 id="orge542de4">inline module_debug_one_step and module_repl_one_step</h3>
<div class="outline-text-3" id="text-orge542de4">
<ul class="org-ul">
<li><p>to avoid the use of 'try &amp; except'</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org8f6e5a3" class="outline-2">
<h2 id="org8f6e5a3">prolog</h2>
<div class="outline-text-2" id="text-org8f6e5a3">
</div><div id="outline-container-orga0a4e86" class="outline-3">
<h3 id="orga0a4e86">import</h3>
<div class="outline-text-3" id="text-orga0a4e86">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">import</span> inspect
<span style="color: #f92672; font-weight: bold;">import</span> types
<span style="color: #f92672; font-weight: bold;">import</span> importlib
<span style="color: #f92672; font-weight: bold;">import</span> sys
<span style="color: #f92672; font-weight: bold;">import</span> os
<span style="color: #f92672; font-weight: bold;">import</span> itertools
<span style="color: #f92672; font-weight: bold;">import</span> collections
<span style="color: #f92672; font-weight: bold;">import</span> operator
<span style="color: #f92672; font-weight: bold;">import</span> traceback
<span style="color: #f92672; font-weight: bold;">import</span> pprint
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe14a71" class="outline-3">
<h3 id="orgbe14a71">utility</h3>
<div class="outline-text-3" id="text-orgbe14a71">
</div><div id="outline-container-org6f777b8" class="outline-4">
<h4 id="org6f777b8">get_signature</h4>
<div class="outline-text-4" id="text-org6f777b8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_signature</span>(fun):
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> inspect.signature(fun)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">ValueError</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">None</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1fe1ab1" class="outline-4">
<h4 id="org1fe1ab1">fun_p</h4>
<div class="outline-text-4" id="text-org1fe1ab1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fun_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #a6e22e;">isinstance</span>(x, types.LambdaType) <span style="color: #f92672; font-weight: bold;">or</span>
        <span style="color: #a6e22e;">isinstance</span>(x, types.MethodType)):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> (<span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinFunctionType) <span style="color: #f92672; font-weight: bold;">or</span>
          <span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinMethodType)):
        <span style="color: #f92672; font-weight: bold;">if</span> get_signature(x) == <span style="color: #ae81ff;">None</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ac0248" class="outline-4">
<h4 id="org7ac0248">method_p</h4>
<div class="outline-text-4" id="text-org7ac0248">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">method_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">isinstance</span>(x, types.MethodType):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinMethodType):
        <span style="color: #f92672; font-weight: bold;">if</span> get_signature(x) == <span style="color: #ae81ff;">None</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad28fab" class="outline-4">
<h4 id="orgad28fab">class_p</h4>
<div class="outline-text-4" id="text-orgad28fab">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">class_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> inspect.isclass(x):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> x == <span style="color: #a6e22e;">type</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org975e629" class="outline-4">
<h4 id="org975e629">Vect</h4>
<div class="outline-text-4" id="text-org975e629">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">Vect</span> = <span style="color: #a6e22e;">list</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb5bd96c" class="outline-4">
<h4 id="orgb5bd96c">vect_p</h4>
<div class="outline-text-4" id="text-orgb5bd96c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == Vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e5ac51" class="outline-4">
<h4 id="org8e5ac51">string_p</h4>
<div class="outline-text-4" id="text-org8e5ac51">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">str</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org395a130" class="outline-4">
<h4 id="org395a130">fill_vect</h4>
<div class="outline-text-4" id="text-org395a130">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fill_vect</span>(value, length):
    <span style="color: #fd971f;">vect</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        vect.append(value)
        <span style="color: #fd971f;">i</span> = i + 1
    <span style="color: #f92672; font-weight: bold;">return</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f89fd" class="outline-4">
<h4 id="org5f89fd">fill_tuple</h4>
<div class="outline-text-4" id="text-org5f89fd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fill_tuple</span>(value, length):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(fill_vect(value, length))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9cc6e63" class="outline-3">
<h3 id="org9cc6e63">error handling</h3>
<div class="outline-text-3" id="text-org9cc6e63">
</div><div id="outline-container-org7c1a9a9" class="outline-4">
<h4 id="org7c1a9a9">JOJO_ERROR</h4>
<div class="outline-text-4" id="text-org7c1a9a9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO_ERROR</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b1460b" class="outline-4">
<h4 id="org6b1460b">error</h4>
<div class="outline-text-4" id="text-org6b1460b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">error</span>():
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org2f20edb" class="outline-2">
<h2 id="org2f20edb">vm</h2>
<div class="outline-text-2" id="text-org2f20edb">
</div><div id="outline-container-org92d1245" class="outline-3">
<h3 id="org92d1245">RP</h3>
<div class="outline-text-3" id="text-org92d1245">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">RP</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.cursor = 0
        <span style="color: #f92672; font-weight: bold;">self</span>.length = jojo.length
        <span style="color: #f92672; font-weight: bold;">self</span>.body = jojo.body
        <span style="color: #f92672; font-weight: bold;">self</span>.lr = jojo.lr.copy()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf24d31a" class="outline-3">
<h3 id="orgf24d31a">VM</h3>
<div class="outline-text-3" id="text-orgf24d31a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VM</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, ds, rs):
        <span style="color: #f92672; font-weight: bold;">self</span>.ds = ds
        <span style="color: #f92672; font-weight: bold;">self</span>.rs = rs

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #f92672; font-weight: bold;">return</span> exe(<span style="color: #f92672; font-weight: bold;">self</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc6e0e" class="outline-3">
<h3 id="orgfc6e0e">exe</h3>
<div class="outline-text-3" id="text-orgfc6e0e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe</span>(vm):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(vm.rs)
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #a6e22e;">len</span>(vm.rs) &gt;= length:
        exe_one_step(vm)
    <span style="color: #f92672; font-weight: bold;">return</span> vm
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f133b1" class="outline-3">
<h3 id="org4f133b1">exe_one_step</h3>
<div class="outline-text-3" id="text-org4f133b1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_one_step</span>(vm):
    <span style="color: #fd971f;">rp</span> = vm.rs.pop()
    <span style="color: #f92672; font-weight: bold;">if</span> rp.length == 0:
        <span style="color: #f92672; font-weight: bold;">return</span>

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">get current jo</span>
    <span style="color: #fd971f;">jo</span> = rp.body[rp.cursor]

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">handle tail call</span>
    <span style="color: #f92672; font-weight: bold;">if</span> rp.cursor &gt;= rp.length - 1:
       <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
       <span style="color: #fd971f;">rp.cursor</span> = rp.cursor + 1
       vm.rs.append(rp)

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">dispatching</span>
    exe_jo(jo, rp, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1290a1" class="outline-3">
<h3 id="orgb1290a1">VALUES</h3>
<div class="outline-text-3" id="text-orgb1290a1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VALUES</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, *values):
        <span style="color: #f92672; font-weight: bold;">self</span>.values = values
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6669ab" class="outline-3">
<h3 id="orgf6669ab">exe_jo</h3>
<div class="outline-text-3" id="text-orgf6669ab">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_jo</span>(jo, rp, vm):
    <span style="color: #f92672; font-weight: bold;">if</span> fun_p(jo):
        exe_fun(jo, vm)
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">hasattr</span>(jo, <span style="color: #e6db74;">"jo_exe"</span>):
        jo.jo_exe(rp, vm)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        vm.ds.append(jo)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae2eb82" class="outline-3">
<h3 id="orgae2eb82">exe_fun</h3>
<div class="outline-text-3" id="text-orgae2eb82">
</div><div id="outline-container-orgea93bd3" class="outline-4">
<h4 id="orgea93bd3"><span class="todo _note_">[note]</span> python funtion arguments</h4>
<div class="outline-text-4" id="text-orgea93bd3">
<ul class="org-ul">
<li><p>normal arguments are called positional arguments.</p></li>

<li><p>there are also keyword-only arguments,</p><p>because after *args,</p><p>the information about position will be lost.</p></li>

<li><p>before *args</p><p>each positional arguments took one position</p><p>do not respect default arguments</p><p></p><p><ul class="org-ul"></p><p><li><p>to respect default arguments</p><p>one has to use (call)</p></li></ul></p></li>

<li><p>if *args is used in a function signature</p><p>pass it as a vect</p></li>

<li><p>if **kwargs is used in a function signature</p><p>pass it as a dict</p></li></ul>
</div>
</div>

<div id="outline-container-orge4df074" class="outline-4">
<h4 id="orge4df074">exe_fun</h4>
<div class="outline-text-4" id="text-orge4df074">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_fun</span>(fun, vm):
    <span style="color: #fd971f;">signature</span> = get_signature(fun)

    <span style="color: #f92672; font-weight: bold;">if</span> signature == <span style="color: #ae81ff;">None</span>:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exe_fun fail to get signature"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
        error()

    <span style="color: #fd971f;">parameters</span> = signature.parameters

    <span style="color: #f92672; font-weight: bold;">if</span> has_para_dict(parameters):
        <span style="color: #fd971f;">arg_dict</span> = get_default_arg_dict(parameters)
        <span style="color: #fd971f;">top_of_ds</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">isinstance</span>(top_of_ds, <span style="color: #a6e22e;">dict</span>):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exe_fun fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  when fun require a arg_dict"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  the top of data stack is not a dict"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  top of data stack : {}"</span>.<span style="color: #a6e22e;">format</span>(top_of_ds))
            error()
        arg_dict.update(top_of_ds)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">arg_dict</span> = <span style="color: #ae81ff;">None</span>

    <span style="color: #f92672; font-weight: bold;">if</span> has_para_vect(parameters):
        <span style="color: #fd971f;">top_of_ds</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> vect_p(top_of_ds):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exe_fun fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  when fun require a arg_vect"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  the top of data stack is not a vect"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  top of data stack : {}"</span>.<span style="color: #a6e22e;">format</span>(top_of_ds))
            error()
        <span style="color: #fd971f;">arg_vect</span> = top_of_ds
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">arg_vect</span> = []

    <span style="color: #fd971f;">positional_para_length</span> = get_positional_para_length(parameters)
    <span style="color: #fd971f;">args</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; positional_para_length:
        args.append(vm.ds.pop())
        <span style="color: #fd971f;">i</span> = i + 1
    args.reverse()
    args.extend(arg_vect)

    <span style="color: #f92672; font-weight: bold;">if</span> arg_dict == <span style="color: #ae81ff;">None</span>:
        <span style="color: #fd971f;">result</span> = fun(*args)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">result</span> = fun(*args, **arg_dict)

    push_result_to_vm(result, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1cc3524" class="outline-4">
<h4 id="org1cc3524">push_result_to_vm</h4>
<div class="outline-text-4" id="text-org1cc3524">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">push_result_to_vm</span>(result, vm):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(result) == VALUES:
        vm.ds.extend(result.values)
    <span style="color: #f92672; font-weight: bold;">elif</span> result == <span style="color: #ae81ff;">None</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        vm.ds.append(result)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d1664f" class="outline-4">
<h4 id="org2d1664f">get_positional_para_length</h4>
<div class="outline-text-4" id="text-org2d1664f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_positional_para_length</span>(parameters):
    <span style="color: #fd971f;">n</span> = 0
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.POSITIONAL_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
            v.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD):
            <span style="color: #fd971f;">n</span> = n + 1
    <span style="color: #f92672; font-weight: bold;">return</span> n
</pre>
</div>
</div>
</div>

<div id="outline-container-org8300e93" class="outline-4">
<h4 id="org8300e93">has_para_vect</h4>
<div class="outline-text-4" id="text-org8300e93">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">has_para_vect</span>(parameters):
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.VAR_POSITIONAL):
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d474ad" class="outline-4">
<h4 id="org6d474ad">has_para_dict</h4>
<div class="outline-text-4" id="text-org6d474ad">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">has_para_dict</span>(parameters):
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.KEYWORD_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
            v.kind == inspect.Parameter.VAR_KEYWORD):
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc505823" class="outline-4">
<h4 id="orgc505823">get_default_arg_dict</h4>
<div class="outline-text-4" id="text-orgc505823">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_default_arg_dict</span>(parameters):
    <span style="color: #fd971f;">default_dict</span> = {}
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.KEYWORD_ONLY <span style="color: #f92672; font-weight: bold;">and</span>
            v.default != inspect.Parameter.empty):
            <span style="color: #fd971f;">default_dict</span>[v.name] = v.default
    <span style="color: #f92672; font-weight: bold;">return</span> default_dict
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3d0716" class="outline-4">
<h4 id="orgf3d0716">get_positional_default_arg_dict</h4>
<div class="outline-text-4" id="text-orgf3d0716">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_positional_default_arg_dict</span>(parameters):
    <span style="color: #fd971f;">default_dict</span> = {}
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> ((v.kind == inspect.Parameter.POSITIONAL_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
             v.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD)
            <span style="color: #f92672; font-weight: bold;">and</span> v.default != inspect.Parameter.empty):
            <span style="color: #fd971f;">default_dict</span>[v.name] = v.default
    <span style="color: #f92672; font-weight: bold;">return</span> default_dict
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd10af75" class="outline-3">
<h3 id="orgd10af75">jo</h3>
<div class="outline-text-3" id="text-orgd10af75">
</div><div id="outline-container-orgfa1c9c2" class="outline-4">
<h4 id="orgfa1c9c2">JOJO</h4>
<div class="outline-text-4" id="text-orgfa1c9c2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, body):
        <span style="color: #f92672; font-weight: bold;">self</span>.length = <span style="color: #a6e22e;">len</span>(body)
        <span style="color: #f92672; font-weight: bold;">self</span>.body = Vect(body)
        <span style="color: #f92672; font-weight: bold;">self</span>.lr = {}

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.rs.append(RP(<span style="color: #f92672; font-weight: bold;">self</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbb1ad7" class="outline-4">
<h4 id="orgfbb1ad7">CLO</h4>
<div class="outline-text-4" id="text-orgfbb1ad7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CLO</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.jojo = jojo

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">new_jojo</span> = JOJO(<span style="color: #f92672; font-weight: bold;">self</span>.jojo)
        <span style="color: #fd971f;">new_jojo.lr</span> = rp.lr
        vm.ds.append(new_jojo)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"(clo "</span>)
        <span style="color: #f92672; font-weight: bold;">for</span> jo <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #f92672; font-weight: bold;">self</span>.jojo[:-1]:
            jo_print(jo)
            space()
        jo_print(<span style="color: #f92672; font-weight: bold;">self</span>.jojo[-1])
        p_print(<span style="color: #e6db74;">")"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a07464" class="outline-4">
<h4 id="org5a07464">APPLY</h4>
<div class="outline-text-4" id="text-org5a07464">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">APPLY</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">clo</span> = vm.ds.pop()
        clo.jo_exe(rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"apply"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgacc93fe" class="outline-4">
<h4 id="orgacc93fe">IFTE</h4>
<div class="outline-text-4" id="text-orgacc93fe">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">IFTE</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">clo2</span> = vm.ds.pop()
        <span style="color: #fd971f;">clo1</span> = vm.ds.pop()
        <span style="color: #fd971f;">test</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> test:
            vm.rs.append(RP(clo1))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            vm.rs.append(RP(clo2))

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"ifte"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org17cbd7c" class="outline-4">
<h4 id="org17cbd7c">CALL_FROM_MODULE</h4>
<div class="outline-text-4" id="text-org17cbd7c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CALL_FROM_MODULE</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, module, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.module = module
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">jo</span> = <span style="color: #a6e22e;">getattr</span>(<span style="color: #f92672; font-weight: bold;">self</span>.module, <span style="color: #f92672; font-weight: bold;">self</span>.name)
        exe_jo(jo, rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #FF8888;"># </span><span style="color: #FF8888;">p_print("(call {} from {})".format(self.name, self.module.__name__))</span>
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.name)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc748437" class="outline-4">
<h4 id="orgc748437">GET</h4>
<div class="outline-text-4" id="text-orgc748437">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GET</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">jo</span> = rp.lr[<span style="color: #f92672; font-weight: bold;">self</span>.name]
        exe_jo(jo, rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.name)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d3b45" class="outline-4">
<h4 id="org7d3b45">SET</h4>
<div class="outline-text-4" id="text-org7d3b45">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">SET</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value</span> = vm.ds.pop()
        <span style="color: #fd971f;">rp.lr</span>[<span style="color: #f92672; font-weight: bold;">self</span>.name] = value

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.name)
        p_print(<span style="color: #e6db74;">'!'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b5b759" class="outline-4">
<h4 id="org5b5b759">MARK &#x2013; for collectors</h4>
<div class="outline-text-4" id="text-org5b5b759">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MARK</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.ds.append(<span style="color: #f92672; font-weight: bold;">self</span>)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"mark"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org823f246" class="outline-4">
<h4 id="org823f246">COLLECT_VECT &#x2013; collect values before mark to vect</h4>
<div class="outline-text-4" id="text-org823f246">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">COLLECT_VECT</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vect</span> = []
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            <span style="color: #fd971f;">value</span> = vm.ds.pop()
            <span style="color: #f92672; font-weight: bold;">if</span> value == MARK:
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                vect.append(value)
        vect.reverse()
        vm.ds.append(vect)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"collect-vect"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge50bc8b" class="outline-4">
<h4 id="orge50bc8b">VECT_SPREAD &#x2013; spread values to data stack</h4>
<div class="outline-text-4" id="text-orge50bc8b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VECT_SPREAD</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vect</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">for</span> value <span style="color: #f92672; font-weight: bold;">in</span> vect:
            vm.ds.append(value)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"vect-spread"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f769af" class="outline-4">
<h4 id="org1f769af">COLLECT_LIST &#x2013; collect values before mark to list</h4>
<div class="outline-text-4" id="text-org1f769af">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">COLLECT_LIST</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(rest):
            <span style="color: #fd971f;">value</span> = vm.ds.pop()
            <span style="color: #f92672; font-weight: bold;">if</span> value == MARK:
                <span style="color: #f92672; font-weight: bold;">return</span> rest
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> recur(cons(value, rest))
        vm.ds.append(recur(null))

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"collect-list"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6afb860" class="outline-4">
<h4 id="org6afb860">LIST_SPREAD &#x2013; spread values to data stack</h4>
<div class="outline-text-4" id="text-org6afb860">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">LIST_SPREAD</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(l):
            <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
                <span style="color: #f92672; font-weight: bold;">pass</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                vm.ds.append(car(l))
                recur(cdr(l))
        recur(vm.ds.pop())

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"list-spread"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7663cd" class="outline-4">
<h4 id="org7663cd">DATA_PRED &#x2013; for data predicate</h4>
<div class="outline-text-4" id="text-org7663cd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">DATA_PRED</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, data_class):
        <span style="color: #f92672; font-weight: bold;">self</span>.data_class = data_class

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">x</span> = vm.ds.pop()
        vm.ds.append(<span style="color: #a6e22e;">type</span>(x) == <span style="color: #f92672; font-weight: bold;">self</span>.data_class)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(data_class.<span style="color: #a6e22e;">__name__</span>)
        p_print(<span style="color: #e6db74;">'?'</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ebc65f" class="outline-4">
<h4 id="org6ebc65f">NEW &#x2013; create object from data and class</h4>
<div class="outline-text-4" id="text-org6ebc65f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">NEW</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">x</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> class_p(x):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- NEW.jo_exe fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  argument is not a class : {}"</span>.<span style="color: #a6e22e;">format</span>(x))
            error()
        <span style="color: #f92672; font-weight: bold;">else</span>:
            exe_fun(x, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"new"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c9620f" class="outline-4">
<h4 id="org7c9620f">MSG &#x2013; message to object</h4>
<div class="outline-text-4" id="text-org7c9620f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MSG</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, message):
        <span style="color: #f92672; font-weight: bold;">self</span>.message = message

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">o</span> = vm.ds.pop()
        <span style="color: #fd971f;">v</span> = <span style="color: #a6e22e;">getattr</span>(o, <span style="color: #f92672; font-weight: bold;">self</span>.message)
        <span style="color: #f92672; font-weight: bold;">if</span> method_p(v):
            exe_fun(v, vm)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            exe_jo(v, rp, vm)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"."</span>)
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.message)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ca157c" class="outline-4">
<h4 id="org2ca157c">SET_FIELD</h4>
<div class="outline-text-4" id="text-org2ca157c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">SET_FIELD</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, field_name):
        <span style="color: #f92672; font-weight: bold;">self</span>.field_name = field_name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">o</span> = vm.ds.pop()
        <span style="color: #fd971f;">v</span> = vm.ds.pop()
        <span style="color: #a6e22e;">setattr</span>(o, <span style="color: #f92672; font-weight: bold;">self</span>.field_name, v)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"."</span>)
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.field_name)
        p_print(<span style="color: #e6db74;">"!"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8837b74" class="outline-4">
<h4 id="org8837b74">GENE</h4>
<div class="outline-text-4" id="text-org8837b74">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GENE</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, arity, default_jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.arity = arity
        <span style="color: #f92672; font-weight: bold;">self</span>.default_jojo = default_jojo
        <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict = {}

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value_vect</span> = vm.ds[(- <span style="color: #f92672; font-weight: bold;">self</span>.arity):]
        <span style="color: #fd971f;">type_vect</span> = []
        <span style="color: #f92672; font-weight: bold;">for</span> value <span style="color: #f92672; font-weight: bold;">in</span> value_vect:
            type_vect.append(<span style="color: #a6e22e;">type</span>(value))

        <span style="color: #fd971f;">type_tuple</span> = <span style="color: #a6e22e;">tuple</span>(type_vect)
        <span style="color: #f92672; font-weight: bold;">if</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict:
            <span style="color: #fd971f;">jojo</span> = <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict[type_tuple]
            jojo.jo_exe(rp, vm)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">self</span>.default_jojo.jo_exe(rp, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ba838d" class="outline-4">
<h4 id="org7ba838d">CLEAR</h4>
<div class="outline-text-4" id="text-org7ba838d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CLEAR</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vm.ds</span> = []

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #e6db74;">"clear"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8685add" class="outline-4">
<h4 id="org8685add">PRIMITIVE</h4>
<div class="outline-text-4" id="text-org8685add">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">PRIMITIVE</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, fun):
        <span style="color: #f92672; font-weight: bold;">self</span>.fun = fun

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.ds.append(<span style="color: #f92672; font-weight: bold;">self</span>.fun)

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        p_print(<span style="color: #f92672; font-weight: bold;">self</span>.fun)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org398421b" class="outline-2">
<h2 id="org398421b">sexp &#x2013; string expression</h2>
<div class="outline-text-2" id="text-org398421b">
</div><div id="outline-container-orgf0f4a9d" class="outline-3">
<h3 id="orgf0f4a9d">scan &#x2013; lexer for sexp</h3>
<div class="outline-text-3" id="text-orgf0f4a9d">
</div><div id="outline-container-orgefe583c" class="outline-4">
<h4 id="orgefe583c">code_scan</h4>
<div class="outline-text-4" id="text-orgefe583c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">code_scan</span>(string):
    <span style="color: #fd971f;">string_vect</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        <span style="color: #fd971f;">char</span> = string[i]

        <span style="color: #f92672; font-weight: bold;">if</span> space_p(char):
            <span style="color: #fd971f;">i</span> = i + 1

        <span style="color: #f92672; font-weight: bold;">elif</span> delimiter_p(char):
            string_vect.append(char)
            <span style="color: #fd971f;">i</span> = i + 1

        <span style="color: #f92672; font-weight: bold;">elif</span> doublequote_p(char):
            <span style="color: #fd971f;">doublequote_end_index</span> = string.find(<span style="color: #e6db74;">'"'</span>, i+1)
            <span style="color: #f92672; font-weight: bold;">if</span> doublequote_end_index == -1:
                <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- code_scan (fail"</span>)
                <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  doublequote mismatch"</span>)
                <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  string : {}"</span>.<span style="color: #a6e22e;">format</span>(string))
                error()
            <span style="color: #fd971f;">end</span> = doublequote_end_index + 1
            string_vect.append(string[i:end])
            <span style="color: #fd971f;">i</span> = end

        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">end</span> = find_end(string, i+1)
            string_vect.append(string[i:end])
            <span style="color: #fd971f;">i</span> = end

    <span style="color: #f92672; font-weight: bold;">return</span> string_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org772840e" class="outline-4">
<h4 id="org772840e">find_end</h4>
<div class="outline-text-4" id="text-org772840e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">find_end</span>(string, begin):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #fd971f;">i</span> = begin
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
       <span style="color: #f92672; font-weight: bold;">if</span> i == length:
           <span style="color: #f92672; font-weight: bold;">return</span> i
       <span style="color: #fd971f;">char</span> = string[i]
       <span style="color: #f92672; font-weight: bold;">if</span> (space_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
           delimiter_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
           doublequote_p(char)):
           <span style="color: #f92672; font-weight: bold;">return</span> i
       <span style="color: #fd971f;">i</span> = i + 1
</pre>
</div>
</div>
</div>

<div id="outline-container-org17470e1" class="outline-4">
<h4 id="org17470e1">space_p</h4>
<div class="outline-text-4" id="text-org17470e1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">space_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> char.isspace()
</pre>
</div>
</div>
</div>

<div id="outline-container-org51cc0b4" class="outline-4">
<h4 id="org51cc0b4">delimiter_p</h4>
<div class="outline-text-4" id="text-org51cc0b4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">delimiter_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> (char == <span style="color: #e6db74;">'('</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">')'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'['</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">']'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'{'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'}'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">','</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'`'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">"'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge41ed1" class="outline-4">
<h4 id="orge41ed1">doublequote_p</h4>
<div class="outline-text-4" id="text-orge41ed1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequote_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> char == <span style="color: #e6db74;">'"'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfa71389" class="outline-3">
<h3 id="orgfa71389">null &amp; cons</h3>
<div class="outline-text-3" id="text-orgfa71389">
</div><div id="outline-container-org51a0463" class="outline-4">
<h4 id="org51a0463">Null</h4>
<div class="outline-text-4" id="text-org51a0463">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Null</span>:
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3dd83f0" class="outline-4">
<h4 id="org3dd83f0">null</h4>
<div class="outline-text-4" id="text-org3dd83f0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">null</span> = Null()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc0505" class="outline-4">
<h4 id="orgdc0505">null_p</h4>
<div class="outline-text-4" id="text-orgdc0505">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">null_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x == null
</pre>
</div>
</div>
</div>

<div id="outline-container-org2063d86" class="outline-4">
<h4 id="org2063d86">Cons</h4>
<div class="outline-text-4" id="text-org2063d86">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Cons</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, car, cdr):
        <span style="color: #f92672; font-weight: bold;">self</span>.car = car
        <span style="color: #f92672; font-weight: bold;">self</span>.cdr = cdr
</pre>
</div>
</div>
</div>

<div id="outline-container-org396b87f" class="outline-4">
<h4 id="org396b87f">cons</h4>
<div class="outline-text-4" id="text-org396b87f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons</span>(car, cdr):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(cdr) <span style="color: #f92672; font-weight: bold;">or</span> cons_p(cdr):
        <span style="color: #f92672; font-weight: bold;">return</span> Cons(car, cdr)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- cons fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  cdr of cons must be a cons or null"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  cdr : {}"</span>.<span style="color: #a6e22e;">format</span>(cdr))
        error()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf9207d" class="outline-4">
<h4 id="orgaf9207d">cons_p</h4>
<div class="outline-text-4" id="text-orgaf9207d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">isinstance</span>(x, Cons)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ac01d2" class="outline-4">
<h4 id="org6ac01d2">cdr</h4>
<div class="outline-text-4" id="text-org6ac01d2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cdr</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x.cdr
</pre>
</div>
</div>
</div>

<div id="outline-container-org7741c5b" class="outline-4">
<h4 id="org7741c5b">car</h4>
<div class="outline-text-4" id="text-org7741c5b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">car</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x.car
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfe8c6bb" class="outline-3">
<h3 id="orgfe8c6bb"><span class="todo _note_">[note]</span> syntax sugar</h3>
<div class="outline-text-3" id="text-orgfe8c6bb">
<ul class="org-ul">
<li><p>[&#x2026;] -&gt; (begin &#x2026;)</p></li>
<li><p>{&#x2026;} -&gt; (clo &#x2026;)</p></li>
<li><p>' &#x2026; -&gt; (quote &#x2026;)</p></li>
<li><p>` &#x2026; -&gt; (partquote &#x2026;)</p></li></ul>
</div>
</div>

<div id="outline-container-org7f324bd" class="outline-3">
<h3 id="org7f324bd">parse_sexp_vect &#x2013; string vect to sexp vect</h3>
<div class="outline-text-3" id="text-org7f324bd">
<ul class="org-ul">
<li><p>sexp := Null | Cons(sexp, sexp_list) | string</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp_vect</span>(string_vect):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string_vect)
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #fd971f;">sexp_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
       <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i</span> = parse_sexp(string_vect, i)
       sexp_vect.append(s)
    <span style="color: #f92672; font-weight: bold;">return</span> sexp_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a1d31c" class="outline-3">
<h3 id="org8a1d31c">parse_sexp</h3>
<div class="outline-text-3" id="text-org8a1d31c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp</span>(string_vect, i):
    <span style="color: #fd971f;">string</span> = string_vect[i]
    <span style="color: #f92672; font-weight: bold;">if</span> string == <span style="color: #e6db74;">'('</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">')'</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'['</span>:
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i1</span> = parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">']'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'begin'</span>, s_cons), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'{'</span>:
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i1</span> = parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">'}'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'clo'</span>, s_cons), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"'"</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i+1)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'quote'</span>, cons(s, null)), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"`"</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i+1)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'partquote'</span>, cons(s, null)), i1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> (string, i+1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ac8c0b" class="outline-3">
<h3 id="org8ac8c0b">parse_sexp_cons_until_ket</h3>
<div class="outline-text-3" id="text-org8ac8c0b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp_cons_until_ket</span>(string_vect, i, ket):
    <span style="color: #fd971f;">string</span> = string_vect[i]
    <span style="color: #f92672; font-weight: bold;">if</span> string == ket:
        <span style="color: #f92672; font-weight: bold;">return</span> (null, i+1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i)
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i2</span> = \
            parse_sexp_cons_until_ket(string_vect, i1, ket)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(s, s_cons), i2)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2c7049" class="outline-3">
<h3 id="orgb2c7049">p_print</h3>
<div class="outline-text-3" id="text-orgb2c7049">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_print</span>(x):
    <span style="color: #f92672; font-weight: bold;">print</span>(x, end=<span style="color: #e6db74;">""</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ef3db7" class="outline-3">
<h3 id="org1ef3db7">sexp_print</h3>
<div class="outline-text-3" id="text-org1ef3db7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_print</span>(s):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(s):
        p_print(<span style="color: #e6db74;">"null"</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(s):
        p_print(<span style="color: #e6db74;">"("</span>)
        sexp_list_print(s)
        p_print(<span style="color: #e6db74;">")"</span>)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-org72f30c9" class="outline-3">
<h3 id="org72f30c9">sexp_list_print</h3>
<div class="outline-text-3" id="text-org72f30c9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_list_print</span>(s_cons):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(s_cons):
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> null_p(cdr(s_cons)):
        sexp_print(car(s_cons))
    <span style="color: #f92672; font-weight: bold;">else</span>:
        sexp_print(car(s_cons))
        p_print(<span style="color: #e6db74;">" "</span>)
        sexp_list_print(cdr(s_cons))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org62c1694" class="outline-2">
<h2 id="org62c1694">compiler</h2>
<div class="outline-text-2" id="text-org62c1694">
</div><div id="outline-container-org9361b5f" class="outline-3">
<h3 id="org9361b5f">new_module</h3>
<div class="outline-text-3" id="text-org9361b5f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">new_module</span>(name):
    <span style="color: #fd971f;">module</span> = types.ModuleType(name)
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">for top level sexp</span>
    <span style="color: #fd971f;">module.vm</span> = VM([], [])
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">for name can occur before been defined</span>
    <span style="color: #fd971f;">module.defined_name_set</span> = <span style="color: #a6e22e;">set</span>()
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c555ff" class="outline-3">
<h3 id="org7c555ff">jojo_define</h3>
<div class="outline-text-3" id="text-org7c555ff">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jojo_define</span>(module, name, value):
    module.defined_name_set.add(name)
    <span style="color: #a6e22e;">setattr</span>(module, name, value)
</pre>
</div>
</div>
</div>

<div id="outline-container-org31edba9" class="outline-3">
<h3 id="org31edba9">merge_prim_dict</h3>
<div class="outline-text-3" id="text-org31edba9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_prim_dict</span>(module):
    <span style="color: #f92672; font-weight: bold;">for</span> name, value <span style="color: #f92672; font-weight: bold;">in</span> prim_dict.items():
        jojo_define(module, name, value)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdccd4e8" class="outline-3">
<h3 id="orgdccd4e8">merge_module</h3>
<div class="outline-text-3" id="text-orgdccd4e8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_module</span>(module, src_module):
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> src_module.defined_name_set:
        <span style="color: #fd971f;">jojo</span> = <span style="color: #a6e22e;">getattr</span>(src_module, name)
        jojo_define(module, name, jojo)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b1a68d" class="outline-3">
<h3 id="org7b1a68d">merge_sexp_vect</h3>
<div class="outline-text-3" id="text-org7b1a68d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_sexp_vect</span>(module, sexp_vect):
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #fd971f;">jo_vect</span> = sexp_emit(module, sexp)
        module.vm.rs.append(RP(JOJO(jo_vect)))
        module.vm.exe()
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org6cc7769" class="outline-3">
<h3 id="org6cc7769">compile_module</h3>
<div class="outline-text-3" id="text-org6cc7769">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">compile_module</span>(name, sexp_vect):
    <span style="color: #fd971f;">module</span> = new_module(name)
    merge_prim_dict(module)
    merge_module(module, core_module)
    merge_sexp_vect(module, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd93192f" class="outline-3">
<h3 id="orgd93192f">compile_core_module</h3>
<div class="outline-text-3" id="text-orgd93192f">
<ul class="org-ul">
<li><p>compile the core_module itself</p><p>without merging core_module</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">compile_core_module</span>(name, sexp_vect):
    <span style="color: #fd971f;">module</span> = new_module(name)
    merge_prim_dict(module)
    merge_sexp_vect(module, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org5dd7b34" class="outline-3">
<h3 id="org5dd7b34">sexp_list_emit</h3>
<div class="outline-text-3" id="text-org5dd7b34">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_list_emit</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        jo_vect.extend(sexp_emit(module, sexp))
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c5f548" class="outline-3">
<h3 id="org4c5f548">sexp_emit</h3>
<div class="outline-text-3" id="text-org4c5f548">
</div><div id="outline-container-org77cf493" class="outline-4">
<h4 id="org77cf493">sexp_emit</h4>
<div class="outline-text-4" id="text-org77cf493">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_emit</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> null_emit(module, sexp)
    <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> cons_emit(module, sexp)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> string_emit(module, sexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9942096" class="outline-4">
<h4 id="org9942096">null_emit</h4>
<div class="outline-text-4" id="text-org9942096">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">null_emit</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">return</span> [null]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8374a4" class="outline-4">
<h4 id="orgb8374a4">cons_emit</h4>
<div class="outline-text-4" id="text-orgb8374a4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons_emit</span>(module, cons):
    <span style="color: #fd971f;">keyword</span> = car(cons)
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">keyword can not have dot-in-name</span>
    <span style="color: #f92672; font-weight: bold;">if</span> keyword <span style="color: #f92672; font-weight: bold;">in</span> keyword_dict.keys():
        <span style="color: #fd971f;">fun</span> = keyword_dict[keyword]
        <span style="color: #f92672; font-weight: bold;">return</span> fun(module, cdr(cons))
    <span style="color: #f92672; font-weight: bold;">elif</span> keyword <span style="color: #f92672; font-weight: bold;">in</span> macro_dict.keys():
        <span style="color: #fd971f;">fun</span> = macro_dict[keyword]
        <span style="color: #fd971f;">new_sexp</span> = fun(cdr(cons))
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_emit(module, new_sexp)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #FF8888;"># </span><span style="color: #FF8888;">a call to string_emit</span>
        <span style="color: #FF8888;"># </span><span style="color: #FF8888;">handles dot-in-name in head of sexp</span>
        <span style="color: #fd971f;">vm</span> = VM([cdr(cons)],
                [RP(JOJO(string_emit(module, keyword)))])
        vm.exe()
        <span style="color: #fd971f;">new_sexp</span> = vm.ds[0]
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_emit(module, new_sexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf69de6c" class="outline-4">
<h4 id="orgf69de6c">string_emit</h4>
<div class="outline-text-4" id="text-orgf69de6c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_emit</span>(module, string):
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">special strings</span>
    <span style="color: #f92672; font-weight: bold;">for</span> p, e <span style="color: #f92672; font-weight: bold;">in</span> string_emitter_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> p(string):
            <span style="color: #f92672; font-weight: bold;">return</span> e(module, string)

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">dot in string</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'.'</span> <span style="color: #f92672; font-weight: bold;">in</span> string:
        <span style="color: #f92672; font-weight: bold;">return</span> dot_in_string_emit(module, string)

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">built-in keyword</span>
    <span style="color: #f92672; font-weight: bold;">if</span> string <span style="color: #f92672; font-weight: bold;">in</span> key_jo_dict.keys():
        <span style="color: #f92672; font-weight: bold;">return</span> key_jo_dict[string]

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">normal function call</span>
    <span style="color: #f92672; font-weight: bold;">return</span> [CALL_FROM_MODULE(module, string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b72ecd" class="outline-4">
<h4 id="org6b72ecd">dot_in_string_emit</h4>
<div class="outline-text-4" id="text-org6b72ecd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dot_in_string_emit</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)
    <span style="color: #fd971f;">head_string</span> = string_vect[0]
    <span style="color: #f92672; font-weight: bold;">if</span> head_string == <span style="color: #e6db74;">''</span>:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        jo_vect.extend(string_emit(module, head_string))

    <span style="color: #fd971f;">tail_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> s <span style="color: #f92672; font-weight: bold;">in</span> tail_string_vect:
        <span style="color: #fd971f;">s1</span> = <span style="color: #e6db74;">'.'</span> + s
        jo_vect.extend(string_emit(module, s1))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcca88fc" class="outline-4">
<h4 id="orgcca88fc">string_emitter_vect &amp; @string_emitter</h4>
<div class="outline-text-4" id="text-orgcca88fc">
</div><div id="outline-container-org2d69f8e" class="outline-5">
<h5 id="org2d69f8e">string_emitter_vect</h5>
<div class="outline-text-5" id="text-org2d69f8e">
<ul class="org-ul">
<li><p>vect is used,</p><p>for the order matters.</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">string_emitter_vect</span> = []
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1bf490" class="outline-5">
<h5 id="orge1bf490">@string_emitter</h5>
<div class="outline-text-5" id="text-orge1bf490">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_emitter</span>(p):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(emitter):
        string_emitter_vect.append((p, emitter))
        <span style="color: #f92672; font-weight: bold;">return</span> emitter
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bb099f" class="outline-5">
<h5 id="org1bb099f">int_string_p</h5>
<div class="outline-text-5" id="text-org1bb099f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #f92672; font-weight: bold;">if</span> length == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] == <span style="color: #e6db74;">'-'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(string[1:])
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f71eef" class="outline-5">
<h5 id="org2f71eef">nat_string_p</h5>
<div class="outline-text-5" id="text-org2f71eef">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">nat_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">return</span> string.isdecimal()
</pre>
</div>
</div>
</div>

<div id="outline-container-org64d909b" class="outline-5">
<h5 id="org64d909b">int_string_emitter</h5>
<div class="outline-text-5" id="text-org64d909b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@string_emitter</span>(int_string_p)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_string_emitter</span>(module, string):
    <span style="color: #f92672; font-weight: bold;">return</span> [<span style="color: #a6e22e;">int</span>(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda8269f" class="outline-5">
<h5 id="orgda8269f">doublequoted_string_p</h5>
<div class="outline-text-5" id="text-orgda8269f">
<ul class="org-ul">
<li><p>"doublequoted"</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequoted_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge34e7c7" class="outline-5">
<h5 id="orge34e7c7">doublequoted_string_emitter</h5>
<div class="outline-text-5" id="text-orge34e7c7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@string_emitter</span>(doublequoted_string_p)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequoted_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [string]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc123894" class="outline-5">
<h5 id="orgc123894">local_string_p</h5>
<div class="outline-text-5" id="text-orgc123894">
<ul class="org-ul">
<li><p>:local</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] == <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1f7aa" class="outline-5">
<h5 id="orgd1f7aa">local_string_emitter</h5>
<div class="outline-text-5" id="text-orgd1f7aa">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@string_emitter</span>(local_string_p)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_string_emitter</span>(module, string):
    <span style="color: #f92672; font-weight: bold;">return</span> [GET(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc672b5" class="outline-5">
<h5 id="orgcc672b5">set_local_string_p</h5>
<div class="outline-text-5" id="text-orgcc672b5">
<ul class="org-ul">
<li><p>:local!</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_local_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org804d9cf" class="outline-5">
<h5 id="org804d9cf">set_local_string_emitter</h5>
<div class="outline-text-5" id="text-org804d9cf">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@string_emitter</span>(set_local_string_p)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_local_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [SET(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf59c585" class="outline-5">
<h5 id="orgf59c585">message_string_p</h5>
<div class="outline-text-5" id="text-orgf59c585">
<ul class="org-ul">
<li><p>.message</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] == <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org26e3658" class="outline-5">
<h5 id="org26e3658">message_string_emitter</h5>
<div class="outline-text-5" id="text-org26e3658">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@string_emitter</span>(message_string_p)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:]
    <span style="color: #f92672; font-weight: bold;">return</span> [MSG(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org57305eb" class="outline-5">
<h5 id="org57305eb">set_message_string_p</h5>
<div class="outline-text-5" id="text-org57305eb">
<ul class="org-ul">
<li><p>.message!</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3736b97" class="outline-5">
<h5 id="org3736b97">set_message_string_emitter</h5>
<div class="outline-text-5" id="text-org3736b97">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@string_emitter</span>(set_message_string_p)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [SET_FIELD(string)]
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org5e25feb" class="outline-2">
<h2 id="org5e25feb">prim_dict</h2>
<div class="outline-text-2" id="text-org5e25feb">
</div><div id="outline-container-org7c6fd16" class="outline-3">
<h3 id="org7c6fd16">prim_dict &amp; @prim</h3>
<div class="outline-text-3" id="text-org7c6fd16">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">prim_dict</span> = {}

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">prim</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">prim_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fd3408" class="outline-3">
<h3 id="org4fd3408"><b>stack operation</b></h3>
<div class="outline-text-3" id="text-org4fd3408">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'drop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">drop</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">None</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dup'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dup</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(a, a)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'over'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">over</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(a, b, a)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuck'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuck</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(b, a, b)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'swap'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">swap</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(b, a)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ca7e41" class="outline-3">
<h3 id="org2ca7e41"><b>int</b></h3>
<div class="outline-text-3" id="text-org2ca7e41">
</div><div id="outline-container-orgbbc7958" class="outline-4">
<h4 id="orgbbc7958">Int</h4>
<div class="outline-text-4" id="text-orgbbc7958">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Int'</span>)(<span style="color: #a6e22e;">int</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org28509a0" class="outline-4">
<h4 id="org28509a0">int_p</h4>
<div class="outline-text-4" id="text-org28509a0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'int?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d4c192" class="outline-4">
<h4 id="org1d4c192">primary school</h4>
<div class="outline-text-4" id="text-org1d4c192">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'inc'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">inc</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> a + 1

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dec'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dec</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> a - 1

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'add'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">add</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a + b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'sub'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sub</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a - b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'mul'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">mul</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a * b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'div'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">div</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a // b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'mod'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">mod</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a % b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'divmod'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_divmod</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(*<span style="color: #a6e22e;">divmod</span>(a, b))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9589261" class="outline-4">
<h4 id="org9589261">compare</h4>
<div class="outline-text-4" id="text-org9589261">
</div><div id="outline-container-org407e9ba" class="outline-5">
<h5 id="org407e9ba">lt_p &#x2013; less then</h5>
<div class="outline-text-5" id="text-org407e9ba">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'lt?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">lt_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &lt; b
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fcc1a3" class="outline-5">
<h5 id="org6fcc1a3">gt_p &#x2013; greater then</h5>
<div class="outline-text-5" id="text-org6fcc1a3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'gt?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">gt_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &gt; b
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdaeb455" class="outline-5">
<h5 id="orgdaeb455">lteq_p &#x2013; less then or equal to</h5>
<div class="outline-text-5" id="text-orgdaeb455">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'lteq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">lteq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &lt;= b
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbde813" class="outline-5">
<h5 id="orgbde813">gteq_p &#x2013; greater then or equal to</h5>
<div class="outline-text-5" id="text-orgbde813">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'gteq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">gteq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &gt;= b
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1859f36" class="outline-4">
<h4 id="org1859f36">int_print</h4>
<div class="outline-text-4" id="text-org1859f36">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'int-print'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_print</span>(i):
    p_print(i)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga45c51f" class="outline-3">
<h3 id="orga45c51f"><b>bool</b></h3>
<div class="outline-text-3" id="text-orga45c51f">
</div><div id="outline-container-org8dcb765" class="outline-4">
<h4 id="org8dcb765">Bool</h4>
<div class="outline-text-4" id="text-org8dcb765">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Bool'</span>)(<span style="color: #a6e22e;">bool</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org835d87a" class="outline-4">
<h4 id="org835d87a">basic</h4>
<div class="outline-text-4" id="text-org835d87a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'true'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">true</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'false'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">false</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'not'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_not</span>(b):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #f92672; font-weight: bold;">not</span> b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'and'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_and</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> (a <span style="color: #f92672; font-weight: bold;">and</span> b)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'or'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_or</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> (a <span style="color: #f92672; font-weight: bold;">or</span> b)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf158587" class="outline-3">
<h3 id="orgf158587"><b>equivalence</b></h3>
<div class="outline-text-3" id="text-orgf158587">
</div><div id="outline-container-orge3a4cb" class="outline-4">
<h4 id="orge3a4cb">eq_p</h4>
<div class="outline-text-4" id="text-orge3a4cb">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'eq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">eq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">if</span> string_p(a):
        <span style="color: #f92672; font-weight: bold;">return</span> a == b
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> a <span style="color: #f92672; font-weight: bold;">is</span> b
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecb8390" class="outline-4">
<h4 id="orgecb8390">eqv_p</h4>
<div class="outline-text-4" id="text-orgecb8390">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'eqv?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">eqv_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a == b
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org414ef7f" class="outline-3">
<h3 id="org414ef7f"><b>sexp</b></h3>
<div class="outline-text-3" id="text-org414ef7f">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'null'</span>)(null)
prim(<span style="color: #e6db74;">'null?'</span>)(null_p)

prim(<span style="color: #e6db74;">'cons'</span>)(cons)
prim(<span style="color: #e6db74;">'cons?'</span>)(cons_p)

prim(<span style="color: #e6db74;">'car'</span>)(car)
prim(<span style="color: #e6db74;">'cdr'</span>)(cdr)

prim(<span style="color: #e6db74;">'sexp-print'</span>)(sexp_print)
prim(<span style="color: #e6db74;">'sexp-list-print'</span>)(sexp_list_print)

prim(<span style="color: #e6db74;">'code-scan'</span>)(code_scan)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9113d0" class="outline-3">
<h3 id="orgf9113d0"><b>string</b></h3>
<div class="outline-text-3" id="text-orgf9113d0">
</div><div id="outline-container-org733b0aa" class="outline-4">
<h4 id="org733b0aa">String</h4>
<div class="outline-text-4" id="text-org733b0aa">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'String'</span>)(<span style="color: #a6e22e;">str</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org23c485b" class="outline-4">
<h4 id="org23c485b">string_p</h4>
<div class="outline-text-4" id="text-org23c485b">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'string?'</span>)(string_p)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3c6b45" class="outline-4">
<h4 id="orgf3c6b45">string_print</h4>
<div class="outline-text-4" id="text-orgf3c6b45">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-print'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_print</span>(string):
    p_print(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org8551cea" class="outline-4">
<h4 id="org8551cea">string_length</h4>
<div class="outline-text-4" id="text-org8551cea">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string_length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_length</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb012de" class="outline-4">
<h4 id="orgbb012de">string_ref</h4>
<div class="outline-text-4" id="text-orgbb012de">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_ref</span>(string, index):
    <span style="color: #f92672; font-weight: bold;">return</span> string[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b8c36a" class="outline-4">
<h4 id="org3b8c36a">string_append</h4>
<div class="outline-text-4" id="text-org3b8c36a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_append</span>(string1, string2):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join([string1, string2])
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbd4a4d" class="outline-4">
<h4 id="orgdbd4a4d">string_slice</h4>
<div class="outline-text-4" id="text-orgdbd4a4d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-slice'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_slice</span>(string, begin, end):
    <span style="color: #f92672; font-weight: bold;">return</span> string[begin:end]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf6726e" class="outline-4">
<h4 id="orgbf6726e">string_empty_p</h4>
<div class="outline-text-4" id="text-orgbf6726e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-empty?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_empty_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(string) == 0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab3d9df" class="outline-4">
<h4 id="orgab3d9df">string_eq_p</h4>
<div class="outline-text-4" id="text-orgab3d9df">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-eq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_eq_p</span>(string1, string2):
    <span style="color: #f92672; font-weight: bold;">return</span> string1 == string2
</pre>
</div>
</div>
</div>

<div id="outline-container-org9890cee" class="outline-4">
<h4 id="org9890cee">string_to_int</h4>
<div class="outline-text-4" id="text-org9890cee">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-&gt;int'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_to_int</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">int</span>(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0685d0" class="outline-4">
<h4 id="orgb0685d0">string predicates</h4>
<div class="outline-text-4" id="text-orgb0685d0">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'int-string?'</span>)(int_string_p)
prim(<span style="color: #e6db74;">'local-string?'</span>)(local_string_p)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf8795c8" class="outline-3">
<h3 id="orgf8795c8"><b>vect</b></h3>
<div class="outline-text-3" id="text-orgf8795c8">
</div><div id="outline-container-org4f93aa3" class="outline-4">
<h4 id="org4f93aa3"><span class="todo _note_">[note]</span> </h4>
<div class="outline-text-4" id="text-org4f93aa3">
<ul class="org-ul">
<li><p>vect is the pivot among :</p><p><ul class="org-ul"></p><p><li><p>list</p></li></p><p><li><p>dict</p></li></p><p><li><p>tuple</p></li></p><p><li><p>set</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-org1bdb24e" class="outline-4">
<h4 id="org1bdb24e">Vect</h4>
<div class="outline-text-4" id="text-org1bdb24e">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Vect'</span>)(Vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5be39c9" class="outline-4">
<h4 id="org5be39c9">vect_p</h4>
<div class="outline-text-4" id="text-org5be39c9">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'vect?'</span>)(vect_p)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5331b48" class="outline-4">
<h4 id="org5331b48">vect_copy</h4>
<div class="outline-text-4" id="text-org5331b48">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-copy'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_copy</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> vect[:]
</pre>
</div>
</div>
</div>

<div id="outline-container-org910e3ce" class="outline-4">
<h4 id="org910e3ce">vect_member_p</h4>
<div class="outline-text-4" id="text-org910e3ce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-member?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_member_p</span>(x, vect):
    <span style="color: #f92672; font-weight: bold;">return</span> x <span style="color: #f92672; font-weight: bold;">in</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org9eb0d0" class="outline-4">
<h4 id="org9eb0d0">vect_length</h4>
<div class="outline-text-4" id="text-org9eb0d0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_length</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d14a75" class="outline-4">
<h4 id="org7d14a75">vect_ref</h4>
<div class="outline-text-4" id="text-org7d14a75">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_ref</span>(vect, index):
    <span style="color: #f92672; font-weight: bold;">return</span> vect[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b6eca4" class="outline-4">
<h4 id="org9b6eca4">vect_append &#x2013; no-side-effect</h4>
<div class="outline-text-4" id="text-org9b6eca4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_append</span>(vect1, vect2):
    <span style="color: #fd971f;">vect1_copy</span> = vect_copy(vect1)
    vect1_copy.extend(vect2)
    <span style="color: #f92672; font-weight: bold;">return</span> vect1_copy
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b10110" class="outline-4">
<h4 id="org1b10110">vect_zip_dict</h4>
<div class="outline-text-4" id="text-org1b10110">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-zip-dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_zip_dict</span>(v1, v2):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(v1) != <span style="color: #a6e22e;">len</span>(v2):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- vect_zip_dict fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of vect1"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"    is not equal to length of vect2"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of vect1 : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(v1)))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of vect2 : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(v2)))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  vect1 : {}"</span>.<span style="color: #a6e22e;">format</span>(v1))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  vect2 : {}"</span>.<span style="color: #a6e22e;">format</span>(v2))
        error()
    <span style="color: #fd971f;">d</span> = {}
    <span style="color: #f92672; font-weight: bold;">for</span> k, v <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #a6e22e;">zip</span>(v1, v2):
       <span style="color: #fd971f;">d</span>[k] = v
    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf58cda8" class="outline-4">
<h4 id="orgf58cda8">vect_to_sexp</h4>
<div class="outline-text-4" id="text-orgf58cda8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;sexp'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_sexp</span>(vect):
    <span style="color: #f92672; font-weight: bold;">if</span> vect == []:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #f92672; font-weight: bold;">not</span> vect_p(vect):
        <span style="color: #f92672; font-weight: bold;">return</span> vect
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(vect_to_sexp(vect[0]),
                    vect_to_sexp(vect[1:]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a1268a" class="outline-4">
<h4 id="org7a1268a">sexp_to_vect</h4>
<div class="outline-text-4" id="text-org7a1268a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'sexp-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_to_vect</span>(sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> string_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> sexp
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(sexp)
    <span style="color: #fd971f;">result_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> s <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        result_vect.append(sexp_to_vect(s))
    <span style="color: #f92672; font-weight: bold;">return</span> result_vect
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org22fefac" class="outline-3">
<h3 id="org22fefac"><b>stack</b></h3>
<div class="outline-text-3" id="text-org22fefac">
</div><div id="outline-container-org3a952d0" class="outline-4">
<h4 id="org3a952d0">stack</h4>
<div class="outline-text-4" id="text-org3a952d0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">Stack</span> = Vect

prim(<span style="color: #e6db74;">'Stack'</span>)(Stack)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0e8a7" class="outline-4">
<h4 id="orgf0e8a7">stack_p</h4>
<div class="outline-text-4" id="text-orgf0e8a7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == Stack
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e5587" class="outline-4">
<h4 id="org6e5587">stack_pop</h4>
<div class="outline-text-4" id="text-org6e5587">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-pop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_pop</span>(stack):
    <span style="color: #f92672; font-weight: bold;">return</span> stack.pop()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc80b1bd" class="outline-4">
<h4 id="orgc80b1bd">stack_push</h4>
<div class="outline-text-4" id="text-orgc80b1bd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-push'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_push</span>(value, stack):
    stack.append(value)
    <span style="color: #f92672; font-weight: bold;">return</span> stack
</pre>
</div>
</div>
</div>

<div id="outline-container-org11cf8b3" class="outline-4">
<h4 id="org11cf8b3">stack_drop</h4>
<div class="outline-text-4" id="text-org11cf8b3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-drop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_drop</span>(stack):
    stack.pop()
    <span style="color: #f92672; font-weight: bold;">return</span> stack
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde4f849" class="outline-4">
<h4 id="orgde4f849">stack_dup</h4>
<div class="outline-text-4" id="text-orgde4f849">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-dup'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_dup</span>(stack):
    <span style="color: #fd971f;">a</span> = stack.pop()
    stack.append(a)
    <span style="color: #f92672; font-weight: bold;">return</span> stack
</pre>
</div>
</div>
</div>

<div id="outline-container-orga63cdde" class="outline-4">
<h4 id="orga63cdde">stack_over</h4>
<div class="outline-text-4" id="text-orga63cdde">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-over'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_over</span>(stack):
    <span style="color: #fd971f;">a</span> = stack.pop()
    <span style="color: #fd971f;">b</span> = stack.pop()
    stack.append(b)
    stack.append(a)
    stack.append(b)
    <span style="color: #f92672; font-weight: bold;">return</span> stack
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad0abfb" class="outline-4">
<h4 id="orgad0abfb">stack_tuck</h4>
<div class="outline-text-4" id="text-orgad0abfb">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-tuck'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_tuck</span>(stack):
    <span style="color: #fd971f;">a</span> = stack.pop()
    <span style="color: #fd971f;">b</span> = stack.pop()
    stack.append(a)
    stack.append(b)
    stack.append(a)
    <span style="color: #f92672; font-weight: bold;">return</span> stack
</pre>
</div>
</div>
</div>

<div id="outline-container-org572b73f" class="outline-4">
<h4 id="org572b73f">stack_swap</h4>
<div class="outline-text-4" id="text-org572b73f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-swap'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_swap</span>(stack):
    <span style="color: #fd971f;">a</span> = stack.pop()
    <span style="color: #fd971f;">b</span> = stack.pop()
    stack.append(a)
    stack.append(b)
    <span style="color: #f92672; font-weight: bold;">return</span> stack
</pre>
</div>
</div>
</div>

<div id="outline-container-org88e5da4" class="outline-4">
<h4 id="org88e5da4">stack_length</h4>
<div class="outline-text-4" id="text-org88e5da4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_length</span>(stack):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(stack)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge91e831" class="outline-4">
<h4 id="orge91e831">stack_empty_p</h4>
<div class="outline-text-4" id="text-orge91e831">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'stack-empty?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">stack_empty_p</span>(stack):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(stack) == 0
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc241e16" class="outline-3">
<h3 id="orgc241e16"><b>list</b></h3>
<div class="outline-text-3" id="text-orgc241e16">
</div><div id="outline-container-orgada9b75" class="outline-4">
<h4 id="orgada9b75">Null &amp; Cons</h4>
<div class="outline-text-4" id="text-orgada9b75">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'&lt;null&gt;'</span>)(Null)
prim(<span style="color: #e6db74;">'&lt;cons&gt;'</span>)(Cons)
</pre>
</div>
</div>
</div>

<div id="outline-container-org93c302c" class="outline-4">
<h4 id="org93c302c">list_p</h4>
<div class="outline-text-4" id="text-org93c302c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> null_p(x) <span style="color: #f92672; font-weight: bold;">or</span> cons_p(x)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae27e63" class="outline-4">
<h4 id="orgae27e63">vect_to_list</h4>
<div class="outline-text-4" id="text-orgae27e63">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;list'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_list</span>(vect):
    <span style="color: #f92672; font-weight: bold;">if</span> vect == []:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(vect[0], vect_to_list(vect[1:]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaab0ab9" class="outline-4">
<h4 id="orgaab0ab9">list_to_vect</h4>
<div class="outline-text-4" id="text-orgaab0ab9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_to_vect</span>(l):
    <span style="color: #fd971f;">vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(l):
        vect.append(car(l))
        <span style="color: #fd971f;">l</span> = cdr(l)
    <span style="color: #f92672; font-weight: bold;">return</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef86525" class="outline-4">
<h4 id="orgef86525">list_length</h4>
<div class="outline-text-4" id="text-orgef86525">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_length</span>(l):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
        <span style="color: #f92672; font-weight: bold;">return</span> 0
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> list_length(cdr(l)) + 1
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9e32b4" class="outline-4">
<h4 id="orgc9e32b4">list_ref</h4>
<div class="outline-text-4" id="text-orgc9e32b4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_ref</span>(l, i):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- list_ref fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  index greater then length of list"</span>)
        error()
    <span style="color: #f92672; font-weight: bold;">elif</span> i == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> car(l)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> list_ref(cdr(l), i-1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbaaa7b" class="outline-4">
<h4 id="orgfbaaa7b">list_append</h4>
<div class="outline-text-4" id="text-orgfbaaa7b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_append</span>(ante, succ):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(ante):
        <span style="color: #f92672; font-weight: bold;">return</span> succ
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(car(ante),
                    list_append(cdr (ante), succ))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1168c5d" class="outline-4">
<h4 id="org1168c5d">tail_cons</h4>
<div class="outline-text-4" id="text-org1168c5d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tail_cons</span>(ante, value):
    <span style="color: #f92672; font-weight: bold;">return</span> list_append(ante, cons(value, null))
</pre>
</div>
</div>
</div>

<div id="outline-container-org525473b" class="outline-4">
<h4 id="org525473b">list_zip_dict</h4>
<div class="outline-text-4" id="text-org525473b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list-zip-dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_zip_dict</span>(l1, l2):
    <span style="color: #fd971f;">v1</span> = list_to_vect(l1)
    <span style="color: #fd971f;">v2</span> = list_to_vect(l2)
    <span style="color: #f92672; font-weight: bold;">return</span> vect_zip_dict(v1, v2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9b5ccc1" class="outline-3">
<h3 id="org9b5ccc1"><b>dict</b></h3>
<div class="outline-text-3" id="text-org9b5ccc1">
</div><div id="outline-container-org81257fe" class="outline-4">
<h4 id="org81257fe">Dict</h4>
<div class="outline-text-4" id="text-org81257fe">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">Dict</span> = <span style="color: #a6e22e;">dict</span>

prim(<span style="color: #e6db74;">'Dict'</span>)(Dict)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7754b4" class="outline-4">
<h4 id="orgf7754b4">dict_p</h4>
<div class="outline-text-4" id="text-orgf7754b4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == Dict
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ce98b0" class="outline-4">
<h4 id="org8ce98b0">dict_copy</h4>
<div class="outline-text-4" id="text-org8ce98b0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-copy'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_copy</span>(d):
    <span style="color: #f92672; font-weight: bold;">return</span> d.copy()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4a7206" class="outline-4">
<h4 id="orgf4a7206">vect_to_dict</h4>
<div class="outline-text-4" id="text-orgf4a7206">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_dict</span>(vect):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(vect)
    <span style="color: #f92672; font-weight: bold;">if</span> length % 2 != 0:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- vect-&gt;dict fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of vect must be even"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  vect : {}"</span>.<span style="color: #a6e22e;">format</span>(vect))
        error()

    <span style="color: #fd971f;">d</span> = {}
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        <span style="color: #fd971f;">k</span> = vect[i]
        <span style="color: #fd971f;">v</span> = vect[i+1]
        <span style="color: #fd971f;">d</span>[k] = v
        <span style="color: #fd971f;">i</span> = i + 2

    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>

<div id="outline-container-org7dd6082" class="outline-4">
<h4 id="org7dd6082">dict_length</h4>
<div class="outline-text-4" id="text-org7dd6082">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_length</span>(d):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(d)
</pre>
</div>
</div>
</div>

<div id="outline-container-org50b78a7" class="outline-4">
<h4 id="org50b78a7">dict_find</h4>
<div class="outline-text-4" id="text-org50b78a7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-find'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_find</span>(d, k):
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> VALUES(d[k], <span style="color: #ae81ff;">True</span>)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyError</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36d6cdc" class="outline-4">
<h4 id="org36d6cdc">dict_update &#x2013; no-side-effect</h4>
<div class="outline-text-4" id="text-org36d6cdc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-update'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_update</span>(d1, d2):
    <span style="color: #fd971f;">d1</span> = dict_copy(d1)
    <span style="color: #f92672; font-weight: bold;">return</span> d1.update(d2)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e1a8b1" class="outline-4">
<h4 id="org5e1a8b1">dict_delete &#x2013; no-side-effect</h4>
<div class="outline-text-4" id="text-org5e1a8b1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-delete'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_delete</span>(d, k):
    <span style="color: #fd971f;">d</span> = dict_copy(d)
    <span style="color: #f92672; font-weight: bold;">del</span> d[k]
    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9efe3" class="outline-3">
<h3 id="orgc9efe3"><b>tuple</b></h3>
<div class="outline-text-3" id="text-orgc9efe3">
</div><div id="outline-container-org807117e" class="outline-4">
<h4 id="org807117e">Tuple</h4>
<div class="outline-text-4" id="text-org807117e">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Tuple'</span>)(<span style="color: #a6e22e;">tuple</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a75563" class="outline-4">
<h4 id="org9a75563">tuple_p</h4>
<div class="outline-text-4" id="text-org9a75563">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">tuple</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org22b5184" class="outline-4">
<h4 id="org22b5184">vect_to_tuple</h4>
<div class="outline-text-4" id="text-org22b5184">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;tuple'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_tuple</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc63262b" class="outline-4">
<h4 id="orgc63262b">tuple_to_vect</h4>
<div class="outline-text-4" id="text-orgc63262b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_to_vect</span>(tu):
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(tu)
</pre>
</div>
</div>
</div>

<div id="outline-container-org320e7e8" class="outline-4">
<h4 id="org320e7e8">tuple_length</h4>
<div class="outline-text-4" id="text-org320e7e8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_length</span>(tu):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(tu)
</pre>
</div>
</div>
</div>

<div id="outline-container-org91031d5" class="outline-4">
<h4 id="org91031d5">tuple_ref</h4>
<div class="outline-text-4" id="text-org91031d5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_ref</span>(tu, index):
    <span style="color: #f92672; font-weight: bold;">return</span> tu[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org381b714" class="outline-4">
<h4 id="org381b714">tuple_append</h4>
<div class="outline-text-4" id="text-org381b714">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_append</span>(tu1, tu2):
    <span style="color: #fd971f;">vect1</span> = Vect(tu1)
    vect1.extend(tu2)
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(vect1)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbb165ee" class="outline-3">
<h3 id="orgbb165ee"><b>set</b></h3>
<div class="outline-text-3" id="text-orgbb165ee">
</div><div id="outline-container-orge0a2195" class="outline-4">
<h4 id="orge0a2195">Set</h4>
<div class="outline-text-4" id="text-orge0a2195">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Set'</span>)(<span style="color: #a6e22e;">set</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fbc302" class="outline-4">
<h4 id="org6fbc302">set_p</h4>
<div class="outline-text-4" id="text-org6fbc302">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">set</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org23cd41f" class="outline-4">
<h4 id="org23cd41f">vect_to_set</h4>
<div class="outline-text-4" id="text-org23cd41f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;set'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_set</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">set</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2962c05" class="outline-4">
<h4 id="org2962c05">set_to_vect</h4>
<div class="outline-text-4" id="text-org2962c05">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_to_vect</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda9f568" class="outline-4">
<h4 id="orgda9f568">set_length</h4>
<div class="outline-text-4" id="text-orgda9f568">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_length</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6a8cc0" class="outline-4">
<h4 id="orgd6a8cc0">set_member_p</h4>
<div class="outline-text-4" id="text-orgd6a8cc0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-member?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_member_p</span>(x, s):
    <span style="color: #f92672; font-weight: bold;">return</span> x <span style="color: #f92672; font-weight: bold;">in</span> s
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf41d128" class="outline-4">
<h4 id="orgf41d128">high school</h4>
<div class="outline-text-4" id="text-orgf41d128">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-disjoint?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_disjoint_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.isdisjoint(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-subset?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_subset_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.issubset(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-superset?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_superset_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.issuperset(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-union'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_union</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.union(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-intersection'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_intersection</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.intersection(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-difference'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_difference</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.difference(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-symmetric-difference'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_symmetric_difference</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.symmetric_difference(s2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org43b25a8" class="outline-3">
<h3 id="org43b25a8"><b>io</b></h3>
<div class="outline-text-3" id="text-org43b25a8">
</div><div id="outline-container-org8fbf06b" class="outline-4">
<h4 id="org8fbf06b">print</h4>
<div class="outline-text-4" id="text-org8fbf06b">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'print'</span>)(p_print)
</pre>
</div>
</div>
</div>

<div id="outline-container-org151c3f6" class="outline-4">
<h4 id="org151c3f6">nl &#x2013; newline</h4>
<div class="outline-text-4" id="text-org151c3f6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'newline'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">newline</span>():
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">""</span>)

prim(<span style="color: #e6db74;">'nl'</span>)(newline)
</pre>
</div>
</div>
</div>

<div id="outline-container-orged6552" class="outline-4">
<h4 id="orged6552">space</h4>
<div class="outline-text-4" id="text-orged6552">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'space'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">space</span>():
    p_print(<span style="color: #e6db74;">" "</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org50bb495" class="outline-3">
<h3 id="org50bb495"><b>sys</b></h3>
<div class="outline-text-3" id="text-org50bb495">
</div><div id="outline-container-orgb51ce5a" class="outline-4">
<h4 id="orgb51ce5a">bye</h4>
<div class="outline-text-4" id="text-orgb51ce5a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'bye'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">bye</span>():
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"bye bye ^-^/"</span>)
    sys.<span style="color: #ae81ff;">exit</span>()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78b5c70" class="outline-3">
<h3 id="org78b5c70"><b>repl</b></h3>
<div class="outline-text-3" id="text-org78b5c70">
</div><div id="outline-container-org4b3d313" class="outline-4">
<h4 id="org4b3d313">read_sexp</h4>
<div class="outline-text-4" id="text-org4b3d313">
</div><div id="outline-container-orge7af1fd" class="outline-5">
<h5 id="orge7af1fd">read_char</h5>
<div class="outline-text-5" id="text-orge7af1fd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_char</span>(char_stack):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(char_stack) == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> sys.stdin.read(1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> char_stack.pop()
</pre>
</div>
</div>
</div>

<div id="outline-container-org380f80a" class="outline-5">
<h5 id="org380f80a">read_string</h5>
<div class="outline-text-5" id="text-org380f80a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_string</span>(char_stack):
    <span style="color: #fd971f;">char_vect</span> = []
    <span style="color: #fd971f;">collecting_bytes_p</span> = <span style="color: #ae81ff;">False</span>

    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
        <span style="color: #fd971f;">char</span> = read_char(char_stack)
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> collecting_bytes_p:
            <span style="color: #f92672; font-weight: bold;">if</span> space_p(char):
                <span style="color: #f92672; font-weight: bold;">pass</span>
            <span style="color: #f92672; font-weight: bold;">elif</span> doublequote_p(char):
                <span style="color: #f92672; font-weight: bold;">return</span> read_doublequoted_string(char_stack)
            <span style="color: #f92672; font-weight: bold;">elif</span> delimiter_p(char):
                char_vect.append(char)
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                char_vect.append(char)
                <span style="color: #fd971f;">collecting_bytes_p</span> = <span style="color: #ae81ff;">True</span>

        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">if</span> (doublequote_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
                delimiter_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
                space_p(char)):
                char_stack.append(char)
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                char_vect.append(char)

    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join(char_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc410fe8" class="outline-5">
<h5 id="orgc410fe8">read_doublequoted_string</h5>
<div class="outline-text-5" id="text-orgc410fe8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_doublequoted_string</span>(char_stack):
    <span style="color: #fd971f;">char_vect</span> = []
    char_vect.append(<span style="color: #e6db74;">'"'</span>)
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
        <span style="color: #fd971f;">char</span> = read_char(char_stack)
        <span style="color: #f92672; font-weight: bold;">if</span> char == <span style="color: #e6db74;">'"'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            char_vect.append(char)
    char_vect.append(<span style="color: #e6db74;">'"'</span>)
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join(char_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc40a2e" class="outline-5">
<h5 id="orgc40a2e">read_sexp</h5>
<div class="outline-text-5" id="text-orgc40a2e">
<ul class="org-ul">
<li><p>with a char_stack,</p><p>read a sexp from stdin.</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_sexp</span>(char_stack):
    <span style="color: #fd971f;">string</span> = read_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> string == <span style="color: #e6db74;">'('</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">')'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_list
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'['</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">']'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'begin'</span>, sexp_list)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'{'</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">'}'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'clo'</span>, sexp_list)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> read_doublequoted_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"'"</span>:
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'quote'</span>, cons(sexp, null))
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"`"</span>:
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'partquote'</span>, cons(sexp, null))
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> string
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdeabe8d" class="outline-5">
<h5 id="orgdeabe8d">read_sexp_list_until_ket</h5>
<div class="outline-text-5" id="text-orgdeabe8d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_sexp_list_until_ket</span>(char_stack, ket):
    <span style="color: #fd971f;">string</span> = read_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> string == ket:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">char_vect</span> = Vect(string)
        char_vect.reverse()
        char_stack.extend(char_vect)
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #fd971f;">recur</span> = read_sexp_list_until_ket(char_stack, ket)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(sexp, recur)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org105a2fc" class="outline-4">
<h4 id="org105a2fc">print_data_stack</h4>
<div class="outline-text-4" id="text-org105a2fc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">print_data_stack</span>(ds):
    p_print(<span style="color: #e6db74;">"  * {} *  "</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(ds)))
    <span style="color: #f92672; font-weight: bold;">print</span>(ds)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b8e003" class="outline-4">
<h4 id="org5b8e003">print_return_stack</h4>
<div class="outline-text-4" id="text-org5b8e003">
</div><div id="outline-container-org3585476" class="outline-5">
<h5 id="org3585476">print_return_stack</h5>
<div class="outline-text-5" id="text-org3585476">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">print_return_stack</span>(rs):
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- return-stack * {} *"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(rs)))
    <span style="color: #f92672; font-weight: bold;">for</span> rp <span style="color: #f92672; font-weight: bold;">in</span> rs:
        return_point_print(rp)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1da9331" class="outline-5">
<h5 id="org1da9331">return_point_print</h5>
<div class="outline-text-5" id="text-org1da9331">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">return_point_print</span>(rp):
    p_print(<span style="color: #e6db74;">"  - progress : {} / {}"</span>.<span style="color: #a6e22e;">format</span>(rp.cursor, rp.length))
    newline()

    <span style="color: #fd971f;">next_cursor</span> = rp.cursor
    <span style="color: #fd971f;">last_cursor</span> = rp.cursor - 1

    <span style="color: #f92672; font-weight: bold;">if</span> last_cursor == 0:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(<span style="color: #e6db74;">"    pass : "</span>)
        <span style="color: #fd971f;">i</span> = 0
        <span style="color: #f92672; font-weight: bold;">while</span> i &lt; last_cursor:
            jo_print(rp.body[i])
            space()
            <span style="color: #fd971f;">i</span> = i + 1
        newline()

    p_print(<span style="color: #e6db74;">"    last : "</span>)
    jo_print(rp.body[last_cursor])
    newline()

    <span style="color: #f92672; font-weight: bold;">if</span> next_cursor == rp.length:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(<span style="color: #e6db74;">"    next : "</span>)
        <span style="color: #fd971f;">i</span> = next_cursor
        <span style="color: #f92672; font-weight: bold;">while</span> i &lt; rp.length:
            jo_print(rp.body[i])
            space()
            <span style="color: #fd971f;">i</span> = i + 1
        newline()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(rp.lr) == 0:
       <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
       p_print(<span style="color: #e6db74;">"    where : {}"</span>.<span style="color: #a6e22e;">format</span>(rp.lr))
       newline()
</pre>
</div>
</div>
</div>

<div id="outline-container-org281ccd3" class="outline-5">
<h5 id="org281ccd3">jo_print</h5>
<div class="outline-text-5" id="text-org281ccd3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_print</span>(jo):
    <span style="color: #f92672; font-weight: bold;">if</span> fun_p(jo):
        p_print(jo.__module__)
        p_print(<span style="color: #e6db74;">"."</span>)
        p_print(jo.<span style="color: #a6e22e;">__name__</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">hasattr</span>(jo, <span style="color: #e6db74;">"jo_print"</span>):
        jo.jo_print()
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print(jo)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8e34742" class="outline-4">
<h4 id="org8e34742">module_repl</h4>
<div class="outline-text-4" id="text-org8e34742">
</div><div id="outline-container-org20665a0" class="outline-5">
<h5 id="org20665a0"><span class="todo _note_">[note]</span> </h5>
<div class="outline-text-5" id="text-org20665a0">
<ul class="org-ul">
<li><p>a repl_char_stack is added to the module,</p><p>for reading sexp one by one.</p></li></ul>
</div>
</div>

<div id="outline-container-org1c02c5e" class="outline-5">
<h5 id="org1c02c5e">module_repl</h5>
<div class="outline-text-5" id="text-org1c02c5e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_repl</span>(module):
    <span style="color: #fd971f;">module.repl_char_stack</span> = []
    print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            module_repl_one_step(module)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyboardInterrupt</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">except</span> EXIT_MODULE_REPL:
        <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2409838" class="outline-5">
<h5 id="org2409838">EXIT_MODULE_REPL</h5>
<div class="outline-text-5" id="text-org2409838">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">EXIT_MODULE_REPL</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c5ff25" class="outline-5">
<h5 id="org4c5ff25">module_repl_one_step</h5>
<div class="outline-text-5" id="text-org4c5ff25">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_repl_one_step</span>(module):
    <span style="color: #fd971f;">sexp</span> = read_sexp(module.repl_char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'exit'</span>:
        <span style="color: #f92672; font-weight: bold;">raise</span> EXIT_MODULE_REPL()

    <span style="color: #f92672; font-weight: bold;">try</span>:
        merge_sexp_vect(module, [sexp])
        print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">SystemExit</span>:
        sys.<span style="color: #ae81ff;">exit</span>()
    <span style="color: #f92672; font-weight: bold;">except</span>:
        <span style="color: #fd971f;">error_type</span> = sys.exc_info()[0]
        <span style="color: #fd971f;">error_name</span> = error_type.<span style="color: #a6e22e;">__name__</span>
        <span style="color: #fd971f;">error_info</span> = sys.exc_info()[1]
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- error : {}"</span>.<span style="color: #a6e22e;">format</span>(error_name))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  info : {}"</span>.<span style="color: #a6e22e;">format</span>(error_info))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  traceback : "</span>)
        traceback.print_exc()
        call_module_debug(module, 1)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org4c374b3" class="outline-3">
<h3 id="org4c374b3"><b>error</b></h3>
<div class="outline-text-3" id="text-org4c374b3">
</div><div id="outline-container-org6f6e501" class="outline-4">
<h4 id="org6f6e501">error</h4>
<div class="outline-text-4" id="text-org6f6e501">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'error'</span>)(error)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a329f0" class="outline-4">
<h4 id="org4a329f0">module_debug</h4>
<div class="outline-text-4" id="text-org4a329f0">
</div><div id="outline-container-org6483af0" class="outline-5">
<h5 id="org6483af0">module_debug</h5>
<div class="outline-text-5" id="text-org6483af0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'module-debug'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_debug</span>(module, level):
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- enter debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
    <span style="color: #fd971f;">module.debug_repl_char_stack</span> = []
    print_return_stack(module.vm.rs)
    print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            module_debug_one_step(module, level)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyboardInterrupt</span>:
        <span style="color: #fd971f;">module.vm.rs</span> = []
        newline()
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- leave debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  return-stack is cleared"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  for module : {}"</span>.<span style="color: #a6e22e;">format</span>(module.<span style="color: #a6e22e;">__name__</span>))
        print_data_stack(module.vm.ds)
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">except</span> EXIT_MODULE_DEBUG_REPL:
        <span style="color: #fd971f;">module.vm.ds</span> = []
        <span style="color: #fd971f;">module.vm.rs</span> = []
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- exit debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  return-stack is cleared"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data-stack is cleared"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  for module : {}"</span>.<span style="color: #a6e22e;">format</span>(module.<span style="color: #a6e22e;">__name__</span>))
        print_data_stack(module.vm.ds)
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">except</span> LEAVE_MODULE_DEBUG_REPL:
        <span style="color: #fd971f;">module.vm.rs</span> = []
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- leave debug-repl [level : {}]"</span>.<span style="color: #a6e22e;">format</span>(level))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  return-stack is cleared"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  for module : {}"</span>.<span style="color: #a6e22e;">format</span>(module.<span style="color: #a6e22e;">__name__</span>))
        print_data_stack(module.vm.ds)
        <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2c6a95" class="outline-5">
<h5 id="orge2c6a95">EXIT_MODULE_DEBUG_REPL</h5>
<div class="outline-text-5" id="text-orge2c6a95">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">EXIT_MODULE_DEBUG_REPL</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6855de8" class="outline-5">
<h5 id="org6855de8">LEAVE_MODULE_DEBUG_REPL</h5>
<div class="outline-text-5" id="text-org6855de8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">LEAVE_MODULE_DEBUG_REPL</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd852841" class="outline-5">
<h5 id="orgd852841">module_debug_one_step</h5>
<div class="outline-text-5" id="text-orgd852841">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">module_debug_one_step</span>(module, level):
    p_print(<span style="color: #e6db74;">"debug[{}]&gt; "</span>.<span style="color: #a6e22e;">format</span>(level))
    sys.stdout.flush()
    <span style="color: #fd971f;">sexp</span> = read_sexp(module.debug_repl_char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'exit'</span>:
        <span style="color: #f92672; font-weight: bold;">raise</span> EXIT_MODULE_DEBUG_REPL()
    <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'leave'</span>:
        <span style="color: #f92672; font-weight: bold;">raise</span> LEAVE_MODULE_DEBUG_REPL()

    <span style="color: #f92672; font-weight: bold;">try</span>:
        merge_sexp_vect(module, [sexp])
        print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">SystemExit</span>:
        sys.<span style="color: #ae81ff;">exit</span>()
    <span style="color: #f92672; font-weight: bold;">except</span>:
        <span style="color: #fd971f;">error_type</span> = sys.exc_info()[0]
        <span style="color: #fd971f;">error_name</span> = error_type.<span style="color: #a6e22e;">__name__</span>
        <span style="color: #fd971f;">error_info</span> = sys.exc_info()[1]
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- error : {}"</span>.<span style="color: #a6e22e;">format</span>(error_name))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  info : {}"</span>.<span style="color: #a6e22e;">format</span>(error_info))
        p_print(<span style="color: #e6db74;">"  traceback : "</span>)
        traceback.print_exc()
        call_module_debug(module, level + 1)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2424a39" class="outline-4">
<h4 id="org2424a39">call_module_debug</h4>
<div class="outline-text-4" id="text-org2424a39">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">call_module_debug</span>(module, level):
    <span style="color: #fd971f;">jojo</span> = JOJO([module, level, module_debug, nop])
    module.vm.rs.append(RP(jojo))
    module.vm.exe()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2b1fc09" class="outline-3">
<h3 id="org2b1fc09"><b>object</b></h3>
<div class="outline-text-3" id="text-org2b1fc09">
</div><div id="outline-container-org265a2f8" class="outline-4">
<h4 id="org265a2f8">Object</h4>
<div class="outline-text-4" id="text-org265a2f8">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Object'</span>)(<span style="color: #a6e22e;">object</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc425648" class="outline-3">
<h3 id="orgc425648"><b>class</b></h3>
<div class="outline-text-3" id="text-orgc425648">
</div><div id="outline-container-org837cf4b" class="outline-4">
<h4 id="org837cf4b">value_to_class</h4>
<div class="outline-text-4" id="text-org837cf4b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'value-&gt;class'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">value_to_class</span>(value):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(value)
</pre>
</div>
</div>
</div>

<div id="outline-container-org18f49e0" class="outline-4">
<h4 id="org18f49e0">subclass_p</h4>
<div class="outline-text-4" id="text-org18f49e0">
<ul class="org-ul">
<li><p>treat UNION specially</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'subclass?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">subclass_p</span>(c1, c2):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(c2) == UNION:
       <span style="color: #f92672; font-weight: bold;">return</span> c1 <span style="color: #f92672; font-weight: bold;">in</span> c2.get_type_vect()
    <span style="color: #f92672; font-weight: bold;">else</span>:
       <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">issubclass</span>(c1, c2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4524105" class="outline-3">
<h3 id="org4524105"><b>misc</b></h3>
<div class="outline-text-3" id="text-org4524105">
</div><div id="outline-container-orgfa62d47" class="outline-4">
<h4 id="orgfa62d47">nop</h4>
<div class="outline-text-4" id="text-orgfa62d47">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'nop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">nop</span>():
    <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd69166a" class="outline-4">
<h4 id="orgd69166a">none</h4>
<div class="outline-text-4" id="text-orgd69166a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'none'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">none</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(<span style="color: #ae81ff;">None</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org51c08f7" class="outline-4">
<h4 id="org51c08f7">fun_to_positional_default_arg_dict</h4>
<div class="outline-text-4" id="text-org51c08f7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fun_to_positional_default_arg_dict</span>(fun):
    <span style="color: #fd971f;">signature</span> = get_signature(fun)
    <span style="color: #f92672; font-weight: bold;">if</span> signature == <span style="color: #ae81ff;">None</span>:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- fun_to_positional_default_arg_dict"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fail to get signature"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
        error()
    <span style="color: #fd971f;">parameters</span> = signature.parameters
    <span style="color: #f92672; font-weight: bold;">return</span> get_positional_default_arg_dict(parameters)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda95f89" class="outline-4">
<h4 id="orgda95f89">prepare_data_arguments</h4>
<div class="outline-text-4" id="text-orgda95f89">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'prepare-data-arguments'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">prepare_data_arguments</span>(field_vect, value_vect, data):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> class_p(data):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- prepare_data_arguments fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data must be a python class"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data : {}"</span>.<span style="color: #a6e22e;">format</span>(data))
        error()
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">hasattr</span>(data, <span style="color: #e6db74;">'field_name_vect'</span>):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- prepare_data_arguments fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data must has 'field_name_vect' attribute"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data : {}"</span>.<span style="color: #a6e22e;">format</span>(data))
        error()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(field_vect) == 0:
        <span style="color: #fd971f;">normal_value_vect</span> = value_vect
        <span style="color: #fd971f;">field_value_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">len</span>(field_vect) &lt;= <span style="color: #a6e22e;">len</span>(value_vect):
        <span style="color: #fd971f;">normal_value_vect</span> = value_vect[:-<span style="color: #a6e22e;">len</span>(field_vect)]
        <span style="color: #fd971f;">field_value_vect</span> = value_vect[<span style="color: #a6e22e;">len</span>(value_vect)-<span style="color: #a6e22e;">len</span>(field_vect):]
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- prepare_data_arguments fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of field_vect"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"    must be shorter then length of value_vect"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of field_vect : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(field_vect)))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of value_vect : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(value_vect)))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data : {}"</span>.<span style="color: #a6e22e;">format</span>(data))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  field_vect : {}"</span>.<span style="color: #a6e22e;">format</span>(field_vect))
        error()

    <span style="color: #fd971f;">field_dict</span> = <span style="color: #a6e22e;">dict</span>(<span style="color: #a6e22e;">zip</span>(field_vect, field_value_vect))
    <span style="color: #fd971f;">ordered_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> field_name <span style="color: #f92672; font-weight: bold;">in</span> data.field_name_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> field_name <span style="color: #f92672; font-weight: bold;">in</span> field_dict.keys():
            ordered_vect.append(field_dict[field_name])

    <span style="color: #fd971f;">result_vect</span> = normal_value_vect + ordered_vect
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(*result_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb40d6b7" class="outline-4">
<h4 id="orgb40d6b7">keyword_apply</h4>
<div class="outline-text-4" id="text-orgb40d6b7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'keyword-apply'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">keyword_apply</span>(field_vect, value_vect, fun):
    <span style="color: #fd971f;">kwargs</span> = <span style="color: #a6e22e;">dict</span>(<span style="color: #a6e22e;">zip</span>(field_vect, value_vect))
    <span style="color: #f92672; font-weight: bold;">return</span> fun(**kwargs)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org6322a84" class="outline-2">
<h2 id="org6322a84">keyword_dict</h2>
<div class="outline-text-2" id="text-org6322a84">
</div><div id="outline-container-orgf45f98d" class="outline-3">
<h3 id="orgf45f98d"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-orgf45f98d">
<ul class="org-ul">
<li><p>keyword : (-&gt; module, body &#x2013; jo vect)</p></li></ul>
</div>
</div>

<div id="outline-container-orgc04cba6" class="outline-3">
<h3 id="orgc04cba6">keyword_dict</h3>
<div class="outline-text-3" id="text-orgc04cba6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">keyword_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaaf8eda" class="outline-3">
<h3 id="orgaaf8eda">@keyword</h3>
<div class="outline-text-3" id="text-orgaaf8eda">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">keyword</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">keyword_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac7612c" class="outline-3">
<h3 id="orgac7612c">(note)</h3>
<div class="outline-text-3" id="text-orgac7612c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"note"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_note</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3b42d7" class="outline-3">
<h3 id="orgb3b42d7">(begin)</h3>
<div class="outline-text-3" id="text-orgb3b42d7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'begin'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_begin</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> sexp_list_emit(module, body)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3ce4aa" class="outline-3">
<h3 id="orgb3ce4aa">(clo)</h3>
<div class="outline-text-3" id="text-orgb3ce4aa">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'clo'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_clo</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> [CLO(sexp_list_emit(module, body))]
</pre>
</div>
</div>
</div>

<div id="outline-container-org86e5d48" class="outline-3">
<h3 id="org86e5d48">(quote)</h3>
<div class="outline-text-3" id="text-org86e5d48">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'quote'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_quote</span>(module, body):
    <span style="color: #fd971f;">jo_vect</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b7955" class="outline-3">
<h3 id="org94b7955">(partquote)</h3>
<div class="outline-text-3" id="text-org94b7955">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'partquote'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_partquote</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        jo_vect.extend(k_partquote_one(module, sexp))
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_partquote_one</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> cons_p(sexp):
        <span style="color: #f92672; font-weight: bold;">if</span> car(sexp) == <span style="color: #e6db74;">'@'</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> sexp_list_emit(module, cdr(sexp))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">jo_vect</span> = []
            jo_vect.extend([MARK])
            jo_vect.extend(k_partquote(module, sexp))
            jo_vect.extend([COLLECT_LIST])
            <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> [sexp]
</pre>
</div>
</div>
</div>

<div id="outline-container-org69dcfd8" class="outline-3">
<h3 id="org69dcfd8">(-&gt;)</h3>
<div class="outline-text-3" id="text-org69dcfd8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'-&gt;'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_arrow</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> local_string_p(sexp):
            jo_vect.append(SET(sexp))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    jo_vect.reverse()
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf49169b" class="outline-3">
<h3 id="orgf49169b">(list)</h3>
<div class="outline-text-3" id="text-orgf49169b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'list'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_list</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_LIST])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ba42c1" class="outline-3">
<h3 id="org6ba42c1">(vect)</h3>
<div class="outline-text-3" id="text-org6ba42c1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_vect</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org755bd04" class="outline-3">
<h3 id="org755bd04">(stack)</h3>
<div class="outline-text-3" id="text-org755bd04">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'stack'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_stack</span>(module, sexp_list):
    <span style="color: #f92672; font-weight: bold;">return</span> k_vect(module, sexp_list)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3992405" class="outline-3">
<h3 id="org3992405">(dict)</h3>
<div class="outline-text-3" id="text-org3992405">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_dict</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_dict])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ec9741" class="outline-3">
<h3 id="org3ec9741">(tuple)</h3>
<div class="outline-text-3" id="text-org3ec9741">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'tuple'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_tuple</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_tuple])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect

keyword(<span style="color: #e6db74;">'*'</span>)(k_tuple)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6515107" class="outline-3">
<h3 id="org6515107">(set)</h3>
<div class="outline-text-3" id="text-org6515107">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'set'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_set</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_set])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb92f9" class="outline-3">
<h3 id="orgeb92f9">(primitive)</h3>
<div class="outline-text-3" id="text-orgeb92f9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'primitive'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_primitive</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(sexp_list)
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (primitive) syntax error"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body of (primitive) must be names"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  non string sexp : {}"</span>.<span style="color: #a6e22e;">format</span>(sexp))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body : {}"</span>.<span style="color: #a6e22e;">format</span>(sexp_vect))
            error()
        <span style="color: #f92672; font-weight: bold;">else</span>:
            jo_vect.extend([PRIMITIVE(operator.attrgetter(sexp)(module))])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgef1a66f" class="outline-2">
<h2 id="orgef1a66f">top_level_keyword</h2>
<div class="outline-text-2" id="text-orgef1a66f">
</div><div id="outline-container-org5839830" class="outline-3">
<h3 id="org5839830">(import)</h3>
<div class="outline-text-3" id="text-org5839830">
</div><div id="outline-container-org2b58e30" class="outline-4">
<h4 id="org2b58e30">k_import</h4>
<div class="outline-text-4" id="text-org2b58e30">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"import"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import</span>(module, body):
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(body)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        k_import_as(module, body)
        <span style="color: #f92672; font-weight: bold;">return</span> []

    <span style="color: #f92672; font-weight: bold;">if</span> null_p(body):
        <span style="color: #f92672; font-weight: bold;">return</span> []

    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'.'</span> <span style="color: #f92672; font-weight: bold;">in</span> name:
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (import) syntax error"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  module name can not contain '.'"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  module name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
            p_print(<span style="color: #e6db74;">"  import body : "</span>)
            sexp_list_print(body)
            newline()
            error()

    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        k_import_one(module, name)

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc204695" class="outline-4">
<h4 id="orgc204695">k_import_one</h4>
<div class="outline-text-4" id="text-orgc204695">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import_one</span>(module, name):
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(name)
    jojo_define(module, name, imported_module)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2783a3" class="outline-4">
<h4 id="orgf2783a3">k_import_as</h4>
<div class="outline-text-4" id="text-orgf2783a3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import_as</span>(module, body):
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #a6e22e;">len</span>(name_vect) != 3 <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[0] == <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[1] != <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[2] == <span style="color: #e6db74;">'as'</span>):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (import) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  syntax for (import as) should be :"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  (import &lt;module-name&gt; as &lt;name&gt;)"</span>)
        p_print(<span style="color: #e6db74;">"  import body : "</span>)
        sexp_list_print(body)
        newline()
        error()
    <span style="color: #fd971f;">name</span> = name_vect[0]
    <span style="color: #fd971f;">as_name</span> = name_vect[2]
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(name)
    jojo_define(module, as_name, imported_module)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8139019" class="outline-3">
<h3 id="org8139019">(from)</h3>
<div class="outline-text-3" id="text-org8139019">
</div><div id="outline-container-org6638cd7" class="outline-4">
<h4 id="org6638cd7">k_from</h4>
<div class="outline-text-4" id="text-org6638cd7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"from"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from</span>(module, body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">in</span> vect_body:
        k_from_as(module, body)
        <span style="color: #f92672; font-weight: bold;">return</span> []

    k_from_syntax_check(body)
    <span style="color: #fd971f;">module_name</span> = car(body)
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(cdr(cdr(body)))
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(module_name)
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        jojo_define(module, name, <span style="color: #a6e22e;">getattr</span>(imported_module, name))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org23c033e" class="outline-4">
<h4 id="org23c033e">k_from_syntax_check</h4>
<div class="outline-text-4" id="text-org23c033e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_syntax_check</span>(body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vect_body) &gt; 2:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[1] == <span style="color: #e6db74;">'import'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (from) syntax error"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  syntax for (from import) should be :"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  (from &lt;module-name&gt; import &lt;name&gt; ...)"</span>)
    p_print(<span style="color: #e6db74;">"  import body : "</span>)
    sexp_list_print(body)
    newline()
    error()
</pre>
</div>
</div>
</div>

<div id="outline-container-org109eb89" class="outline-4">
<h4 id="org109eb89">k_from_as</h4>
<div class="outline-text-4" id="text-org109eb89">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_as</span>(module, body):
    k_from_as_syntax_check(body)
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #fd971f;">module_name</span> = vect_body[0]
    <span style="color: #fd971f;">name</span> = vect_body[2]
    <span style="color: #fd971f;">as_name</span> = vect_body[4]
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(module_name)
    jojo_define(module, as_name, <span style="color: #a6e22e;">getattr</span>(imported_module, name))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1307dd" class="outline-4">
<h4 id="orga1307dd">k_from_as_syntax_check</h4>
<div class="outline-text-4" id="text-orga1307dd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_as_syntax_check</span>(body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vect_body) == 5:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[1] == <span style="color: #e6db74;">'import'</span>:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[3] == <span style="color: #e6db74;">'as'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (from) syntax error"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  syntax for (from import as) should be :"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  (from &lt;module-name&gt; import &lt;name&gt; as &lt;name&gt;)"</span>)
    p_print(<span style="color: #e6db74;">"  import body : "</span>)
    sexp_list_print(body)
    newline()
    error()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaf90d9f" class="outline-3">
<h3 id="orgaf90d9f">(+jojo)</h3>
<div class="outline-text-3" id="text-orgaf90d9f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+jojo"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_jojo</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">if</span> list_length(body) == 0:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+jojo) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body of (+jojo) can not be empty"</span>)
        error()

    <span style="color: #fd971f;">jojo_name</span> = car(body)
    jojo_define(module, jojo_name,
                JOJO(sexp_list_emit(module, cdr(body))))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org34c6049" class="outline-3">
<h3 id="org34c6049">(+data)</h3>
<div class="outline-text-3" id="text-org34c6049">
</div><div id="outline-container-orgec4c9ea" class="outline-4">
<h4 id="orgec4c9ea">plus_data</h4>
<div class="outline-text-4" id="text-orgec4c9ea">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+data"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_data</span>(module, body):
    <span style="color: #fd971f;">data_name</span> = car(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> data_name_string_p(data_name):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+data) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data_name must be of form &lt;...&gt;"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  data_name : {}"</span>.<span style="color: #a6e22e;">format</span>(data_name))
        error()

    <span style="color: #fd971f;">field_name_vect</span> = body_to_field_name_vect(cdr(body))
    <span style="color: #fd971f;">data_class</span> = create_data_class(data_name, field_name_vect)
    <span style="color: #fd971f;">data_class.__module__</span> = module
    jojo_define(module, data_name, data_class)
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">generate more bindings</span>
    <span style="color: #fd971f;">constructor_name</span> = data_name[1:-1]
    jojo_define(module, constructor_name, JOJO([data_class, NEW]))
    <span style="color: #fd971f;">predicate_name</span> = <span style="color: #e6db74;">""</span>.join([constructor_name, <span style="color: #e6db74;">"?"</span>])
    jojo_define(module, predicate_name, DATA_PRED(data_class))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c844a7" class="outline-4">
<h4 id="org1c844a7">body_to_field_name_vect</h4>
<div class="outline-text-4" id="text-org1c844a7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">body_to_field_name_vect</span>(body):
    <span style="color: #fd971f;">body_vect</span> = list_to_vect(body)
    <span style="color: #fd971f;">field_name_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> body_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">if</span> message_string_p(sexp):
                <span style="color: #fd971f;">sexp</span> = sexp[1:]
                field_name_vect.append(sexp)
        <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(sexp):
            <span style="color: #f92672; font-weight: bold;">if</span> car(sexp) == <span style="color: #e6db74;">'.'</span>:
                <span style="color: #fd971f;">vect1</span> = body_to_field_name_vect(cdr(sexp))
                field_name_vect.extend(vect1)
    <span style="color: #f92672; font-weight: bold;">return</span> field_name_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8d07fc" class="outline-4">
<h4 id="orgd8d07fc">data_name_string_p</h4>
<div class="outline-text-4" id="text-orgd8d07fc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">data_name_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(string):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3: <span style="color: #FF8888;"># </span><span style="color: #FF8888;">example : '&lt;n&gt;'</span>
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'&lt;'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'&gt;'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'&lt;'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'&gt;'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccc1f52" class="outline-4">
<h4 id="orgccc1f52">create_data_init</h4>
<div class="outline-text-4" id="text-orgccc1f52">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">create_data_init</span>(field_name_vect):
    <span style="color: #e6db74;">'''</span>
<span style="color: #e6db74;">    just like</span>
<span style="color: #e6db74;">    def __init__(self, x1, x2):</span>
<span style="color: #e6db74;">        self.__dict__['field-name-1'] = x1</span>
<span style="color: #e6db74;">        self.__dict__['field-name-2'] = x2</span>
<span style="color: #e6db74;">    '''</span>
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(field_name_vect) == 0:
        <span style="color: #fd971f;">code</span> = <span style="color: #e6db74;">"def init(self):pass"</span>
        <span style="color: #f92672; font-weight: bold;">exec</span>(code, <span style="color: #a6e22e;">globals</span>())
        <span style="color: #f92672; font-weight: bold;">return</span> init
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(field_name_vect)
        <span style="color: #fd971f;">pieces</span> = []
        pieces.append(<span style="color: #e6db74;">"def init(self"</span>)
        <span style="color: #f92672; font-weight: bold;">for</span> field_name, index <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #a6e22e;">zip</span>(field_name_vect, <span style="color: #a6e22e;">range</span>(length)):
            pieces.append(<span style="color: #e6db74;">",{}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #e6db74;">'x'</span>+<span style="color: #a6e22e;">str</span>(index)))
        pieces.append(<span style="color: #e6db74;">"):"</span>)
        <span style="color: #f92672; font-weight: bold;">for</span> field_name, index <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #a6e22e;">zip</span>(field_name_vect, <span style="color: #a6e22e;">range</span>(length)):
            pieces.append(<span style="color: #e6db74;">"self.__dict__['{}']={};"</span>.<span style="color: #a6e22e;">format</span>(field_name,
                                               (<span style="color: #e6db74;">'x'</span>+<span style="color: #a6e22e;">str</span>(index))))
        <span style="color: #fd971f;">code</span> = <span style="color: #e6db74;">''</span>.join(pieces)
        <span style="color: #f92672; font-weight: bold;">exec</span>(code, <span style="color: #a6e22e;">globals</span>())
        <span style="color: #f92672; font-weight: bold;">return</span> init
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d9a975" class="outline-4">
<h4 id="org6d9a975">create_data_class</h4>
<div class="outline-text-4" id="text-org6d9a975">
<ul class="org-ul">
<li><p>a data in jojo is simply a python class</p><p>with the following special fields :</p><p><ul class="org-ul"></p><p><li><p>'field_name_vect'</p></li></p><p><li><p>'reversed_field_name_vect'</p></li></ul></p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">create_data_class</span>(data_name, field_name_vect):
    <span style="color: #fd971f;">rev</span> = vect_copy(field_name_vect)
    rev.reverse()
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">update_ns</span>(ns):
        ns.update({
            <span style="color: #e6db74;">'__init__'</span> : create_data_init(field_name_vect),
            <span style="color: #e6db74;">'field_name_vect'</span>: field_name_vect,
            <span style="color: #e6db74;">'reversed_field_name_vect'</span>: rev,
        })
    <span style="color: #f92672; font-weight: bold;">return</span> types.new_class(
        data_name,
        kwds = <span style="color: #ae81ff;">None</span>,
        exec_body = update_ns)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org67bafa" class="outline-3">
<h3 id="org67bafa">(+union)</h3>
<div class="outline-text-3" id="text-org67bafa">
</div><div id="outline-container-orga12d365" class="outline-4">
<h4 id="orga12d365">plus_union</h4>
<div class="outline-text-4" id="text-orga12d365">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+union"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_union</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, rest)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    jojo_define(module, name, UNION(jojo))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org89525ca" class="outline-4">
<h4 id="org89525ca">UNION</h4>
<div class="outline-text-4" id="text-org89525ca">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">UNION</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.jojo = jojo

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_type_vect</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #fd971f;">vm</span> = VM([], [RP(<span style="color: #f92672; font-weight: bold;">self</span>.jojo)])
        vm.exe()
        <span style="color: #f92672; font-weight: bold;">return</span> vm.ds
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org38975ca" class="outline-3">
<h3 id="org38975ca"><span class="todo _note_">[note]</span> gene and disp</h3>
<div class="outline-text-3" id="text-org38975ca">
<ul class="org-ul">
<li><p>a gene in a module maintains a dict</p><p>form tuple of type to disp</p></li>

<li><p><p></p><p>suppose</p><p></p></p><p></p><p><p></p><p>in module m1 we have (+gene g1 &#x2026;)</p><p></p></p><p></p><p><p></p><p>in module m2 we (import m1) and</p><p>(+disp m1.g1 &#x2026;) for data in m2</p><p></p></p><p></p><p><p></p><p>this means the the global state g1 of module m1</p><p>can be changed by module m2</p><p></p></p></li>

<li><p>in such a hopelessly dynamic language,</p><p>this is the only place we make use of the dynamic type.</p></li></ul>
</div>
</div>

<div id="outline-container-orgb6dde6e" class="outline-3">
<h3 id="orgb6dde6e">(+gene)</h3>
<div class="outline-text-3" id="text-orgb6dde6e">
</div><div id="outline-container-orgaafd7b5" class="outline-4">
<h4 id="orgaafd7b5">plus_gene</h4>
<div class="outline-text-4" id="text-orgaafd7b5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+gene"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_gene</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">arrow</span> = car(rest)
    <span style="color: #fd971f;">arity</span> = arrow_get_arity(arrow)
    <span style="color: #f92672; font-weight: bold;">if</span> arity == 0:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+gene) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  arity of arrow is zero"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  gene dispatches on types of arguments"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  can not define gene over nothing"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        p_print(<span style="color: #e6db74;">"  arrow : "</span>)
        sexp_print(arrow)
        newline()
        error()

    <span style="color: #fd971f;">default_jojo</span> = JOJO(sexp_list_emit(module, rest))
    jojo_define(module, name, GENE(arity, default_jojo))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfed1bed" class="outline-4">
<h4 id="orgfed1bed">arrow_get_arity</h4>
<div class="outline-text-4" id="text-orgfed1bed">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_arity</span>(arrow):
    <span style="color: #fd971f;">arity</span> = 0
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(cdr(arrow))
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> local_string_p(sexp):
            <span style="color: #fd971f;">arity</span> = arity + 1
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">pass</span>

    <span style="color: #f92672; font-weight: bold;">return</span> arity
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org73ddc8d" class="outline-3">
<h3 id="org73ddc8d">(+disp)</h3>
<div class="outline-text-3" id="text-org73ddc8d">
</div><div id="outline-container-org72d1633" class="outline-4">
<h4 id="org72d1633">plus_disp</h4>
<div class="outline-text-4" id="text-org72d1633">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+disp"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_disp</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">arrow</span> = car(rest)
    <span style="color: #fd971f;">type_tuple_vect</span> = arrow_get_type_tuple_vect(module, arrow)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">hasattr</span>(module, name):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+disp) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name is undefined"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        error()

    <span style="color: #fd971f;">gene</span> = <span style="color: #a6e22e;">getattr</span>(module, name)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(gene) != GENE:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+disp) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type of name must be a gene"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type of name : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">type</span>(name)))
        error()

    <span style="color: #fd971f;">jojo</span> = JOJO(sexp_list_emit(module, rest))
    <span style="color: #f92672; font-weight: bold;">for</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> type_tuple_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> gene.disp_dict:
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (+disp) fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type_tuple for gene is already defined"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  type_tuple : {}"</span>.<span style="color: #a6e22e;">format</span>(type_tuple))
            <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  gene name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
            p_print(<span style="color: #e6db74;">"  arrow : "</span>)
            sexp_print(arrow)
            newline()
            error()
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">gene.disp_dict</span>[type_tuple] = jojo

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd58ce9f" class="outline-4">
<h4 id="orgd58ce9f">arrow_get_type_vect</h4>
<div class="outline-text-4" id="text-orgd58ce9f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_type_vect</span>(module, arrow):
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(cdr(arrow))
    <span style="color: #fd971f;">new_sexp_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> local_string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            new_sexp_vect.append(sexp)

    <span style="color: #fd971f;">new_sexp_list</span> = vect_to_list(new_sexp_vect)
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, new_sexp_list)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    <span style="color: #fd971f;">vm</span> = VM([], [RP(jojo)])
    vm.exe()

    <span style="color: #f92672; font-weight: bold;">return</span> vm.ds
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f0c599" class="outline-4">
<h4 id="org8f0c599">type_vect_to_type_vect_vect</h4>
<div class="outline-text-4" id="text-org8f0c599">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">type_vect_to_type_vect_vect</span>(type_vect):
    <span style="color: #fd971f;">type_vect_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> t <span style="color: #f92672; font-weight: bold;">in</span> type_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(t) == UNION:
            type_vect_vect.append(t.get_type_vect())
        <span style="color: #f92672; font-weight: bold;">else</span>:
            type_vect_vect.append([t])

    <span style="color: #f92672; font-weight: bold;">return</span> type_vect_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ec7f04" class="outline-4">
<h4 id="org1ec7f04">arrow_get_type_tuple_vect</h4>
<div class="outline-text-4" id="text-org1ec7f04">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_type_tuple_vect</span>(module, arrow):
    <span style="color: #fd971f;">type_vect</span> = arrow_get_type_vect(module, arrow)
    <span style="color: #fd971f;">type_vect_vect</span> = type_vect_to_type_vect_vect(type_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(itertools.product(*type_vect_vect))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2fbef3" class="outline-2">
<h2 id="orgc2fbef3">key_jo_dict</h2>
<div class="outline-text-2" id="text-orgc2fbef3">
</div><div id="outline-container-org7fcbc04" class="outline-3">
<h3 id="org7fcbc04"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-org7fcbc04">
<ul class="org-ul">
<li><p>keyword : (-&gt; module &#x2013; jo vect)</p></li></ul>
</div>
</div>

<div id="outline-container-orgfa14b9d" class="outline-3">
<h3 id="orgfa14b9d">key_jo_dict</h3>
<div class="outline-text-3" id="text-orgfa14b9d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">key_jo_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org377c6e1" class="outline-3">
<h3 id="org377c6e1">key_jo</h3>
<div class="outline-text-3" id="text-org377c6e1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">key_jo</span>(name, jo_vect):
    <span style="color: #fd971f;">key_jo_dict</span>[name] = jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org497ee7f" class="outline-3">
<h3 id="org497ee7f">key_jo s</h3>
<div class="outline-text-3" id="text-org497ee7f">
<div class="org-src-container">

<pre class="src src-python">key_jo(<span style="color: #e6db74;">'apply'</span>, [APPLY])
key_jo(<span style="color: #e6db74;">'ifte'</span>, [IFTE])
key_jo(<span style="color: #e6db74;">'new'</span>, [NEW])
key_jo(<span style="color: #e6db74;">','</span>, [])

key_jo(<span style="color: #e6db74;">'mark'</span>, [MARK])
key_jo(<span style="color: #e6db74;">'collect-vect'</span>, [COLLECT_VECT])
key_jo(<span style="color: #e6db74;">'vect-spread'</span>, [VECT_SPREAD])
key_jo(<span style="color: #e6db74;">'collect-list'</span>, [COLLECT_LIST])
key_jo(<span style="color: #e6db74;">'list-spread'</span>, [LIST_SPREAD])

key_jo(<span style="color: #e6db74;">'clear'</span>, [CLEAR])
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1baff66" class="outline-2">
<h2 id="org1baff66">macro_dict</h2>
<div class="outline-text-2" id="text-org1baff66">
</div><div id="outline-container-org477e2fd" class="outline-3">
<h3 id="org477e2fd"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-org477e2fd">
<ul class="org-ul">
<li><p>macro : (-&gt; body &#x2013; sexp)</p><p>where body is sexp_list</p></li></ul>
</div>
</div>

<div id="outline-container-orga3b081b" class="outline-3">
<h3 id="orga3b081b">macro_dict</h3>
<div class="outline-text-3" id="text-orga3b081b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">macro_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org95b564d" class="outline-3">
<h3 id="org95b564d">@macro</h3>
<div class="outline-text-3" id="text-org95b564d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">macro</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">macro_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d291c" class="outline-3">
<h3 id="org9d291c">(cond)</h3>
<div class="outline-text-3" id="text-org9d291c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'cond'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_cond</span>(body):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(rest):
        <span style="color: #f92672; font-weight: bold;">if</span> list_length(rest) == 2:
            <span style="color: #fd971f;">q</span> = list_ref(rest, 0)
            <span style="color: #fd971f;">a</span> = list_ref(rest, 1)
            <span style="color: #f92672; font-weight: bold;">if</span> q == <span style="color: #e6db74;">'else'</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> a
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
                    [<span style="color: #e6db74;">'begin'</span>,
                     q, [<span style="color: #e6db74;">'clo'</span>, a],
                     [<span style="color: #e6db74;">'clo'</span>,
                      [<span style="color: #e6db74;">'quote'</span>, body],
                      <span style="color: #e6db74;">'report-cond-mismatch'</span>],
                     <span style="color: #e6db74;">'ifte'</span>])
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">q</span> = list_ref(rest, 0)
            <span style="color: #fd971f;">a</span> = list_ref(rest, 1)
            <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
                [<span style="color: #e6db74;">'begin'</span>,
                 q, [<span style="color: #e6db74;">'clo'</span>, a],
                 [<span style="color: #e6db74;">'clo'</span>, recur(cdr(cdr(rest)))],
                 <span style="color: #e6db74;">'ifte'</span>])
    <span style="color: #f92672; font-weight: bold;">return</span> recur(body)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'report-cond-mismatch'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">report_cond_mismatch</span>(body):
    <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- cond mismatch"</span>)
    p_print(<span style="color: #e6db74;">"  body : "</span>)
    sexp_print(body)
    newline()
    error()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa42d61" class="outline-3">
<h3 id="orgaa42d61">(if)</h3>
<div class="outline-text-3" id="text-orgaa42d61">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'if'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_if</span>(body):
    <span style="color: #fd971f;">length</span> = list_length(body)
    <span style="color: #f92672; font-weight: bold;">if</span> length != 3:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (if) syntax fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body of (if) must has 3 sexps"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        p_print(<span style="color: #e6db74;">"  body : "</span>)
        sexp_list_print(body)
        newline()
        error()

    <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
        [<span style="color: #e6db74;">'begin'</span>,
         car(body),
         [<span style="color: #e6db74;">'clo'</span>, car(cdr(body))],
         [<span style="color: #e6db74;">'clo'</span>, car(cdr(cdr(body)))],
         <span style="color: #e6db74;">'ifte'</span>])
</pre>
</div>
</div>
</div>

<div id="outline-container-org1936528" class="outline-3">
<h3 id="org1936528">(when)</h3>
<div class="outline-text-3" id="text-org1936528">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'when'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_when</span>(body):
    <span style="color: #fd971f;">length</span> = list_length(body)
    <span style="color: #f92672; font-weight: bold;">if</span> length &lt;= 1:
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- (when) syntax fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  length of body of (when) must be greater then 1"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  body length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        p_print(<span style="color: #e6db74;">"  body : "</span>)
        sexp_list_print(body)
        newline()
        error()

    <span style="color: #fd971f;">rest_list</span> = cdr(body)
    <span style="color: #fd971f;">rest_vect</span> = [<span style="color: #e6db74;">'begin'</span>]
    rest_vect.extend(list_to_vect(rest_list))

    <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
        [<span style="color: #e6db74;">'begin'</span>,
         car(body),
         [<span style="color: #e6db74;">'clo'</span>, rest_vect],
         [<span style="color: #e6db74;">'clo'</span>],
         <span style="color: #e6db74;">'ifte'</span>])
</pre>
</div>
</div>
</div>

<div id="outline-container-org33c63e5" class="outline-3">
<h3 id="org33c63e5">(call)</h3>
<div class="outline-text-3" id="text-org33c63e5">
<ul class="org-ul">
<li><p>use 'prepare-default-arguments'</p><p>to push default arguments to stack</p><p>and call the function</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'call'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_call</span>(body):
    <span style="color: #fd971f;">rest_vect</span> = list_to_vect(cdr(body))
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">fields</span> = []
    <span style="color: #fd971f;">new_body</span> = [<span style="color: #e6db74;">'begin'</span>]
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> rest_vect:
       <span style="color: #f92672; font-weight: bold;">if</span> message_string_p(sexp):
           fields.append(sexp[1:])
       <span style="color: #f92672; font-weight: bold;">else</span>:
           new_body.append(sexp)
    <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
        [<span style="color: #e6db74;">'begin'</span>,
         [<span style="color: #e6db74;">'quote'</span>, fields], <span style="color: #e6db74;">'list-&gt;vect'</span>,
         <span style="color: #e6db74;">'mark'</span>, new_body, <span style="color: #e6db74;">'collect-vect'</span>,
         [<span style="color: #e6db74;">'primitive'</span>, name],
         <span style="color: #e6db74;">'keyword-apply'</span>])
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec8f860" class="outline-3">
<h3 id="orgec8f860">(create)</h3>
<div class="outline-text-3" id="text-orgec8f860">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'create'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_create</span>(body):
    <span style="color: #fd971f;">rest_vect</span> = list_to_vect(cdr(body))
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">fields</span> = []
    <span style="color: #fd971f;">new_body</span> = [<span style="color: #e6db74;">'begin'</span>]
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> rest_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> message_string_p(sexp):
            fields.append(sexp[1:])
        <span style="color: #f92672; font-weight: bold;">else</span>:
            new_body.append(sexp)
    <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
        [<span style="color: #e6db74;">'begin'</span>,
         [<span style="color: #e6db74;">'quote'</span>, fields], <span style="color: #e6db74;">'list-&gt;vect'</span>,
         <span style="color: #e6db74;">'mark'</span>, new_body, <span style="color: #e6db74;">'collect-vect'</span>,
         name,
         <span style="color: #e6db74;">'prepare-data-arguments'</span>,
         name,
         <span style="color: #e6db74;">'new'</span>])
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org891b9c2" class="outline-2">
<h2 id="org891b9c2">epilog &#x2013; interface</h2>
<div class="outline-text-2" id="text-org891b9c2">
</div><div id="outline-container-orged1b1da" class="outline-3">
<h3 id="orged1b1da">maybe_drop_shebang</h3>
<div class="outline-text-3" id="text-orged1b1da">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">maybe_drop_shebang</span>(code):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(code)
    <span style="color: #f92672; font-weight: bold;">if</span> length &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> code
    <span style="color: #f92672; font-weight: bold;">elif</span> code[0:2] != <span style="color: #e6db74;">'#!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> code
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">end_of_first_line</span> = code.find(<span style="color: #e6db74;">'\n'</span>)
        <span style="color: #f92672; font-weight: bold;">if</span> end_of_first_line == -1:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> code[end_of_first_line:]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5a18bd" class="outline-3">
<h3 id="orgc5a18bd">load</h3>
<div class="outline-text-3" id="text-orgc5a18bd">
<ul class="org-ul">
<li><p>path is used as module name</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">load</span>(name, path):
    <span style="color: #fd971f;">current_module</span> = sys.modules[inspect.stack()[1].frame.f_globals[<span style="color: #e6db74;">'__name__'</span>]]
    <span style="color: #f92672; font-weight: bold;">if</span> ((current_module.<span style="color: #a6e22e;">__name__</span> == <span style="color: #e6db74;">'__main__'</span>) <span style="color: #f92672; font-weight: bold;">or</span>
        (<span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">hasattr</span>(current_module, <span style="color: #e6db74;">'__file__'</span>))):
        <span style="color: #fd971f;">path</span> = os.path.abspath(path)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">current_module_dir</span> = os.path.dirname(current_module.__file__)
        <span style="color: #fd971f;">path</span> = <span style="color: #e6db74;">"/"</span>.join([current_module_dir, path])

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.exists(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path does not exist"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.isfile(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path is not file"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">with</span> <span style="color: #a6e22e;">open</span>(path, <span style="color: #e6db74;">"r"</span>) <span style="color: #f92672; font-weight: bold;">as</span> f:
        <span style="color: #fd971f;">code</span> = f.read()
        <span style="color: #fd971f;">code</span> = maybe_drop_shebang(code)
        <span style="color: #fd971f;">sexp_vect</span> = parse_sexp_vect(code_scan(code))
        <span style="color: #fd971f;">module</span> = compile_module(name, sexp_vect)

    <span style="color: #fd971f;">module.__file__</span> = path

    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orga754c0" class="outline-3">
<h3 id="orga754c0">run</h3>
<div class="outline-text-3" id="text-orga754c0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">run</span>(data_stack, jojo_vect):
    <span style="color: #fd971f;">data_stack</span> = vect_copy(data_stack)
    <span style="color: #f92672; font-weight: bold;">for</span> jojo <span style="color: #f92672; font-weight: bold;">in</span> jojo_vect:
        run_one(data_stack, jojo)
    <span style="color: #f92672; font-weight: bold;">return</span> data_stack

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">run_one</span>(data_stack, jojo):
    <span style="color: #fd971f;">vm</span> = VM(data_stack,
            [RP(jojo)])
    vm.exe()
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2daccd" class="outline-3">
<h3 id="orge2daccd">core_module</h3>
<div class="outline-text-3" id="text-orge2daccd">
</div><div id="outline-container-org35d9f9a" class="outline-4">
<h4 id="org35d9f9a">load_core</h4>
<div class="outline-text-4" id="text-org35d9f9a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">load_core</span>(path):
    <span style="color: #fd971f;">path</span> = os.path.abspath(path)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.exists(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load_core fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path does not exist"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.isfile(path):
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"- load_core fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path is not file"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span>(<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        error()

    <span style="color: #f92672; font-weight: bold;">with</span> <span style="color: #a6e22e;">open</span>(path, <span style="color: #e6db74;">"r"</span>) <span style="color: #f92672; font-weight: bold;">as</span> f:
        <span style="color: #fd971f;">code</span> = f.read()
        <span style="color: #fd971f;">sexp_vect</span> = parse_sexp_vect(code_scan(code))
        <span style="color: #fd971f;">module</span> = compile_core_module(path, sexp_vect)

    <span style="color: #fd971f;">module.__file__</span> = path

    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org13ede74" class="outline-4">
<h4 id="org13ede74">core_module</h4>
<div class="outline-text-4" id="text-org13ede74">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">current_module</span> = sys.modules[<span style="color: #a6e22e;">__name__</span>]
<span style="color: #fd971f;">current_module_dir</span> = os.path.dirname(current_module.__file__)
<span style="color: #fd971f;">core_path</span> = <span style="color: #e6db74;">"/"</span>.join([current_module_dir, <span style="color: #e6db74;">"core.jo"</span>])
<span style="color: #fd971f;">core_module</span> = load_core(core_path)
</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: xieyuheng</p>
<p class="date">Created: 2017-11-28 Tue 00:37</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
