<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-10-14 Sat 01:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>jojo's programming adventure in python</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="xieyuheng" />
<link rel="stylesheet" href="css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">jojo's programming adventure in python</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc4c35a5">------</a></li>
<li><a href="#org188017f">prolog</a>
<ul>
<li><a href="#org4daa2ce">import</a></li>
<li><a href="#org5c9c0f">utility</a>
<ul>
<li><a href="#orgeb6e38b">get_signature</a></li>
<li><a href="#org814da4f">fun_p</a></li>
<li><a href="#orgc4d607c">method_p</a></li>
<li><a href="#org529c2fb">class_p</a></li>
<li><a href="#orgf1d636">Vect</a></li>
<li><a href="#org50e828f">vect_p</a></li>
<li><a href="#org80a2c5b">string_p</a></li>
<li><a href="#orgc0835bf">fill_vect</a></li>
<li><a href="#orgf70aaed">fill_tuple</a></li>
</ul>
</li>
<li><a href="#org3bfc165">error handling</a>
<ul>
<li><a href="#org86a0d87">JOJO_ERROR</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga0828e9">------</a></li>
<li><a href="#orgac1a246">vm</a>
<ul>
<li><a href="#org15dd9c2">RP</a></li>
<li><a href="#org2914e48">VM</a></li>
<li><a href="#org7e35779">VALUES</a></li>
<li><a href="#org3268684">push_result_to_vm</a></li>
<li><a href="#org2364b9d">exe_one_step</a></li>
<li><a href="#org2d54e13">exe_jo</a></li>
<li><a href="#org6870967">exe_fun</a>
<ul>
<li><a href="#org502c88b"><span class="todo _note_">[note]</span> python funtion arguments</a></li>
<li><a href="#org93b3a8e">exe_fun</a></li>
<li><a href="#org28cbbdd">get_positional_para_length</a></li>
<li><a href="#org67db5b0">has_para_vect</a></li>
<li><a href="#orgf21ebc7">has_para_dict</a></li>
<li><a href="#org2bfe0a7">get_default_arg_dict</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge7484b7">jo</a>
<ul>
<li><a href="#org7d92d3b">top level</a>
<ul>
<li><a href="#orga76d0b6">JOJO</a></li>
</ul>
</li>
<li><a href="#orgfb43f1">closure</a>
<ul>
<li><a href="#orgffdf0b1">CLO</a></li>
<li><a href="#org6f107f5">APPLY</a></li>
</ul>
</li>
<li><a href="#org5acc8a7">branching</a>
<ul>
<li><a href="#orgd95d359">IFTE</a></li>
</ul>
</li>
<li><a href="#orgf89824b">CALL &#x2013; call a name from a module</a></li>
<li><a href="#org6fa42ec">local variable</a>
<ul>
<li><a href="#orgd1a58f1">GET</a></li>
<li><a href="#orgffd548">SET</a></li>
</ul>
</li>
<li><a href="#orgdb9dec0">mark and collect</a>
<ul>
<li><a href="#org712701c">MARK &#x2013; for collectors</a></li>
<li><a href="#orgd177223">COLLECT_VECT &#x2013; collect values before mark to vect</a></li>
<li><a href="#orgc07a6a4">VECT_SPREAD &#x2013; spread values to data stack</a></li>
<li><a href="#orgd2b9295">COLLECT_LIST &#x2013; collect values before mark to list</a></li>
<li><a href="#org29b0f11">LIST_SPREAD &#x2013; spread values to data stack</a></li>
</ul>
</li>
<li><a href="#orgc88337f">data</a>
<ul>
<li><a href="#org58399dd">DATA_PRED &#x2013; for data predicate</a></li>
</ul>
</li>
<li><a href="#orga2e7ced">NEW &#x2013; create object from data and class</a></li>
<li><a href="#org6853a07">MSG &#x2013; message to object</a></li>
<li><a href="#org21c5eea">GENE</a></li>
</ul>
</li>
<li><a href="#orgec332d5">------</a></li>
<li><a href="#org66d677f">scan &#x2013; lexer for sexp</a>
<ul>
<li><a href="#orgc20742b">scan_string_vect</a></li>
<li><a href="#org6ede4d6">find_end</a></li>
<li><a href="#org644063e">space_p</a></li>
<li><a href="#orga33c234">delimiter_p</a></li>
<li><a href="#org366e45f">doublequote_p</a></li>
</ul>
</li>
<li><a href="#org69c11e1">null &amp; cons</a>
<ul>
<li><a href="#orgb9cb7ae">Null</a></li>
<li><a href="#org1a6afcd">null</a></li>
<li><a href="#org376399d">null_p</a></li>
<li><a href="#orge2a7055">Cons</a></li>
<li><a href="#orga3f9b8b">cons</a></li>
<li><a href="#orge152a98">cons_p</a></li>
<li><a href="#org12ea7d1">cdr</a></li>
<li><a href="#org29c7578">car</a></li>
</ul>
</li>
<li><a href="#org6561f3f">sexp &#x2013; string expression</a>
<ul>
<li><a href="#orga71eb34"><span class="todo _note_">[note]</span> syntax sugar</a></li>
<li><a href="#org891c54a">parse_sexp_vect &#x2013; string vect to sexp vect</a></li>
<li><a href="#org5be8b52">parse_sexp</a></li>
<li><a href="#orgfbd5285">parse_sexp_cons_until_ket</a></li>
<li><a href="#org9055ecf">p_print</a></li>
<li><a href="#org67db0df">sexp_print</a></li>
<li><a href="#orgaf83ba5">sexp_list_print</a></li>
</ul>
</li>
<li><a href="#org178e026"><span class="todo _note_">[note]</span> syntax</a>
<ul>
<li><a href="#orgb7a82ce">top level</a></li>
<li><a href="#orgdd6719f">control</a></li>
<li><a href="#orgf2a57fa">sexp quote</a></li>
<li><a href="#orgfa8b6ea">data</a></li>
<li><a href="#orgb2c799f">key jo</a></li>
<li><a href="#orgb1c59bc">jo pattern</a></li>
</ul>
</li>
<li><a href="#orgb3f9f7a">compiler</a>
<ul>
<li><a href="#org1a041d0">new_module</a></li>
<li><a href="#orge35f424">filter_name_vect</a></li>
<li><a href="#org85f4b7b">jojo_define</a></li>
<li><a href="#orgc1c4a51">merge_prim_dict</a></li>
<li><a href="#org5112cb7">merge_module</a></li>
<li><a href="#orgc6bc011">merge_sexp_vect</a></li>
<li><a href="#org4608270">compile_module</a></li>
<li><a href="#orga7cf0aa">compile_core_module</a></li>
<li><a href="#orgabcf794">sexp_list_emit</a></li>
<li><a href="#org589b25c">sexp_emit</a></li>
<li><a href="#orge37cea0">null_emit</a></li>
<li><a href="#orgea1df38">cons_emit</a></li>
<li><a href="#org5e00e50">string_emit</a></li>
<li><a href="#orga254ae6">sexp_value</a></li>
</ul>
</li>
<li><a href="#org5f8318">------</a></li>
<li><a href="#org2babdb3">string_emitter_vect</a>
<ul>
<li><a href="#org7c45d9f">string_emitter_vect</a></li>
<li><a href="#org245e950">string_emitter</a></li>
<li><a href="#orgb6f05b9">int_string</a>
<ul>
<li><a href="#org660f420">int_string_p</a></li>
<li><a href="#orgb3a985b">nat_string_p</a></li>
<li><a href="#org2c872df">int_string_emitter</a></li>
<li><a href="#org3d5acc4">record</a></li>
</ul>
</li>
<li><a href="#org7cfb2a4">doublequoted_string</a>
<ul>
<li><a href="#orgc450e16">doublequoted_string_p</a></li>
<li><a href="#org59e5c5e">doublequoted_string_emitter</a></li>
<li><a href="#org7cf9b76">record</a></li>
</ul>
</li>
<li><a href="#orgf627ade">local_string</a>
<ul>
<li><a href="#org671cf34">local_string_p</a></li>
<li><a href="#org68e2648">local_string_emitter</a></li>
<li><a href="#org7be77b9">record</a></li>
</ul>
</li>
<li><a href="#org680193d">set_local_string</a>
<ul>
<li><a href="#orgf0507ad">set_local_string_p</a></li>
<li><a href="#org13560c3">set_local_string_emitter</a></li>
<li><a href="#org89fec5c">record</a></li>
</ul>
</li>
<li><a href="#orgb5ddec2">message_string</a>
<ul>
<li><a href="#org8222ddd">message_string_p</a></li>
<li><a href="#orga3c6c3a">message_string_emitter</a></li>
<li><a href="#org490ae02">record</a></li>
</ul>
</li>
<li><a href="#orgcb7d202">name_message_string</a>
<ul>
<li><a href="#orgee1d554">name_message_string_p</a></li>
<li><a href="#org1e53dc6">name_message_string_emitter</a></li>
<li><a href="#org19ce692">record</a></li>
</ul>
</li>
<li><a href="#orge26dfdb">local_message_string</a>
<ul>
<li><a href="#org39a6ab1">local_message_string_p</a></li>
<li><a href="#org70bdce4">local_message_string_emitter</a></li>
<li><a href="#org654769e">record</a></li>
</ul>
</li>
<li><a href="#org9bb8445">message_message_string</a>
<ul>
<li><a href="#orgd08749a">message_message_string_p</a></li>
<li><a href="#orge1791e0">message_message_string_emitter</a></li>
<li><a href="#org22cf20f">record</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org795d3aa">prim_dict</a>
<ul>
<li><a href="#org166530f">prim_dict</a></li>
<li><a href="#orgcd44f0f">@prim</a></li>
</ul>
</li>
<li><a href="#orgc4cf9c7">------</a></li>
<li><a href="#org739eaa4"><b>stack operation</b></a></li>
<li><a href="#orgb8e1542"><b>error</b></a></li>
<li><a href="#org43b707"><b>int</b></a>
<ul>
<li><a href="#orgbb3bda">Int</a></li>
<li><a href="#orge18a4e9">int_p</a></li>
<li><a href="#orga4792d9">primary school</a></li>
<li><a href="#org840ac6e">compare</a>
<ul>
<li><a href="#orgda204b8">lt_p &#x2013; less then</a></li>
<li><a href="#org2ec8f0b">gt_p &#x2013; greater then</a></li>
<li><a href="#org90e0e46">lteq_p &#x2013; less then or equal to</a></li>
<li><a href="#org91c8181">gteq_p &#x2013; greater then or equal to</a></li>
</ul>
</li>
<li><a href="#org37c8366">int_print</a></li>
</ul>
</li>
<li><a href="#orge8930dd"><b>bool</b></a>
<ul>
<li><a href="#org9a577c0">Bool</a></li>
<li><a href="#orgbb4aeed">basic</a></li>
</ul>
</li>
<li><a href="#orgeb4d49"><b>equivalence</b></a></li>
<li><a href="#org4afbb5f"><b>sexp</b></a></li>
<li><a href="#org4bd2afc"><b>string</b></a>
<ul>
<li><a href="#orgc828d00">String</a></li>
<li><a href="#orgac3f81d">string_p</a></li>
<li><a href="#org2bd17c7">string_print</a></li>
<li><a href="#org6e26a5b">string_length</a></li>
<li><a href="#org9b45129">string_ref</a></li>
<li><a href="#org669b17c">string_append</a></li>
<li><a href="#orgcd4251b">string_slice</a></li>
<li><a href="#org9bde2f2">string_empty_p</a></li>
<li><a href="#orge8bf46f">string_eq_p</a></li>
</ul>
</li>
<li><a href="#orgc4678ab"><b>vect</b></a>
<ul>
<li><a href="#orged56ad0"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org2de15d0">vect_p</a></li>
<li><a href="#org7c9ef7e">vect_copy</a></li>
<li><a href="#org9d8f2e5">vect_member_p</a></li>
<li><a href="#orgb2f8aa9">vect_to_sexp</a></li>
<li><a href="#org684c92a">vect_length</a></li>
<li><a href="#org3b1c78c">vect_ref</a></li>
<li><a href="#org8371cc2">vect_append &#x2013; no-side-effect</a></li>
</ul>
</li>
<li><a href="#org6f84aa3"><b>list</b></a>
<ul>
<li><a href="#orgcd86f79">Null &amp; Cons</a></li>
<li><a href="#org1d15958">list_p</a></li>
<li><a href="#org5f0786f">vect_to_list</a></li>
<li><a href="#org81efbb4">list_to_vect</a></li>
<li><a href="#org309492f">list_length</a></li>
<li><a href="#orgcb85ec">list_ref</a></li>
<li><a href="#orgf48252b">list_append</a></li>
<li><a href="#org5aeaa42">tail_cons</a></li>
</ul>
</li>
<li><a href="#org7870683"><b>dict</b></a>
<ul>
<li><a href="#org82b158c">Dict</a></li>
<li><a href="#org88711cb">dict_p</a></li>
<li><a href="#orgff272ac">dict_copy</a></li>
<li><a href="#org1af914d">vect_to_dict</a></li>
<li><a href="#org94afea9">dict_length</a></li>
<li><a href="#org53e660d">dict_find</a></li>
<li><a href="#org9a0a507">dict_update &#x2013; no-side-effect</a></li>
<li><a href="#orge59a89c">dict_delete &#x2013; no-side-effect</a></li>
</ul>
</li>
<li><a href="#orgd8debd2"><b>tuple</b></a>
<ul>
<li><a href="#org63232b8">Tuple</a></li>
<li><a href="#orgcc2baca">tuple_p</a></li>
<li><a href="#orga01aa74">vect_to_tuple</a></li>
<li><a href="#orgb9d89d9">tuple_to_vect</a></li>
<li><a href="#org90f8373">tuple_length</a></li>
<li><a href="#org12eb5f0">tuple_ref</a></li>
<li><a href="#org879d6">tuple_append</a></li>
</ul>
</li>
<li><a href="#orgea24f96"><b>set</b></a>
<ul>
<li><a href="#org65b1180">Set</a></li>
<li><a href="#org48a0766">set_p</a></li>
<li><a href="#orgd5a9112">vect_to_set</a></li>
<li><a href="#org734c14d">set_to_vect</a></li>
<li><a href="#org3c6d6ce">set_length</a></li>
<li><a href="#orga35f272">set_member_p</a></li>
<li><a href="#org58d3230">high school</a></li>
</ul>
</li>
<li><a href="#org2dd83bb"><b>io</b></a>
<ul>
<li><a href="#orgb17b428">print</a></li>
<li><a href="#org6ba287b">nl &#x2013; newline</a></li>
<li><a href="#orgf201e52">space</a></li>
</ul>
</li>
<li><a href="#org3975930"><b>sys</b></a>
<ul>
<li><a href="#org79890e4">bye</a></li>
</ul>
</li>
<li><a href="#org7adf661">------</a></li>
<li><a href="#org5743861">keyword_dict</a>
<ul>
<li><a href="#orgc0af0d9"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#orgc36a908">keyword_dict</a></li>
<li><a href="#org6b57aec">@keyword</a></li>
<li><a href="#orge4153a5">(note)</a></li>
<li><a href="#orgbd2a520">(begin)</a></li>
<li><a href="#orgb2a3b58">(clo)</a></li>
<li><a href="#org46e019e">(if)</a></li>
<li><a href="#org1de4500">(quote)</a></li>
<li><a href="#org52c8f1">(partquote)</a></li>
<li><a href="#org45818a0">(-&gt;)</a></li>
<li><a href="#orgb757e4">(list)</a></li>
<li><a href="#orgc7e23f2">(vect)</a></li>
<li><a href="#org9ac61d5">(dict)</a></li>
<li><a href="#org418e963">(tuple)</a></li>
<li><a href="#orgd3fb7b9">(set)</a></li>
</ul>
</li>
<li><a href="#org1cbca41">top_level_keywordm</a>
<ul>
<li><a href="#orgf7c08b3">(import)</a>
<ul>
<li><a href="#org19d8ea6">k_import</a></li>
<li><a href="#orgff515c5">k_import_one</a></li>
<li><a href="#org10cbce">k_import_as</a></li>
</ul>
</li>
<li><a href="#orgf4899fb">(from)</a>
<ul>
<li><a href="#org8ea3a54">k_from</a></li>
<li><a href="#org99dbcd5">k_from_syntax_check</a></li>
<li><a href="#orgef57d30">k_from_as</a></li>
<li><a href="#org600f12e">k_from_as_syntax_check</a></li>
</ul>
</li>
<li><a href="#org78637af">(+jojo)</a></li>
<li><a href="#orgf3ecddc">(+data)</a>
<ul>
<li><a href="#org490a794">plus_data</a></li>
<li><a href="#orgcbc8515">data_name_string_p</a></li>
<li><a href="#org32f0e2d">JOJO_DATA</a></li>
<li><a href="#org5eff2b6">create_data_class</a></li>
</ul>
</li>
<li><a href="#org5aeab3c">(+union)</a>
<ul>
<li><a href="#org91b9311">plus_union</a></li>
<li><a href="#orgd312a3d">UNION</a></li>
</ul>
</li>
<li><a href="#org8138b08"><span class="todo _note_">[note]</span> gene and disp</a></li>
<li><a href="#orgf46fe02">(+gene)</a>
<ul>
<li><a href="#org26718f8">plus_gene</a></li>
<li><a href="#org7c7f6d">arrow_get_arity</a></li>
</ul>
</li>
<li><a href="#orge0e158c">(+disp)</a>
<ul>
<li><a href="#org5c20d06">plus_disp</a></li>
<li><a href="#orgb1382fc">arrow_get_type_vect</a></li>
<li><a href="#org536e4ea">type_vect_to_type_vect_vect</a></li>
<li><a href="#org82e69b7">arrow_get_type_tuple_vect</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb870cbf">key_jo_dict</a>
<ul>
<li><a href="#org51c1cd8"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#org123ff08">key_jo_dict</a></li>
<li><a href="#orge1d5d79">key_jo</a></li>
<li><a href="#org2c50a61">key_jo s</a></li>
</ul>
</li>
<li><a href="#org172c00">macro_dict</a>
<ul>
<li><a href="#orgc5cc2e7"><span class="todo _note_">[note]</span> type</a></li>
<li><a href="#org5dc5529">macro_dict</a></li>
<li><a href="#org1c27c19">@macro</a></li>
<li><a href="#orgb945bc4">(cond)</a></li>
</ul>
</li>
<li><a href="#org97963f2">------</a></li>
<li><a href="#orgf394ad6">epilog &#x2013; interface</a>
<ul>
<li><a href="#org138d81a">maybe_drop_shebang</a></li>
<li><a href="#org1d64cfa">load</a></li>
<li><a href="#orgf70dbe">run</a></li>
<li><a href="#orgee00fca">core_module</a>
<ul>
<li><a href="#org4c11a3f">load_core</a></li>
<li><a href="#org463234c">core_module</a></li>
</ul>
</li>
<li><a href="#org2e9c0e3">repl</a>
<ul>
<li><a href="#org1c55310">read_char</a></li>
<li><a href="#orgc9f144c">read_string</a></li>
<li><a href="#org12bff7d">read_doublequoted_string</a></li>
<li><a href="#org1ec6349">read_sexp</a></li>
<li><a href="#orgdaa8260">read_sexp_list_until_ket</a></li>
<li><a href="#orgde1488c">print_data_stack</a></li>
<li><a href="#orgf88bab6">print_return_stack</a></li>
<li><a href="#org9e87414">repl</a></li>
<li><a href="#org2caa409">debug_repl</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org87da58b">------</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgc4c35a5" class="outline-2">
<h2 id="orgc4c35a5">------</h2>
</div>
<div id="outline-container-org188017f" class="outline-2">
<h2 id="org188017f">prolog</h2>
<div class="outline-text-2" id="text-org188017f">
</div><div id="outline-container-org4daa2ce" class="outline-3">
<h3 id="org4daa2ce">import</h3>
<div class="outline-text-3" id="text-org4daa2ce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">import</span> inspect
<span style="color: #f92672; font-weight: bold;">import</span> types
<span style="color: #f92672; font-weight: bold;">import</span> importlib
<span style="color: #f92672; font-weight: bold;">import</span> sys
<span style="color: #f92672; font-weight: bold;">import</span> os
<span style="color: #f92672; font-weight: bold;">import</span> itertools
<span style="color: #f92672; font-weight: bold;">import</span> collections
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c9c0f" class="outline-3">
<h3 id="org5c9c0f">utility</h3>
<div class="outline-text-3" id="text-org5c9c0f">
</div><div id="outline-container-orgeb6e38b" class="outline-4">
<h4 id="orgeb6e38b">get_signature</h4>
<div class="outline-text-4" id="text-orgeb6e38b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_signature</span>(fun):
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> inspect.signature(fun)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">ValueError</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org814da4f" class="outline-4">
<h4 id="org814da4f">fun_p</h4>
<div class="outline-text-4" id="text-org814da4f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fun_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #a6e22e;">isinstance</span>(x, types.LambdaType) <span style="color: #f92672; font-weight: bold;">or</span>
        <span style="color: #a6e22e;">isinstance</span>(x, types.MethodType)):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> (<span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinFunctionType) <span style="color: #f92672; font-weight: bold;">or</span>
          <span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinMethodType)):
        <span style="color: #f92672; font-weight: bold;">return</span> get_signature(x)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4d607c" class="outline-4">
<h4 id="orgc4d607c">method_p</h4>
<div class="outline-text-4" id="text-orgc4d607c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">method_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">isinstance</span>(x, types.MethodType):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">isinstance</span>(x, types.BuiltinMethodType):
        <span style="color: #f92672; font-weight: bold;">return</span> get_signature(x)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org529c2fb" class="outline-4">
<h4 id="org529c2fb">class_p</h4>
<div class="outline-text-4" id="text-org529c2fb">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">class_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> inspect.isclass(x):
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> x == <span style="color: #a6e22e;">type</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1d636" class="outline-4">
<h4 id="orgf1d636">Vect</h4>
<div class="outline-text-4" id="text-orgf1d636">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">Vect</span> = <span style="color: #a6e22e;">list</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org50e828f" class="outline-4">
<h4 id="org50e828f">vect_p</h4>
<div class="outline-text-4" id="text-org50e828f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == Vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org80a2c5b" class="outline-4">
<h4 id="org80a2c5b">string_p</h4>
<div class="outline-text-4" id="text-org80a2c5b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">str</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc0835bf" class="outline-4">
<h4 id="orgc0835bf">fill_vect</h4>
<div class="outline-text-4" id="text-orgc0835bf">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fill_vect</span>(value, length):
    <span style="color: #fd971f;">vect</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        vect.append(value)
        <span style="color: #fd971f;">i</span> = i + 1
    <span style="color: #f92672; font-weight: bold;">return</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf70aaed" class="outline-4">
<h4 id="orgf70aaed">fill_tuple</h4>
<div class="outline-text-4" id="text-orgf70aaed">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">fill_tuple</span>(value, length):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(fill_vect(value, length))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3bfc165" class="outline-3">
<h3 id="org3bfc165">error handling</h3>
<div class="outline-text-3" id="text-org3bfc165">
</div><div id="outline-container-org86a0d87" class="outline-4">
<h4 id="org86a0d87">JOJO_ERROR</h4>
<div class="outline-text-4" id="text-org86a0d87">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO_ERROR</span>(<span style="color: #66d9ef; font-weight: bold;">Exception</span>):
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orga0828e9" class="outline-2">
<h2 id="orga0828e9">------</h2>
</div>
<div id="outline-container-orgac1a246" class="outline-2">
<h2 id="orgac1a246">vm</h2>
<div class="outline-text-2" id="text-orgac1a246">
</div><div id="outline-container-org15dd9c2" class="outline-3">
<h3 id="org15dd9c2">RP</h3>
<div class="outline-text-3" id="text-org15dd9c2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">RP</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.cursor = 0
        <span style="color: #f92672; font-weight: bold;">self</span>.length = jojo.length
        <span style="color: #f92672; font-weight: bold;">self</span>.body = jojo.body
        <span style="color: #f92672; font-weight: bold;">self</span>.lr = jojo.lr.copy()
</pre>
</div>
</div>
</div>

<div id="outline-container-org2914e48" class="outline-3">
<h3 id="org2914e48">VM</h3>
<div class="outline-text-3" id="text-org2914e48">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VM</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, ds, rs):
        <span style="color: #f92672; font-weight: bold;">self</span>.ds = ds
        <span style="color: #f92672; font-weight: bold;">self</span>.rs = rs

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">self</span>.rs != []:
            exe_one_step(<span style="color: #f92672; font-weight: bold;">self</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #f92672; font-weight: bold;">self</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e35779" class="outline-3">
<h3 id="org7e35779">VALUES</h3>
<div class="outline-text-3" id="text-org7e35779">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VALUES</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, *values):
        <span style="color: #f92672; font-weight: bold;">self</span>.values = values
</pre>
</div>
</div>
</div>

<div id="outline-container-org3268684" class="outline-3">
<h3 id="org3268684">push_result_to_vm</h3>
<div class="outline-text-3" id="text-org3268684">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">push_result_to_vm</span>(result, vm):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(result) == VALUES:
        vm.ds.extend(result.values)
    <span style="color: #f92672; font-weight: bold;">elif</span> result == <span style="color: #ae81ff;">None</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        vm.ds.append(result)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2364b9d" class="outline-3">
<h3 id="org2364b9d">exe_one_step</h3>
<div class="outline-text-3" id="text-org2364b9d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_one_step</span>(vm):
    <span style="color: #fd971f;">rp</span> = vm.rs.pop()
    <span style="color: #f92672; font-weight: bold;">if</span> rp.length == 0:
        <span style="color: #f92672; font-weight: bold;">return</span>

    <span style="color: #fd971f;">jo</span> = rp.body[rp.cursor]

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">handle tail call</span>
    <span style="color: #f92672; font-weight: bold;">if</span> rp.cursor &gt;= rp.length - 1:
       <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
       <span style="color: #fd971f;">rp.cursor</span> = rp.cursor + 1
       vm.rs.append(rp)

    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">dispatching</span>
    exe_jo(jo, rp, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d54e13" class="outline-3">
<h3 id="org2d54e13">exe_jo</h3>
<div class="outline-text-3" id="text-org2d54e13">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_jo</span>(jo, rp, vm):
    <span style="color: #f92672; font-weight: bold;">if</span> fun_p(jo):
        exe_fun(jo, vm)
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">hasattr</span>(jo, <span style="color: #e6db74;">"jo_exe"</span>):
        jo.jo_exe(rp, vm)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        vm.ds.append(jo)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6870967" class="outline-3">
<h3 id="org6870967">exe_fun</h3>
<div class="outline-text-3" id="text-org6870967">
</div><div id="outline-container-org502c88b" class="outline-4">
<h4 id="org502c88b"><span class="todo _note_">[note]</span> python funtion arguments</h4>
<div class="outline-text-4" id="text-org502c88b">
<ul class="org-ul">
<li><p>normal arguments are called positional arguments.</p></li>

<li><p>there are also keyword-only arguments,</p><p>because after *args,</p><p>the information about position will be lost.</p></li>

<li><p>before *args</p><p>each positional arguments took one position</p><p>do not respect default arguments</p></li>

<li><p>if *args is used in a function signature</p><p>pass it as a vect</p></li>

<li><p>if **kwargs is used in a function signature</p><p>pass it as a dict</p></li></ul>
</div>
</div>

<div id="outline-container-org93b3a8e" class="outline-4">
<h4 id="org93b3a8e">exe_fun</h4>
<div class="outline-text-4" id="text-org93b3a8e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">exe_fun</span>(fun, vm):
    <span style="color: #fd971f;">signature</span> = get_signature(fun)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> signature:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- exe_fun fail to get signature"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">parameters</span> = signature.parameters

    <span style="color: #f92672; font-weight: bold;">if</span> has_para_dict(parameters):
        <span style="color: #fd971f;">arg_dict</span> = get_default_arg_dict(parameters)
        <span style="color: #fd971f;">top_of_ds</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">isinstance</span>(top_of_ds, <span style="color: #a6e22e;">dict</span>):
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- exe_fun fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  when fun require a arg_dict"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  the top of data stack is not a dict"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  top of data stack : {}"</span>.<span style="color: #a6e22e;">format</span>(top_of_ds))
            <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
        arg_dict.update(top_of_ds)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">arg_dict</span> = <span style="color: #ae81ff;">None</span>

    <span style="color: #f92672; font-weight: bold;">if</span> has_para_vect(parameters):
        <span style="color: #fd971f;">top_of_ds</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> vect_p(top_of_ds):
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- exe_fun fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  when fun require a arg_vect"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  the top of data stack is not a vect"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  fun : {}"</span>.<span style="color: #a6e22e;">format</span>(fun))
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  top of data stack : {}"</span>.<span style="color: #a6e22e;">format</span>(top_of_ds))
            <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
        <span style="color: #fd971f;">arg_vect</span> = top_of_ds
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">arg_vect</span> = []

    <span style="color: #fd971f;">positional_para_length</span> = get_positional_para_length(parameters)
    <span style="color: #fd971f;">args</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; positional_para_length:
        args.append(vm.ds.pop())
        <span style="color: #fd971f;">i</span> = i + 1
    args.reverse()
    args.extend(arg_vect)

    <span style="color: #f92672; font-weight: bold;">if</span> arg_dict == <span style="color: #ae81ff;">None</span>:
        <span style="color: #fd971f;">result</span> = fun(*args)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">result</span> = fun(*args, **arg_dict)

    push_result_to_vm(result, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org28cbbdd" class="outline-4">
<h4 id="org28cbbdd">get_positional_para_length</h4>
<div class="outline-text-4" id="text-org28cbbdd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_positional_para_length</span>(parameters):
    <span style="color: #fd971f;">n</span> = 0
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.POSITIONAL_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
            v.kind == inspect.Parameter.POSITIONAL_OR_KEYWORD):
            <span style="color: #fd971f;">n</span> = n + 1
    <span style="color: #f92672; font-weight: bold;">return</span> n
</pre>
</div>
</div>
</div>

<div id="outline-container-org67db5b0" class="outline-4">
<h4 id="org67db5b0">has_para_vect</h4>
<div class="outline-text-4" id="text-org67db5b0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">has_para_vect</span>(parameters):
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.VAR_POSITIONAL):
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf21ebc7" class="outline-4">
<h4 id="orgf21ebc7">has_para_dict</h4>
<div class="outline-text-4" id="text-orgf21ebc7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">has_para_dict</span>(parameters):
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.KEYWORD_ONLY <span style="color: #f92672; font-weight: bold;">or</span>
            v.kind == inspect.Parameter.VAR_KEYWORD):
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bfe0a7" class="outline-4">
<h4 id="org2bfe0a7">get_default_arg_dict</h4>
<div class="outline-text-4" id="text-org2bfe0a7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_default_arg_dict</span>(parameters):
    <span style="color: #fd971f;">default_dict</span> = {}
    <span style="color: #f92672; font-weight: bold;">for</span> v <span style="color: #f92672; font-weight: bold;">in</span> parameters.values():
        <span style="color: #f92672; font-weight: bold;">if</span> (v.kind == inspect.Parameter.KEYWORD_ONLY <span style="color: #f92672; font-weight: bold;">and</span>
            v.default != inspect.Parameter.empty):
            <span style="color: #fd971f;">default_dict</span>[v.name] = v.default
    <span style="color: #f92672; font-weight: bold;">return</span> default_dict
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orge7484b7" class="outline-2">
<h2 id="orge7484b7">jo</h2>
<div class="outline-text-2" id="text-orge7484b7">
</div><div id="outline-container-org7d92d3b" class="outline-3">
<h3 id="org7d92d3b">top level</h3>
<div class="outline-text-3" id="text-org7d92d3b">
</div><div id="outline-container-orga76d0b6" class="outline-4">
<h4 id="orga76d0b6">JOJO</h4>
<div class="outline-text-4" id="text-orga76d0b6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, body):
        <span style="color: #f92672; font-weight: bold;">self</span>.length = <span style="color: #a6e22e;">len</span>(body)
        <span style="color: #f92672; font-weight: bold;">self</span>.body = Vect(body)
        <span style="color: #f92672; font-weight: bold;">self</span>.lr = {}

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.rs.append(RP(<span style="color: #f92672; font-weight: bold;">self</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb43f1" class="outline-3">
<h3 id="orgfb43f1">closure</h3>
<div class="outline-text-3" id="text-orgfb43f1">
</div><div id="outline-container-orgffdf0b1" class="outline-4">
<h4 id="orgffdf0b1">CLO</h4>
<div class="outline-text-4" id="text-orgffdf0b1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CLO</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, body):
        <span style="color: #f92672; font-weight: bold;">self</span>.body = body

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">new_jojo</span> = JOJO(<span style="color: #f92672; font-weight: bold;">self</span>.body)
        <span style="color: #fd971f;">new_jojo.lr</span> = rp.lr
        vm.ds.append(new_jojo)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f107f5" class="outline-4">
<h4 id="org6f107f5">APPLY</h4>
<div class="outline-text-4" id="text-org6f107f5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">APPLY</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">clo</span> = vm.ds.pop()
        clo.jo_exe(rp, vm)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5acc8a7" class="outline-3">
<h3 id="org5acc8a7">branching</h3>
<div class="outline-text-3" id="text-org5acc8a7">
</div><div id="outline-container-orgd95d359" class="outline-4">
<h4 id="orgd95d359">IFTE</h4>
<div class="outline-text-4" id="text-orgd95d359">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">IFTE</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">clo2</span> = vm.ds.pop()
        <span style="color: #fd971f;">clo1</span> = vm.ds.pop()
        <span style="color: #fd971f;">test</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> test:
            vm.rs.append(RP(clo1))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            vm.rs.append(RP(clo2))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf89824b" class="outline-3">
<h3 id="orgf89824b">CALL &#x2013; call a name from a module</h3>
<div class="outline-text-3" id="text-orgf89824b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">CALL</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, module, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.module = module
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">jo</span> = <span style="color: #a6e22e;">getattr</span>(<span style="color: #f92672; font-weight: bold;">self</span>.module, <span style="color: #f92672; font-weight: bold;">self</span>.name)
        exe_jo(jo, rp, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fa42ec" class="outline-3">
<h3 id="org6fa42ec">local variable</h3>
<div class="outline-text-3" id="text-org6fa42ec">
</div><div id="outline-container-orgd1a58f1" class="outline-4">
<h4 id="orgd1a58f1">GET</h4>
<div class="outline-text-4" id="text-orgd1a58f1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GET</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value</span> = rp.lr[<span style="color: #f92672; font-weight: bold;">self</span>.name]
        vm.ds.append(value)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffd548" class="outline-4">
<h4 id="orgffd548">SET</h4>
<div class="outline-text-4" id="text-orgffd548">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">SET</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, name):
        <span style="color: #f92672; font-weight: bold;">self</span>.name = name

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value</span> = vm.ds.pop()
        <span style="color: #fd971f;">rp.lr</span>[<span style="color: #f92672; font-weight: bold;">self</span>.name] = value
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdb9dec0" class="outline-3">
<h3 id="orgdb9dec0">mark and collect</h3>
<div class="outline-text-3" id="text-orgdb9dec0">
</div><div id="outline-container-org712701c" class="outline-4">
<h4 id="org712701c">MARK &#x2013; for collectors</h4>
<div class="outline-text-4" id="text-org712701c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MARK</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        vm.ds.append(<span style="color: #f92672; font-weight: bold;">self</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd177223" class="outline-4">
<h4 id="orgd177223">COLLECT_VECT &#x2013; collect values before mark to vect</h4>
<div class="outline-text-4" id="text-orgd177223">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">COLLECT_VECT</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vect</span> = []
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            <span style="color: #fd971f;">value</span> = vm.ds.pop()
            <span style="color: #f92672; font-weight: bold;">if</span> value == MARK:
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                vect.append(value)
        vect.reverse()
        vm.ds.append(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc07a6a4" class="outline-4">
<h4 id="orgc07a6a4">VECT_SPREAD &#x2013; spread values to data stack</h4>
<div class="outline-text-4" id="text-orgc07a6a4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">VECT_SPREAD</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">vect</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">for</span> value <span style="color: #f92672; font-weight: bold;">in</span> vect:
            vm.ds.append(value)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2b9295" class="outline-4">
<h4 id="orgd2b9295">COLLECT_LIST &#x2013; collect values before mark to list</h4>
<div class="outline-text-4" id="text-orgd2b9295">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">COLLECT_LIST</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(rest):
            <span style="color: #fd971f;">value</span> = vm.ds.pop()
            <span style="color: #f92672; font-weight: bold;">if</span> value == MARK:
                <span style="color: #f92672; font-weight: bold;">return</span> rest
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> recur(cons(value, rest))
        vm.ds.append(recur(null))
</pre>
</div>
</div>
</div>

<div id="outline-container-org29b0f11" class="outline-4">
<h4 id="org29b0f11">LIST_SPREAD &#x2013; spread values to data stack</h4>
<div class="outline-text-4" id="text-org29b0f11">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">LIST_SPREAD</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(l):
            <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
                <span style="color: #f92672; font-weight: bold;">pass</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                vm.ds.append(car(l))
                recur(cdr(l))
        recur(vm.ds.pop())
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc88337f" class="outline-3">
<h3 id="orgc88337f">data</h3>
<div class="outline-text-3" id="text-orgc88337f">
</div><div id="outline-container-org58399dd" class="outline-4">
<h4 id="org58399dd">DATA_PRED &#x2013; for data predicate</h4>
<div class="outline-text-4" id="text-org58399dd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">DATA_PRED</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, data_class):
        <span style="color: #f92672; font-weight: bold;">self</span>.data_class = data_class

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">x</span> = vm.ds.pop()
        vm.ds.append(<span style="color: #a6e22e;">type</span>(x) == <span style="color: #f92672; font-weight: bold;">self</span>.data_class)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga2e7ced" class="outline-3">
<h3 id="orga2e7ced">NEW &#x2013; create object from data and class</h3>
<div class="outline-text-3" id="text-orga2e7ced">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">NEW</span>:
    <span style="color: #66d9ef; font-weight: bold;">@classmethod</span>
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">x</span> = vm.ds.pop()
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> class_p(x):
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- NEW.jo_exe fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  argument is not a class : {}"</span>.<span style="color: #a6e22e;">format</span>(x))
            <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
        <span style="color: #f92672; font-weight: bold;">if</span> JOJO_DATA <span style="color: #f92672; font-weight: bold;">in</span> x.__bases__:
            <span style="color: #fd971f;">data_dict</span> = {}
            <span style="color: #f92672; font-weight: bold;">for</span> field_name <span style="color: #f92672; font-weight: bold;">in</span> x.reversed_field_name_vect:
                <span style="color: #fd971f;">data_dict</span>[field_name] = vm.ds.pop()
            <span style="color: #fd971f;">data_instance</span> = x(data_dict)
            vm.ds.append(data_instance)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            exe_fun(x, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6853a07" class="outline-3">
<h3 id="org6853a07">MSG &#x2013; message to object</h3>
<div class="outline-text-3" id="text-org6853a07">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">MSG</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, message):
        <span style="color: #f92672; font-weight: bold;">self</span>.message = message

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">o</span> = vm.ds.pop()
        <span style="color: #fd971f;">v</span> = <span style="color: #a6e22e;">getattr</span>(o, <span style="color: #f92672; font-weight: bold;">self</span>.message)
        <span style="color: #f92672; font-weight: bold;">if</span> method_p(v):
            exe_fun(v, vm)
        <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #a6e22e;">type</span>(v) == JOJO:
            vm.ds.append(o)
            exe_jo(v, rp, vm)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            exe_jo(v, rp, vm)
</pre>
</div>
</div>
</div>

<div id="outline-container-org21c5eea" class="outline-3">
<h3 id="org21c5eea">GENE</h3>
<div class="outline-text-3" id="text-org21c5eea">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">GENE</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, arity, default_jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.arity = arity
        <span style="color: #f92672; font-weight: bold;">self</span>.default_jojo = default_jojo
        <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict = {}

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jo_exe</span>(<span style="color: #f92672; font-weight: bold;">self</span>, rp, vm):
        <span style="color: #fd971f;">value_vect</span> = vm.ds[(- <span style="color: #f92672; font-weight: bold;">self</span>.arity):]
        <span style="color: #fd971f;">type_vect</span> = []
        <span style="color: #f92672; font-weight: bold;">for</span> value <span style="color: #f92672; font-weight: bold;">in</span> value_vect:
            type_vect.append(<span style="color: #a6e22e;">type</span>(value))

        <span style="color: #fd971f;">type_tuple</span> = <span style="color: #a6e22e;">tuple</span>(type_vect)
        <span style="color: #f92672; font-weight: bold;">if</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict:
            <span style="color: #fd971f;">jojo</span> = <span style="color: #f92672; font-weight: bold;">self</span>.disp_dict[type_tuple]
            jojo.jo_exe(rp, vm)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">self</span>.default_jojo.jo_exe(rp, vm)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgec332d5" class="outline-2">
<h2 id="orgec332d5">------</h2>
</div>
<div id="outline-container-org66d677f" class="outline-2">
<h2 id="org66d677f">scan &#x2013; lexer for sexp</h2>
<div class="outline-text-2" id="text-org66d677f">
</div><div id="outline-container-orgc20742b" class="outline-3">
<h3 id="orgc20742b">scan_string_vect</h3>
<div class="outline-text-3" id="text-orgc20742b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">scan_string_vect</span>(string):
    <span style="color: #fd971f;">string_vect</span> = []
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        <span style="color: #fd971f;">char</span> = string[i]

        <span style="color: #f92672; font-weight: bold;">if</span> space_p(char):
            <span style="color: #fd971f;">i</span> = i + 1

        <span style="color: #f92672; font-weight: bold;">elif</span> delimiter_p(char):
            string_vect.append(char)
            <span style="color: #fd971f;">i</span> = i + 1

        <span style="color: #f92672; font-weight: bold;">elif</span> doublequote_p(char):
            <span style="color: #fd971f;">doublequote_end_index</span> = string.find(<span style="color: #e6db74;">'"'</span>, i+1)
            <span style="color: #f92672; font-weight: bold;">if</span> doublequote_end_index == -1:
                <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- scan_string_vect fail"</span>)
                <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  doublequote mismatch"</span>)
                <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  string : {}"</span>.<span style="color: #a6e22e;">format</span>(string))
                <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
            <span style="color: #fd971f;">end</span> = doublequote_end_index + 1
            string_vect.append(string[i:end])
            <span style="color: #fd971f;">i</span> = end

        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">end</span> = find_end(string, i+1)
            string_vect.append(string[i:end])
            <span style="color: #fd971f;">i</span> = end

    <span style="color: #f92672; font-weight: bold;">return</span> string_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ede4d6" class="outline-3">
<h3 id="org6ede4d6">find_end</h3>
<div class="outline-text-3" id="text-org6ede4d6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">find_end</span>(string, begin):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #fd971f;">i</span> = begin
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
       <span style="color: #f92672; font-weight: bold;">if</span> i == length:
           <span style="color: #f92672; font-weight: bold;">return</span> i
       <span style="color: #fd971f;">char</span> = string[i]
       <span style="color: #f92672; font-weight: bold;">if</span> (space_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
           delimiter_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
           doublequote_p(char)):
           <span style="color: #f92672; font-weight: bold;">return</span> i
       <span style="color: #fd971f;">i</span> = i + 1
</pre>
</div>
</div>
</div>

<div id="outline-container-org644063e" class="outline-3">
<h3 id="org644063e">space_p</h3>
<div class="outline-text-3" id="text-org644063e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">space_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> char.isspace()
</pre>
</div>
</div>
</div>

<div id="outline-container-orga33c234" class="outline-3">
<h3 id="orga33c234">delimiter_p</h3>
<div class="outline-text-3" id="text-orga33c234">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">delimiter_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> (char == <span style="color: #e6db74;">'('</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">')'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'['</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">']'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'{'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'}'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">','</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">'`'</span> <span style="color: #f92672; font-weight: bold;">or</span>
            char == <span style="color: #e6db74;">"'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org366e45f" class="outline-3">
<h3 id="org366e45f">doublequote_p</h3>
<div class="outline-text-3" id="text-org366e45f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequote_p</span>(char):
    <span style="color: #f92672; font-weight: bold;">return</span> char == <span style="color: #e6db74;">'"'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org69c11e1" class="outline-2">
<h2 id="org69c11e1">null &amp; cons</h2>
<div class="outline-text-2" id="text-org69c11e1">
</div><div id="outline-container-orgb9cb7ae" class="outline-3">
<h3 id="orgb9cb7ae">Null</h3>
<div class="outline-text-3" id="text-orgb9cb7ae">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Null</span>:
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a6afcd" class="outline-3">
<h3 id="org1a6afcd">null</h3>
<div class="outline-text-3" id="text-org1a6afcd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">null</span> = Null()
</pre>
</div>
</div>
</div>

<div id="outline-container-org376399d" class="outline-3">
<h3 id="org376399d">null_p</h3>
<div class="outline-text-3" id="text-org376399d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">null_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x == null
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2a7055" class="outline-3">
<h3 id="orge2a7055">Cons</h3>
<div class="outline-text-3" id="text-orge2a7055">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">Cons</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, car, cdr):
        <span style="color: #f92672; font-weight: bold;">self</span>.car = car
        <span style="color: #f92672; font-weight: bold;">self</span>.cdr = cdr
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3f9b8b" class="outline-3">
<h3 id="orga3f9b8b">cons</h3>
<div class="outline-text-3" id="text-orga3f9b8b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons</span>(car, cdr):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(cdr) <span style="color: #f92672; font-weight: bold;">or</span> cons_p(cdr):
        <span style="color: #f92672; font-weight: bold;">return</span> Cons(car, cdr)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- cons fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  cdr of cons must be a cons or null"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  cdr : {}"</span>.<span style="color: #a6e22e;">format</span>(cdr))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>

<div id="outline-container-orge152a98" class="outline-3">
<h3 id="orge152a98">cons_p</h3>
<div class="outline-text-3" id="text-orge152a98">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">isinstance</span>(x, Cons)
</pre>
</div>
</div>
</div>

<div id="outline-container-org12ea7d1" class="outline-3">
<h3 id="org12ea7d1">cdr</h3>
<div class="outline-text-3" id="text-org12ea7d1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cdr</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x.cdr
</pre>
</div>
</div>
</div>

<div id="outline-container-org29c7578" class="outline-3">
<h3 id="org29c7578">car</h3>
<div class="outline-text-3" id="text-org29c7578">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">car</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> x.car
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6561f3f" class="outline-2">
<h2 id="org6561f3f">sexp &#x2013; string expression</h2>
<div class="outline-text-2" id="text-org6561f3f">
</div><div id="outline-container-orga71eb34" class="outline-3">
<h3 id="orga71eb34"><span class="todo _note_">[note]</span> syntax sugar</h3>
<div class="outline-text-3" id="text-orga71eb34">
<ul class="org-ul">
<li><p>[&#x2026;] -&gt; (begin &#x2026;)</p></li>
<li><p>{&#x2026;} -&gt; (clo &#x2026;)</p></li>
<li><p>' &#x2026; -&gt; (quote &#x2026;)</p></li>
<li><p>` &#x2026; -&gt; (partquote &#x2026;)</p></li></ul>
</div>
</div>

<div id="outline-container-org891c54a" class="outline-3">
<h3 id="org891c54a">parse_sexp_vect &#x2013; string vect to sexp vect</h3>
<div class="outline-text-3" id="text-org891c54a">
<ul class="org-ul">
<li><p>sexp := Null | Cons(sexp, sexp_list) | string</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp_vect</span>(string_vect):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string_vect)
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #fd971f;">sexp_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
       <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i</span> = parse_sexp(string_vect, i)
       sexp_vect.append(s)
    <span style="color: #f92672; font-weight: bold;">return</span> sexp_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org5be8b52" class="outline-3">
<h3 id="org5be8b52">parse_sexp</h3>
<div class="outline-text-3" id="text-org5be8b52">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp</span>(string_vect, i):
    <span style="color: #fd971f;">string</span> = string_vect[i]
    <span style="color: #f92672; font-weight: bold;">if</span> string == <span style="color: #e6db74;">'('</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">')'</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'['</span>:
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i1</span> = parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">']'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'begin'</span>, s_cons), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'{'</span>:
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i1</span> = parse_sexp_cons_until_ket(string_vect, i+1, <span style="color: #e6db74;">'}'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'clo'</span>, s_cons), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"'"</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i+1)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'quote'</span>, cons(s, null)), i1)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"`"</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i+1)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(<span style="color: #e6db74;">'partquote'</span>, cons(s, null)), i1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> (string, i+1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbd5285" class="outline-3">
<h3 id="orgfbd5285">parse_sexp_cons_until_ket</h3>
<div class="outline-text-3" id="text-orgfbd5285">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">parse_sexp_cons_until_ket</span>(string_vect, i, ket):
    <span style="color: #fd971f;">string</span> = string_vect[i]
    <span style="color: #f92672; font-weight: bold;">if</span> string == ket:
        <span style="color: #f92672; font-weight: bold;">return</span> (null, i+1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">s</span>, <span style="color: #fd971f;">i1</span> = parse_sexp(string_vect, i)
        <span style="color: #fd971f;">s_cons</span>, <span style="color: #fd971f;">i2</span> = \
            parse_sexp_cons_until_ket(string_vect, i1, ket)
        <span style="color: #f92672; font-weight: bold;">return</span> (cons(s, s_cons), i2)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9055ecf" class="outline-3">
<h3 id="org9055ecf">p_print</h3>
<div class="outline-text-3" id="text-org9055ecf">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_print</span>(x):
    <span style="color: #f92672; font-weight: bold;">print</span>(x, end=<span style="color: #e6db74;">""</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org67db0df" class="outline-3">
<h3 id="org67db0df">sexp_print</h3>
<div class="outline-text-3" id="text-org67db0df">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_print</span>(s):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(s):
        p_print (<span style="color: #e6db74;">"null"</span>)
    <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(s):
        p_print (<span style="color: #e6db74;">"("</span>)
        sexp_list_print(s)
        p_print (<span style="color: #e6db74;">")"</span>)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        p_print (s)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf83ba5" class="outline-3">
<h3 id="orgaf83ba5">sexp_list_print</h3>
<div class="outline-text-3" id="text-orgaf83ba5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_list_print</span>(s_cons):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(s_cons):
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> null_p(cdr(s_cons)):
        sexp_print(car(s_cons))
    <span style="color: #f92672; font-weight: bold;">else</span>:
        sexp_print(car(s_cons))
        p_print (<span style="color: #e6db74;">" "</span>)
        sexp_list_print(cdr(s_cons))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org178e026" class="outline-2">
<h2 id="org178e026"><span class="todo _note_">[note]</span> syntax</h2>
<div class="outline-text-2" id="text-org178e026">
</div><div id="outline-container-orgb7a82ce" class="outline-3">
<h3 id="orgb7a82ce">top level</h3>
<div class="outline-text-3" id="text-orgb7a82ce">
<ul class="org-ul">
<li><p>(note)</p></li>
<li><p>(import)</p></li>

<li><p>(+jojo)</p></li>
<li><p>(+macro)</p></li>

<li><p>(+data)</p></li>
<li><p>(+union)</p></li>
<li><p>(+gene)</p></li>
<li><p>(+disp)</p></li></ul>
</div>
</div>

<div id="outline-container-orgdd6719f" class="outline-3">
<h3 id="orgdd6719f">control</h3>
<div class="outline-text-3" id="text-orgdd6719f">
<ul class="org-ul">
<li><p>(begin)</p></li>
<li><p>(clo)</p></li>
<li><p>(if)</p></li>
<li><p>(cond)</p></li>
<li><p>(case)</p></li></ul>
</div>
</div>

<div id="outline-container-orgf2a57fa" class="outline-3">
<h3 id="orgf2a57fa">sexp quote</h3>
<div class="outline-text-3" id="text-orgf2a57fa">
<ul class="org-ul">
<li><p>(quote)</p></li>
<li><p>(partquote (@))</p></li></ul>
</div>
</div>

<div id="outline-container-orgfa8b6ea" class="outline-3">
<h3 id="orgfa8b6ea">data</h3>
<div class="outline-text-3" id="text-orgfa8b6ea">
<ul class="org-ul">
<li><p>(list)</p></li>
<li><p>(vect)</p></li>
<li><p>(dict)</p></li>
<li><p>(tuple) (*)</p></li>
<li><p>(set)</p></li></ul>
</div>
</div>

<div id="outline-container-orgb2c799f" class="outline-3">
<h3 id="orgb2c799f">key jo</h3>
<div class="outline-text-3" id="text-orgb2c799f">
<ul class="org-ul">
<li><p>apply</p></li>
<li><p>ifte</p></li>
<li><p>new</p></li></ul>
</div>
</div>

<div id="outline-container-orgb1c59bc" class="outline-3">
<h3 id="orgb1c59bc">jo pattern</h3>
<div class="outline-text-3" id="text-orgb1c59bc">
<ul class="org-ul">
<li><p>:local</p></li>
<li><p>:local!</p></li>
<li><p>.message</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-orgb3f9f7a" class="outline-2">
<h2 id="orgb3f9f7a">compiler</h2>
<div class="outline-text-2" id="text-orgb3f9f7a">
</div><div id="outline-container-org1a041d0" class="outline-3">
<h3 id="org1a041d0">new_module</h3>
<div class="outline-text-3" id="text-org1a041d0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">new_module</span>(name):
    <span style="color: #fd971f;">module</span> = types.ModuleType(name)
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">for top level sexp</span>
    <span style="color: #fd971f;">module.vm</span> = VM([], [])
    <span style="color: #FF8888;"># </span><span style="color: #FF8888;">for name can occur before been defined</span>
    <span style="color: #fd971f;">module.defined_name_set</span> = <span style="color: #a6e22e;">set</span>()
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orge35f424" class="outline-3">
<h3 id="orge35f424">filter_name_vect</h3>
<div class="outline-text-3" id="text-orge35f424">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">filter_name_vect</span>(keyword, sexp_vect):
    <span style="color: #fd971f;">name_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> cons_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> car(sexp) == keyword:
            <span style="color: #fd971f;">body</span> = cdr(sexp)
            <span style="color: #fd971f;">name</span> = car(body)
            name_vect.append(name)
    <span style="color: #f92672; font-weight: bold;">return</span> name_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org85f4b7b" class="outline-3">
<h3 id="org85f4b7b">jojo_define</h3>
<div class="outline-text-3" id="text-org85f4b7b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">jojo_define</span>(module, name, value):
    <span style="color: #fd971f;">defined_name_set</span> = <span style="color: #a6e22e;">getattr</span>(module, <span style="color: #e6db74;">'defined_name_set'</span>)
    defined_name_set.add(name)
    <span style="color: #a6e22e;">setattr</span>(module, name, value)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1c4a51" class="outline-3">
<h3 id="orgc1c4a51">merge_prim_dict</h3>
<div class="outline-text-3" id="text-orgc1c4a51">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_prim_dict</span>(module):
    <span style="color: #f92672; font-weight: bold;">for</span> name, value <span style="color: #f92672; font-weight: bold;">in</span> prim_dict.items():
        jojo_define(module, name, value)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5112cb7" class="outline-3">
<h3 id="org5112cb7">merge_module</h3>
<div class="outline-text-3" id="text-org5112cb7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_module</span>(module, src_module):
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> src_module.defined_name_set:
        <span style="color: #fd971f;">jojo</span> = <span style="color: #a6e22e;">getattr</span>(src_module, name)
        jojo_define(module, name, jojo)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6bc011" class="outline-3">
<h3 id="orgc6bc011">merge_sexp_vect</h3>
<div class="outline-text-3" id="text-orgc6bc011">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">merge_sexp_vect</span>(module, sexp_vect):
    module.defined_name_set.update(filter_name_vect(<span style="color: #e6db74;">'+jojo'</span>, sexp_vect))
    module.defined_name_set.update(filter_name_vect(<span style="color: #e6db74;">'+data'</span>, sexp_vect))
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #fd971f;">jo_vect</span> = sexp_emit(module, sexp)
        module.vm.rs.append(RP(JOJO(jo_vect)))
        module.vm.exe()
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org4608270" class="outline-3">
<h3 id="org4608270">compile_module</h3>
<div class="outline-text-3" id="text-org4608270">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">compile_module</span>(name, sexp_vect):
    <span style="color: #fd971f;">module</span> = new_module(name)
    merge_prim_dict(module)
    merge_module(module, core_module)
    merge_sexp_vect(module, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7cf0aa" class="outline-3">
<h3 id="orga7cf0aa">compile_core_module</h3>
<div class="outline-text-3" id="text-orga7cf0aa">
<ul class="org-ul">
<li><p>compile the core_module itself</p><p>without merging core_module</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">compile_core_module</span>(name, sexp_vect):
    <span style="color: #fd971f;">module</span> = new_module(name)
    merge_prim_dict(module)
    merge_sexp_vect(module, sexp_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orgabcf794" class="outline-3">
<h3 id="orgabcf794">sexp_list_emit</h3>
<div class="outline-text-3" id="text-orgabcf794">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_list_emit</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        jo_vect.extend(sexp_emit(module, sexp))
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org589b25c" class="outline-3">
<h3 id="org589b25c">sexp_emit</h3>
<div class="outline-text-3" id="text-org589b25c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_emit</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> null_emit(module, sexp)
    <span style="color: #f92672; font-weight: bold;">elif</span> cons_p(sexp):
        <span style="color: #f92672; font-weight: bold;">return</span> cons_emit(module, sexp)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> string_emit(module, sexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge37cea0" class="outline-3">
<h3 id="orge37cea0">null_emit</h3>
<div class="outline-text-3" id="text-orge37cea0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">null_emit</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">return</span> [null]
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea1df38" class="outline-3">
<h3 id="orgea1df38">cons_emit</h3>
<div class="outline-text-3" id="text-orgea1df38">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">cons_emit</span>(module, cons):
    <span style="color: #fd971f;">keyword</span> = car(cons)
    <span style="color: #f92672; font-weight: bold;">if</span> keyword <span style="color: #f92672; font-weight: bold;">in</span> keyword_dict.keys():
        <span style="color: #fd971f;">fun</span> = keyword_dict[keyword]
        <span style="color: #f92672; font-weight: bold;">return</span> fun(module, cdr(cons))
    <span style="color: #f92672; font-weight: bold;">elif</span> keyword <span style="color: #f92672; font-weight: bold;">in</span> macro_dict.keys():
        <span style="color: #fd971f;">fun</span> = macro_dict[keyword]
        <span style="color: #fd971f;">new_sexp</span> = fun(cdr(cons))
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_emit(module, new_sexp)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">vm</span> = VM([cdr(cons)],
                [RP(JOJO(string_emit(module, keyword)))])
        vm.exe()
        <span style="color: #fd971f;">new_sexp</span> = vm.ds[0]
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_emit(module, new_sexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e00e50" class="outline-3">
<h3 id="org5e00e50">string_emit</h3>
<div class="outline-text-3" id="text-org5e00e50">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_emit</span>(module, string):
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; <span style="color: #a6e22e;">len</span>(string_emitter_vect):
        <span style="color: #fd971f;">p</span> = string_emitter_vect[i][0]
        <span style="color: #fd971f;">e</span> = string_emitter_vect[i][1]
        <span style="color: #f92672; font-weight: bold;">if</span> p(string):
            <span style="color: #f92672; font-weight: bold;">return</span> e(module, string)
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">i</span> = i + 1

    <span style="color: #f92672; font-weight: bold;">if</span> string <span style="color: #f92672; font-weight: bold;">in</span> key_jo_dict.keys():
        <span style="color: #f92672; font-weight: bold;">return</span> key_jo_dict[string]

    <span style="color: #fd971f;">defined_name_set</span> = <span style="color: #a6e22e;">getattr</span>(module, <span style="color: #e6db74;">'defined_name_set'</span>)
    <span style="color: #f92672; font-weight: bold;">if</span> string <span style="color: #f92672; font-weight: bold;">in</span> defined_name_set:
        <span style="color: #f92672; font-weight: bold;">return</span> [CALL(module, string)]

    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- string_emit fail"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  meet undefined string : {}"</span>.<span style="color: #a6e22e;">format</span>(string))
    newline()
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>

<div id="outline-container-orga254ae6" class="outline-3">
<h3 id="orga254ae6">sexp_value</h3>
<div class="outline-text-3" id="text-orga254ae6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sexp_value</span>(module, sexp):
    <span style="color: #fd971f;">jo_vect</span> = sexp_emit(module, sexp)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    <span style="color: #fd971f;">vm</span> = VM([], [RP(jojo)])
    vm.exe()
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vm.ds) != 1:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- sexp_value fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  sexp must return one value"</span>)
        p_print (<span style="color: #e6db74;">"  sexp : "</span>)
        sexp_print(sexp)
        newline()
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  number of values : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(vm.ds)))
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  returned : {}"</span>.<span style="color: #a6e22e;">format</span>(vm.ds))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">value</span> = vm.ds[0]
    <span style="color: #f92672; font-weight: bold;">return</span> value
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5f8318" class="outline-2">
<h2 id="org5f8318">------</h2>
</div>
<div id="outline-container-org2babdb3" class="outline-2">
<h2 id="org2babdb3">string_emitter_vect</h2>
<div class="outline-text-2" id="text-org2babdb3">
</div><div id="outline-container-org7c45d9f" class="outline-3">
<h3 id="org7c45d9f">string_emitter_vect</h3>
<div class="outline-text-3" id="text-org7c45d9f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">string_emitter_vect</span> = []
</pre>
</div>
</div>
</div>

<div id="outline-container-org245e950" class="outline-3">
<h3 id="org245e950">string_emitter</h3>
<div class="outline-text-3" id="text-org245e950">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_emitter</span>(p, emitter):
    string_emitter_vect.append((p, emitter))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6f05b9" class="outline-3">
<h3 id="orgb6f05b9">int_string</h3>
<div class="outline-text-3" id="text-orgb6f05b9">
</div><div id="outline-container-org660f420" class="outline-4">
<h4 id="org660f420">int_string_p</h4>
<div class="outline-text-4" id="text-org660f420">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_string_p</span>(string):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(string)
    <span style="color: #f92672; font-weight: bold;">if</span> length == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] == <span style="color: #e6db74;">'-'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(string[1:])
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> nat_string_p(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb3a985b" class="outline-4">
<h4 id="orgb3a985b">nat_string_p</h4>
<div class="outline-text-4" id="text-orgb3a985b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">nat_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> string.isdecimal()
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c872df" class="outline-4">
<h4 id="org2c872df">int_string_emitter</h4>
<div class="outline-text-4" id="text-org2c872df">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_string_emitter</span>(module, string):
    <span style="color: #f92672; font-weight: bold;">return</span> [<span style="color: #a6e22e;">int</span>(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org3d5acc4" class="outline-4">
<h4 id="org3d5acc4">record</h4>
<div class="outline-text-4" id="text-org3d5acc4">
<div class="org-src-container">

<pre class="src src-python">string_emitter(int_string_p,
               int_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7cfb2a4" class="outline-3">
<h3 id="org7cfb2a4">doublequoted_string</h3>
<div class="outline-text-3" id="text-org7cfb2a4">
</div><div id="outline-container-orgc450e16" class="outline-4">
<h4 id="orgc450e16">doublequoted_string_p</h4>
<div class="outline-text-4" id="text-orgc450e16">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequoted_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org59e5c5e" class="outline-4">
<h4 id="org59e5c5e">doublequoted_string_emitter</h4>
<div class="outline-text-4" id="text-org59e5c5e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">doublequoted_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [string]
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cf9b76" class="outline-4">
<h4 id="org7cf9b76">record</h4>
<div class="outline-text-4" id="text-org7cf9b76">
<div class="org-src-container">

<pre class="src src-python">string_emitter(doublequoted_string_p,
               doublequoted_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf627ade" class="outline-3">
<h3 id="orgf627ade">local_string</h3>
<div class="outline-text-3" id="text-orgf627ade">
</div><div id="outline-container-org671cf34" class="outline-4">
<h4 id="org671cf34">local_string_p</h4>
<div class="outline-text-4" id="text-org671cf34">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] == <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68e2648" class="outline-4">
<h4 id="org68e2648">local_string_emitter</h4>
<div class="outline-text-4" id="text-org68e2648">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_string_emitter</span>(module, string):
    <span style="color: #f92672; font-weight: bold;">return</span> [GET(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org7be77b9" class="outline-4">
<h4 id="org7be77b9">record</h4>
<div class="outline-text-4" id="text-org7be77b9">
<div class="org-src-container">

<pre class="src src-python">string_emitter(local_string_p,
               local_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org680193d" class="outline-3">
<h3 id="org680193d">set_local_string</h3>
<div class="outline-text-3" id="text-org680193d">
</div><div id="outline-container-orgf0507ad" class="outline-4">
<h4 id="orgf0507ad">set_local_string_p</h4>
<div class="outline-text-4" id="text-orgf0507ad">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_local_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org13560c3" class="outline-4">
<h4 id="org13560c3">set_local_string_emitter</h4>
<div class="outline-text-4" id="text-org13560c3">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_local_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[:-1]
    <span style="color: #f92672; font-weight: bold;">return</span> [SET(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org89fec5c" class="outline-4">
<h4 id="org89fec5c">record</h4>
<div class="outline-text-4" id="text-org89fec5c">
<div class="org-src-container">

<pre class="src src-python">string_emitter(set_local_string_p,
               set_local_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb5ddec2" class="outline-3">
<h3 id="orgb5ddec2">message_string</h3>
<div class="outline-text-3" id="text-orgb5ddec2">
</div><div id="outline-container-org8222ddd" class="outline-4">
<h4 id="org8222ddd">message_string_p</h4>
<div class="outline-text-4" id="text-org8222ddd">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 2:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3c6c3a" class="outline-4">
<h4 id="orga3c6c3a">message_string_emitter</h4>
<div class="outline-text-4" id="text-orga3c6c3a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">string</span> = string[1:]
    <span style="color: #f92672; font-weight: bold;">return</span> [MSG(string)]
</pre>
</div>
</div>
</div>

<div id="outline-container-org490ae02" class="outline-4">
<h4 id="org490ae02">record</h4>
<div class="outline-text-4" id="text-org490ae02">
<div class="org-src-container">

<pre class="src src-python">string_emitter(message_string_p,
               message_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcb7d202" class="outline-3">
<h3 id="orgcb7d202">name_message_string</h3>
<div class="outline-text-3" id="text-orgcb7d202">
</div><div id="outline-container-orgee1d554" class="outline-4">
<h4 id="orgee1d554">name_message_string_p</h4>
<div class="outline-text-4" id="text-orgee1d554">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">name_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3: <span style="color: #FF8888;"># </span><span style="color: #FF8888;">example : 'n.s'</span>
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] == <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'..'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] == <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e53dc6" class="outline-4">
<h4 id="org1e53dc6">name_message_string_emitter</h4>
<div class="outline-text-4" id="text-org1e53dc6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">name_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)

    <span style="color: #fd971f;">name_string</span> = string_vect[0]
    jo_vect.extend(string_emit(module, name_string))

    <span style="color: #fd971f;">message_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> message_string <span style="color: #f92672; font-weight: bold;">in</span> message_string_vect:
        jo_vect.append(MSG(message_string))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org19ce692" class="outline-4">
<h4 id="org19ce692">record</h4>
<div class="outline-text-4" id="text-org19ce692">
<div class="org-src-container">

<pre class="src src-python">string_emitter(name_message_string_p,
               name_message_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge26dfdb" class="outline-3">
<h3 id="orge26dfdb">local_message_string</h3>
<div class="outline-text-3" id="text-orge26dfdb">
</div><div id="outline-container-org39a6ab1" class="outline-4">
<h4 id="org39a6ab1">local_message_string_p</h4>
<div class="outline-text-4" id="text-org39a6ab1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 4:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">':'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> name_message_string_p(string[1:])
</pre>
</div>
</div>
</div>

<div id="outline-container-org70bdce4" class="outline-4">
<h4 id="org70bdce4">local_message_string_emitter</h4>
<div class="outline-text-4" id="text-org70bdce4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">local_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)

    <span style="color: #fd971f;">local_string</span> = string_vect[0]
    jo_vect.append(GET(local_string))

    <span style="color: #fd971f;">message_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> message_string <span style="color: #f92672; font-weight: bold;">in</span> message_string_vect:
        jo_vect.append(MSG(message_string))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org654769e" class="outline-4">
<h4 id="org654769e">record</h4>
<div class="outline-text-4" id="text-org654769e">
<div class="org-src-container">

<pre class="src src-python">string_emitter(local_message_string_p,
               local_message_string_emitter)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9bb8445" class="outline-3">
<h3 id="org9bb8445">message_message_string</h3>
<div class="outline-text-3" id="text-org9bb8445">
</div><div id="outline-container-orgd08749a" class="outline-4">
<h4 id="orgd08749a">message_message_string_p</h4>
<div class="outline-text-4" id="text-orgd08749a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_message_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 4:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'.'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> name_message_string_p(string[1:])
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1791e0" class="outline-4">
<h4 id="orge1791e0">message_message_string_emitter</h4>
<div class="outline-text-4" id="text-orge1791e0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">message_message_string_emitter</span>(module, string):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #fd971f;">string_vect</span> = string.split(<span style="color: #e6db74;">'.'</span>)

    <span style="color: #fd971f;">message_string_vect</span> = string_vect[1:]
    <span style="color: #f92672; font-weight: bold;">for</span> message_string <span style="color: #f92672; font-weight: bold;">in</span> message_string_vect:
        jo_vect.append(MSG(message_string))

    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org22cf20f" class="outline-4">
<h4 id="org22cf20f">record</h4>
<div class="outline-text-4" id="text-org22cf20f">
<div class="org-src-container">

<pre class="src src-python">string_emitter(message_message_string_p,
               message_message_string_emitter)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org795d3aa" class="outline-2">
<h2 id="org795d3aa">prim_dict</h2>
<div class="outline-text-2" id="text-org795d3aa">
</div><div id="outline-container-org166530f" class="outline-3">
<h3 id="org166530f">prim_dict</h3>
<div class="outline-text-3" id="text-org166530f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">prim_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd44f0f" class="outline-3">
<h3 id="orgcd44f0f">@prim</h3>
<div class="outline-text-3" id="text-orgcd44f0f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">prim</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">prim_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4cf9c7" class="outline-2">
<h2 id="orgc4cf9c7">------</h2>
</div>
<div id="outline-container-org739eaa4" class="outline-2">
<h2 id="org739eaa4"><b>stack operation</b></h2>
<div class="outline-text-2" id="text-org739eaa4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'drop'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">drop</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">None</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dup'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dup</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(a, a)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'over'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">over</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(a, b, a)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuck'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuck</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(b, a, b)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'swap'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">swap</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(b, a)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb8e1542" class="outline-2">
<h2 id="orgb8e1542"><b>error</b></h2>
<div class="outline-text-2" id="text-orgb8e1542">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'error'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">error</span>():
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>

<div id="outline-container-org43b707" class="outline-2">
<h2 id="org43b707"><b>int</b></h2>
<div class="outline-text-2" id="text-org43b707">
</div><div id="outline-container-orgbb3bda" class="outline-3">
<h3 id="orgbb3bda">Int</h3>
<div class="outline-text-3" id="text-orgbb3bda">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Int'</span>)(<span style="color: #a6e22e;">int</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge18a4e9" class="outline-3">
<h3 id="orge18a4e9">int_p</h3>
<div class="outline-text-3" id="text-orge18a4e9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'int?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">int</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4792d9" class="outline-3">
<h3 id="orga4792d9">primary school</h3>
<div class="outline-text-3" id="text-orga4792d9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'inc'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">inc</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> a + 1

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dec'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dec</span>(a):
    <span style="color: #f92672; font-weight: bold;">return</span> a - 1

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'add'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">add</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a + b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'sub'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">sub</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a - b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'mul'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">mul</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a * b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'div'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">div</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a // b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'mod'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">mod</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a % b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'divmod'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_divmod</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> VALUES(*<span style="color: #a6e22e;">divmod</span>(a, b))
</pre>
</div>
</div>
</div>

<div id="outline-container-org840ac6e" class="outline-3">
<h3 id="org840ac6e">compare</h3>
<div class="outline-text-3" id="text-org840ac6e">
</div><div id="outline-container-orgda204b8" class="outline-4">
<h4 id="orgda204b8">lt_p &#x2013; less then</h4>
<div class="outline-text-4" id="text-orgda204b8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'lt?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">lt_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &lt; b
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ec8f0b" class="outline-4">
<h4 id="org2ec8f0b">gt_p &#x2013; greater then</h4>
<div class="outline-text-4" id="text-org2ec8f0b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'gt?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">gt_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &gt; b
</pre>
</div>
</div>
</div>

<div id="outline-container-org90e0e46" class="outline-4">
<h4 id="org90e0e46">lteq_p &#x2013; less then or equal to</h4>
<div class="outline-text-4" id="text-org90e0e46">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'lteq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">lteq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &lt;= b
</pre>
</div>
</div>
</div>

<div id="outline-container-org91c8181" class="outline-4">
<h4 id="org91c8181">gteq_p &#x2013; greater then or equal to</h4>
<div class="outline-text-4" id="text-org91c8181">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'gteq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">gteq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a &gt;= b
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37c8366" class="outline-3">
<h3 id="org37c8366">int_print</h3>
<div class="outline-text-3" id="text-org37c8366">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'int-print'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">int_print</span>(i):
    p_print(i)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge8930dd" class="outline-2">
<h2 id="orge8930dd"><b>bool</b></h2>
<div class="outline-text-2" id="text-orge8930dd">
</div><div id="outline-container-org9a577c0" class="outline-3">
<h3 id="org9a577c0">Bool</h3>
<div class="outline-text-3" id="text-org9a577c0">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Bool'</span>)(<span style="color: #a6e22e;">bool</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb4aeed" class="outline-3">
<h3 id="orgbb4aeed">basic</h3>
<div class="outline-text-3" id="text-orgbb4aeed">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'true'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">true</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'false'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">false</span>():
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'not'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_not</span>(b):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #f92672; font-weight: bold;">not</span> b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'and'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_and</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> (a <span style="color: #f92672; font-weight: bold;">and</span> b)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'or'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">p_or</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> (a <span style="color: #f92672; font-weight: bold;">or</span> b)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeb4d49" class="outline-2">
<h2 id="orgeb4d49"><b>equivalence</b></h2>
<div class="outline-text-2" id="text-orgeb4d49">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'equal?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">equal_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a == b

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'eq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">eq_p</span>(a, b):
    <span style="color: #f92672; font-weight: bold;">return</span> a <span style="color: #f92672; font-weight: bold;">is</span> b
</pre>
</div>
</div>
</div>

<div id="outline-container-org4afbb5f" class="outline-2">
<h2 id="org4afbb5f"><b>sexp</b></h2>
<div class="outline-text-2" id="text-org4afbb5f">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'null'</span>)(null)
prim(<span style="color: #e6db74;">'null?'</span>)(null_p)

prim(<span style="color: #e6db74;">'cons'</span>)(cons)
prim(<span style="color: #e6db74;">'cons?'</span>)(cons_p)

prim(<span style="color: #e6db74;">'car'</span>)(car)
prim(<span style="color: #e6db74;">'cdr'</span>)(cdr)

prim(<span style="color: #e6db74;">'sexp-print'</span>)(sexp_print)
prim(<span style="color: #e6db74;">'sexp-list-print'</span>)(sexp_list_print)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bd2afc" class="outline-2">
<h2 id="org4bd2afc"><b>string</b></h2>
<div class="outline-text-2" id="text-org4bd2afc">
</div><div id="outline-container-orgc828d00" class="outline-3">
<h3 id="orgc828d00">String</h3>
<div class="outline-text-3" id="text-orgc828d00">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'String'</span>)(<span style="color: #a6e22e;">str</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac3f81d" class="outline-3">
<h3 id="orgac3f81d">string_p</h3>
<div class="outline-text-3" id="text-orgac3f81d">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'string?'</span>)(string_p)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bd17c7" class="outline-3">
<h3 id="org2bd17c7">string_print</h3>
<div class="outline-text-3" id="text-org2bd17c7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-print'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_print</span>(string):
    p_print(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6e26a5b" class="outline-3">
<h3 id="org6e26a5b">string_length</h3>
<div class="outline-text-3" id="text-org6e26a5b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string_length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_length</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(string)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b45129" class="outline-3">
<h3 id="org9b45129">string_ref</h3>
<div class="outline-text-3" id="text-org9b45129">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_ref</span>(string, index):
    <span style="color: #f92672; font-weight: bold;">return</span> string[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org669b17c" class="outline-3">
<h3 id="org669b17c">string_append</h3>
<div class="outline-text-3" id="text-org669b17c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_append</span>(string1, string2):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join([string1, string2])
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd4251b" class="outline-3">
<h3 id="orgcd4251b">string_slice</h3>
<div class="outline-text-3" id="text-orgcd4251b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-slice'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_slice</span>(string, begin, end):
    <span style="color: #f92672; font-weight: bold;">return</span> string[begin:end]
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bde2f2" class="outline-3">
<h3 id="org9bde2f2">string_empty_p</h3>
<div class="outline-text-3" id="text-org9bde2f2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-empty?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_empty_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(string) == 0
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8bf46f" class="outline-3">
<h3 id="orge8bf46f">string_eq_p</h3>
<div class="outline-text-3" id="text-orge8bf46f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'string-eq?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">string_eq_p</span>(string1, string2):
    <span style="color: #f92672; font-weight: bold;">return</span> string1 == string2
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4678ab" class="outline-2">
<h2 id="orgc4678ab"><b>vect</b></h2>
<div class="outline-text-2" id="text-orgc4678ab">
</div><div id="outline-container-orged56ad0" class="outline-3">
<h3 id="orged56ad0"><span class="todo _note_">[note]</span> </h3>
<div class="outline-text-3" id="text-orged56ad0">
<ul class="org-ul">
<li><p>vect is the pivot among :</p><p><ul class="org-ul"></p><p><li><p>list</p></li></p><p><li><p>dict</p></li></p><p><li><p>tuple</p></li></p><p><li><p>set</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-org2de15d0" class="outline-3">
<h3 id="org2de15d0">vect_p</h3>
<div class="outline-text-3" id="text-org2de15d0">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'vect?'</span>)(vect_p)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c9ef7e" class="outline-3">
<h3 id="org7c9ef7e">vect_copy</h3>
<div class="outline-text-3" id="text-org7c9ef7e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-copy'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_copy</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> vect[:]
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d8f2e5" class="outline-3">
<h3 id="org9d8f2e5">vect_member_p</h3>
<div class="outline-text-3" id="text-org9d8f2e5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-member?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_member_p</span>(x, vect):
    <span style="color: #f92672; font-weight: bold;">return</span> x <span style="color: #f92672; font-weight: bold;">in</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2f8aa9" class="outline-3">
<h3 id="orgb2f8aa9">vect_to_sexp</h3>
<div class="outline-text-3" id="text-orgb2f8aa9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;sexp'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_sexp</span>(vect):
    <span style="color: #f92672; font-weight: bold;">if</span> vect == []:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">elif</span> <span style="color: #f92672; font-weight: bold;">not</span> vect_p(vect):
        <span style="color: #f92672; font-weight: bold;">return</span> vect
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(vect_to_sexp(vect[0]),
                    vect_to_sexp(vect[1:]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org684c92a" class="outline-3">
<h3 id="org684c92a">vect_length</h3>
<div class="outline-text-3" id="text-org684c92a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_length</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b1c78c" class="outline-3">
<h3 id="org3b1c78c">vect_ref</h3>
<div class="outline-text-3" id="text-org3b1c78c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_ref</span>(vect, index):
    <span style="color: #f92672; font-weight: bold;">return</span> vect[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org8371cc2" class="outline-3">
<h3 id="org8371cc2">vect_append &#x2013; no-side-effect</h3>
<div class="outline-text-3" id="text-org8371cc2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_append</span>(vect1, vect2):
    <span style="color: #fd971f;">vect1_copy</span> = vect_copy(vect1)
    vect1_copy.extend(vect2)
    <span style="color: #f92672; font-weight: bold;">return</span> vect1_copy
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6f84aa3" class="outline-2">
<h2 id="org6f84aa3"><b>list</b></h2>
<div class="outline-text-2" id="text-org6f84aa3">
</div><div id="outline-container-orgcd86f79" class="outline-3">
<h3 id="orgcd86f79">Null &amp; Cons</h3>
<div class="outline-text-3" id="text-orgcd86f79">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'&lt;null&gt;'</span>)(Null)
prim(<span style="color: #e6db74;">'&lt;cons&gt;'</span>)(Cons)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d15958" class="outline-3">
<h3 id="org1d15958">list_p</h3>
<div class="outline-text-3" id="text-org1d15958">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> null_p(x) <span style="color: #f92672; font-weight: bold;">or</span> cons_p(x)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f0786f" class="outline-3">
<h3 id="org5f0786f">vect_to_list</h3>
<div class="outline-text-3" id="text-org5f0786f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;list'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_list</span>(vect):
    <span style="color: #f92672; font-weight: bold;">if</span> vect == []:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(vect[0], vect_to_list(vect[1:]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org81efbb4" class="outline-3">
<h3 id="org81efbb4">list_to_vect</h3>
<div class="outline-text-3" id="text-org81efbb4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'list-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_to_vect</span>(l):
    <span style="color: #fd971f;">vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(l):
        vect.append(car(l))
        <span style="color: #fd971f;">l</span> = cdr(l)
    <span style="color: #f92672; font-weight: bold;">return</span> vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org309492f" class="outline-3">
<h3 id="org309492f">list_length</h3>
<div class="outline-text-3" id="text-org309492f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_length</span>(l):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
        <span style="color: #f92672; font-weight: bold;">return</span> 0
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> list_length(cdr(l)) + 1
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb85ec" class="outline-3">
<h3 id="orgcb85ec">list_ref</h3>
<div class="outline-text-3" id="text-orgcb85ec">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_ref</span>(l, i):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(l):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- list_ref fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  index greater then length of list"</span>)
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
    <span style="color: #f92672; font-weight: bold;">elif</span> i == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> car(l)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> list_ref(cdr(l), i-1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf48252b" class="outline-3">
<h3 id="orgf48252b">list_append</h3>
<div class="outline-text-3" id="text-orgf48252b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">list_append</span>(ante, succ):
    <span style="color: #f92672; font-weight: bold;">if</span> null_p(ante):
        <span style="color: #f92672; font-weight: bold;">return</span> succ
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> cons(car(ante),
                    list_append(cdr (ante), succ))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5aeaa42" class="outline-3">
<h3 id="org5aeaa42">tail_cons</h3>
<div class="outline-text-3" id="text-org5aeaa42">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tail_cons</span>(ante, value):
    <span style="color: #f92672; font-weight: bold;">return</span> list_append(ante, cons(value, null))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7870683" class="outline-2">
<h2 id="org7870683"><b>dict</b></h2>
<div class="outline-text-2" id="text-org7870683">
</div><div id="outline-container-org82b158c" class="outline-3">
<h3 id="org82b158c">Dict</h3>
<div class="outline-text-3" id="text-org82b158c">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Dict'</span>)(<span style="color: #a6e22e;">dict</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org88711cb" class="outline-3">
<h3 id="org88711cb">dict_p</h3>
<div class="outline-text-3" id="text-org88711cb">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">dict</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff272ac" class="outline-3">
<h3 id="orgff272ac">dict_copy</h3>
<div class="outline-text-3" id="text-orgff272ac">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-copy'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_copy</span>(d):
    <span style="color: #f92672; font-weight: bold;">return</span> d.copy()
</pre>
</div>
</div>
</div>

<div id="outline-container-org1af914d" class="outline-3">
<h3 id="org1af914d">vect_to_dict</h3>
<div class="outline-text-3" id="text-org1af914d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_dict</span>(vect):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(vect)
    <span style="color: #f92672; font-weight: bold;">if</span> length % 2 != 0:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- vect-&gt;dict fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  length of vect must be even"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  length : {}"</span>.<span style="color: #a6e22e;">format</span>(length))
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  vect : {}"</span>.<span style="color: #a6e22e;">format</span>(vect))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">d</span> = {}
    <span style="color: #fd971f;">i</span> = 0
    <span style="color: #f92672; font-weight: bold;">while</span> i &lt; length:
        <span style="color: #fd971f;">k</span> = vect[i]
        <span style="color: #fd971f;">v</span> = vect[i+1]
        <span style="color: #fd971f;">d</span>[k] = v
        <span style="color: #fd971f;">i</span> = i + 2

    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>

<div id="outline-container-org94afea9" class="outline-3">
<h3 id="org94afea9">dict_length</h3>
<div class="outline-text-3" id="text-org94afea9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_length</span>(d):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(d)
</pre>
</div>
</div>
</div>

<div id="outline-container-org53e660d" class="outline-3">
<h3 id="org53e660d">dict_find</h3>
<div class="outline-text-3" id="text-org53e660d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-find'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_find</span>(d, k):
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> VALUES(d[k], <span style="color: #ae81ff;">True</span>)
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyError</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a0a507" class="outline-3">
<h3 id="org9a0a507">dict_update &#x2013; no-side-effect</h3>
<div class="outline-text-3" id="text-org9a0a507">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-update'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_update</span>(d1, d2):
    <span style="color: #fd971f;">d1</span> = dict_copy(d1)
    <span style="color: #f92672; font-weight: bold;">return</span> d1.update(d2)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge59a89c" class="outline-3">
<h3 id="orge59a89c">dict_delete &#x2013; no-side-effect</h3>
<div class="outline-text-3" id="text-orge59a89c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'dict-delete'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">dict_delete</span>(d, k):
    <span style="color: #fd971f;">d</span> = dict_copy(d)
    <span style="color: #f92672; font-weight: bold;">del</span> d[k]
    <span style="color: #f92672; font-weight: bold;">return</span> d
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd8debd2" class="outline-2">
<h2 id="orgd8debd2"><b>tuple</b></h2>
<div class="outline-text-2" id="text-orgd8debd2">
</div><div id="outline-container-org63232b8" class="outline-3">
<h3 id="org63232b8">Tuple</h3>
<div class="outline-text-3" id="text-org63232b8">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Tuple'</span>)(<span style="color: #a6e22e;">tuple</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc2baca" class="outline-3">
<h3 id="orgcc2baca">tuple_p</h3>
<div class="outline-text-3" id="text-orgcc2baca">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">tuple</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga01aa74" class="outline-3">
<h3 id="orga01aa74">vect_to_tuple</h3>
<div class="outline-text-3" id="text-orga01aa74">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;tuple'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_tuple</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb9d89d9" class="outline-3">
<h3 id="orgb9d89d9">tuple_to_vect</h3>
<div class="outline-text-3" id="text-orgb9d89d9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_to_vect</span>(tu):
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(tu)
</pre>
</div>
</div>
</div>

<div id="outline-container-org90f8373" class="outline-3">
<h3 id="org90f8373">tuple_length</h3>
<div class="outline-text-3" id="text-org90f8373">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_length</span>(tu):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(tu)
</pre>
</div>
</div>
</div>

<div id="outline-container-org12eb5f0" class="outline-3">
<h3 id="org12eb5f0">tuple_ref</h3>
<div class="outline-text-3" id="text-org12eb5f0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-ref'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_ref</span>(tu, index):
    <span style="color: #f92672; font-weight: bold;">return</span> tu[index]
</pre>
</div>
</div>
</div>

<div id="outline-container-org879d6" class="outline-3">
<h3 id="org879d6">tuple_append</h3>
<div class="outline-text-3" id="text-org879d6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'tuple-append'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">tuple_append</span>(tu1, tu2):
    <span style="color: #fd971f;">vect1</span> = Vect(tu1)
    vect1.extend(tu2)
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">tuple</span>(vect1)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgea24f96" class="outline-2">
<h2 id="orgea24f96"><b>set</b></h2>
<div class="outline-text-2" id="text-orgea24f96">
</div><div id="outline-container-org65b1180" class="outline-3">
<h3 id="org65b1180">Set</h3>
<div class="outline-text-3" id="text-org65b1180">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'Set'</span>)(<span style="color: #a6e22e;">set</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org48a0766" class="outline-3">
<h3 id="org48a0766">set_p</h3>
<div class="outline-text-3" id="text-org48a0766">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_p</span>(x):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">type</span>(x) == <span style="color: #a6e22e;">set</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5a9112" class="outline-3">
<h3 id="orgd5a9112">vect_to_set</h3>
<div class="outline-text-3" id="text-orgd5a9112">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'vect-&gt;set'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">vect_to_set</span>(vect):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">set</span>(vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org734c14d" class="outline-3">
<h3 id="org734c14d">set_to_vect</h3>
<div class="outline-text-3" id="text-org734c14d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-&gt;vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_to_vect</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c6d6ce" class="outline-3">
<h3 id="org3c6d6ce">set_length</h3>
<div class="outline-text-3" id="text-org3c6d6ce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-length'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_length</span>(s):
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #a6e22e;">len</span>(s)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga35f272" class="outline-3">
<h3 id="orga35f272">set_member_p</h3>
<div class="outline-text-3" id="text-orga35f272">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-member?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_member_p</span>(x, s):
    <span style="color: #f92672; font-weight: bold;">return</span> x <span style="color: #f92672; font-weight: bold;">in</span> s
</pre>
</div>
</div>
</div>

<div id="outline-container-org58d3230" class="outline-3">
<h3 id="org58d3230">high school</h3>
<div class="outline-text-3" id="text-org58d3230">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-disjoint?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_disjoint_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.isdisjoint(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-subset?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_subset_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.issubset(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-superset?'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_superset_p</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.issuperset(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-union'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_union</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.union(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-intersection'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_intersection</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.intersection(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-difference'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_difference</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.difference(s2)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'set-symmetric-difference'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">set_symmetric_difference</span>(s1, s2):
    <span style="color: #f92672; font-weight: bold;">return</span> s1.symmetric_difference(s2)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2dd83bb" class="outline-2">
<h2 id="org2dd83bb"><b>io</b></h2>
<div class="outline-text-2" id="text-org2dd83bb">
</div><div id="outline-container-orgb17b428" class="outline-3">
<h3 id="orgb17b428">print</h3>
<div class="outline-text-3" id="text-orgb17b428">
<div class="org-src-container">

<pre class="src src-python">prim(<span style="color: #e6db74;">'print'</span>)(p_print)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ba287b" class="outline-3">
<h3 id="org6ba287b">nl &#x2013; newline</h3>
<div class="outline-text-3" id="text-org6ba287b">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'newline'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">newline</span>():
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">""</span>)

prim(<span style="color: #e6db74;">'nl'</span>)(newline)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf201e52" class="outline-3">
<h3 id="orgf201e52">space</h3>
<div class="outline-text-3" id="text-orgf201e52">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'space'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">space</span>():
    p_print(<span style="color: #e6db74;">" "</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3975930" class="outline-2">
<h2 id="org3975930"><b>sys</b></h2>
<div class="outline-text-2" id="text-org3975930">
</div><div id="outline-container-org79890e4" class="outline-3">
<h3 id="org79890e4">bye</h3>
<div class="outline-text-3" id="text-org79890e4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'bye'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">bye</span>():
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"bye bye ^-^/"</span>)
    sys.<span style="color: #ae81ff;">exit</span>()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7adf661" class="outline-2">
<h2 id="org7adf661">------</h2>
</div>
<div id="outline-container-org5743861" class="outline-2">
<h2 id="org5743861">keyword_dict</h2>
<div class="outline-text-2" id="text-org5743861">
</div><div id="outline-container-orgc0af0d9" class="outline-3">
<h3 id="orgc0af0d9"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-orgc0af0d9">
<ul class="org-ul">
<li><p>keyword : (-&gt; module, body &#x2013; jo vect)</p></li></ul>
</div>
</div>

<div id="outline-container-orgc36a908" class="outline-3">
<h3 id="orgc36a908">keyword_dict</h3>
<div class="outline-text-3" id="text-orgc36a908">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">keyword_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b57aec" class="outline-3">
<h3 id="org6b57aec">@keyword</h3>
<div class="outline-text-3" id="text-org6b57aec">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">keyword</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">keyword_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4153a5" class="outline-3">
<h3 id="orge4153a5">(note)</h3>
<div class="outline-text-3" id="text-orge4153a5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"note"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_note</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd2a520" class="outline-3">
<h3 id="orgbd2a520">(begin)</h3>
<div class="outline-text-3" id="text-orgbd2a520">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'begin'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_begin</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> sexp_list_emit(module, body)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2a3b58" class="outline-3">
<h3 id="orgb2a3b58">(clo)</h3>
<div class="outline-text-3" id="text-orgb2a3b58">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'clo'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_clo</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">return</span> [CLO(sexp_list_emit(module, body))]
</pre>
</div>
</div>
</div>

<div id="outline-container-org46e019e" class="outline-3">
<h3 id="org46e019e">(if)</h3>
<div class="outline-text-3" id="text-org46e019e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'if'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_if</span>(module, body):
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, body)
    jo_vect.append(IFTE)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org1de4500" class="outline-3">
<h3 id="org1de4500">(quote)</h3>
<div class="outline-text-3" id="text-org1de4500">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'quote'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_quote</span>(module, body):
    <span style="color: #fd971f;">jo_vect</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org52c8f1" class="outline-3">
<h3 id="org52c8f1">(partquote)</h3>
<div class="outline-text-3" id="text-org52c8f1">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'partquote'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_partquote</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        jo_vect.extend(k_partquote_one(module, sexp))
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_partquote_one</span>(module, sexp):
    <span style="color: #f92672; font-weight: bold;">if</span> cons_p(sexp):
        <span style="color: #f92672; font-weight: bold;">if</span> car(sexp) == <span style="color: #e6db74;">'@'</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> sexp_list_emit(module, cdr(sexp))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">jo_vect</span> = []
            jo_vect.extend([MARK])
            jo_vect.extend(k_partquote(module, sexp))
            jo_vect.extend([COLLECT_LIST])
            <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> [sexp]
</pre>
</div>
</div>
</div>

<div id="outline-container-org45818a0" class="outline-3">
<h3 id="org45818a0">(-&gt;)</h3>
<div class="outline-text-3" id="text-org45818a0">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'-&gt;'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_arrow</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #f92672; font-weight: bold;">not</span> null_p(sexp_list):
        <span style="color: #fd971f;">sexp</span> = car(sexp_list)
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> local_string_p(sexp):
            jo_vect.append(SET(sexp))
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #fd971f;">sexp_list</span> = cdr(sexp_list)
    jo_vect.reverse()
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb757e4" class="outline-3">
<h3 id="orgb757e4">(list)</h3>
<div class="outline-text-3" id="text-orgb757e4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'list'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_list</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_LIST])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc7e23f2" class="outline-3">
<h3 id="orgc7e23f2">(vect)</h3>
<div class="outline-text-3" id="text-orgc7e23f2">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'vect'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_vect</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org9ac61d5" class="outline-3">
<h3 id="org9ac61d5">(dict)</h3>
<div class="outline-text-3" id="text-org9ac61d5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'dict'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_dict</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_dict])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org418e963" class="outline-3">
<h3 id="org418e963">(tuple)</h3>
<div class="outline-text-3" id="text-org418e963">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'tuple'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_tuple</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_tuple])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect

keyword(<span style="color: #e6db74;">'*'</span>)(k_tuple)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3fb7b9" class="outline-3">
<h3 id="orgd3fb7b9">(set)</h3>
<div class="outline-text-3" id="text-orgd3fb7b9">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">'set'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_set</span>(module, sexp_list):
    <span style="color: #fd971f;">jo_vect</span> = []
    jo_vect.extend([MARK])
    jo_vect.extend(sexp_list_emit(module, sexp_list))
    jo_vect.extend([COLLECT_VECT, vect_to_set])
    <span style="color: #f92672; font-weight: bold;">return</span> jo_vect
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1cbca41" class="outline-2">
<h2 id="org1cbca41">top_level_keywordm</h2>
<div class="outline-text-2" id="text-org1cbca41">
</div><div id="outline-container-orgf7c08b3" class="outline-3">
<h3 id="orgf7c08b3">(import)</h3>
<div class="outline-text-3" id="text-orgf7c08b3">
</div><div id="outline-container-org19d8ea6" class="outline-4">
<h4 id="org19d8ea6">k_import</h4>
<div class="outline-text-4" id="text-org19d8ea6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"import"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import</span>(module, body):
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(body)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        k_import_as(module, body)
        <span style="color: #f92672; font-weight: bold;">return</span> []

    <span style="color: #f92672; font-weight: bold;">if</span> null_p(body):
        <span style="color: #f92672; font-weight: bold;">return</span> []

    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'.'</span> <span style="color: #f92672; font-weight: bold;">in</span> name:
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (import) syntax error"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  module name can not contain '.'"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  module name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
            p_print (<span style="color: #e6db74;">"  import body : "</span>)
            sexp_list_print(body)
            newline()
            <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        k_import_one(module, name)

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff515c5" class="outline-4">
<h4 id="orgff515c5">k_import_one</h4>
<div class="outline-text-4" id="text-orgff515c5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import_one</span>(module, name):
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(name)
    jojo_define(module, name, imported_module)
</pre>
</div>
</div>
</div>

<div id="outline-container-org10cbce" class="outline-4">
<h4 id="org10cbce">k_import_as</h4>
<div class="outline-text-4" id="text-org10cbce">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_import_as</span>(module, body):
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> (<span style="color: #a6e22e;">len</span>(name_vect) != 3 <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[0] == <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[1] != <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">or</span>
        name_vect[2] == <span style="color: #e6db74;">'as'</span>):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (import) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  syntax for (import as) should be :"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  (import &lt;module-name&gt; as &lt;name&gt;)"</span>)
        p_print (<span style="color: #e6db74;">"  import body : "</span>)
        sexp_list_print(body)
        newline()
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
    <span style="color: #fd971f;">name</span> = name_vect[0]
    <span style="color: #fd971f;">as_name</span> = name_vect[2]
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(name)
    jojo_define(module, as_name, imported_module)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf4899fb" class="outline-3">
<h3 id="orgf4899fb">(from)</h3>
<div class="outline-text-3" id="text-orgf4899fb">
</div><div id="outline-container-org8ea3a54" class="outline-4">
<h4 id="org8ea3a54">k_from</h4>
<div class="outline-text-4" id="text-org8ea3a54">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"from"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from</span>(module, body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #e6db74;">'as'</span> <span style="color: #f92672; font-weight: bold;">in</span> vect_body:
        k_from_as(module, body)
        <span style="color: #f92672; font-weight: bold;">return</span> []

    k_from_syntax_check(body)
    <span style="color: #fd971f;">module_name</span> = car(body)
    <span style="color: #fd971f;">name_vect</span> = list_to_vect(cdr(cdr(body)))
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(module_name)
    <span style="color: #f92672; font-weight: bold;">for</span> name <span style="color: #f92672; font-weight: bold;">in</span> name_vect:
        jojo_define(module, name, <span style="color: #a6e22e;">getattr</span>(imported_module, name))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org99dbcd5" class="outline-4">
<h4 id="org99dbcd5">k_from_syntax_check</h4>
<div class="outline-text-4" id="text-org99dbcd5">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_syntax_check</span>(body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vect_body) &gt; 2:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[1] == <span style="color: #e6db74;">'import'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (from) syntax error"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  syntax for (from import) should be :"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  (from &lt;module-name&gt; import &lt;name&gt; ...)"</span>)
    p_print (<span style="color: #e6db74;">"  import body : "</span>)
    sexp_list_print(body)
    newline()
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef57d30" class="outline-4">
<h4 id="orgef57d30">k_from_as</h4>
<div class="outline-text-4" id="text-orgef57d30">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_as</span>(module, body):
    k_from_as_syntax_check(body)
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #fd971f;">module_name</span> = vect_body[0]
    <span style="color: #fd971f;">name</span> = vect_body[2]
    <span style="color: #fd971f;">as_name</span> = vect_body[4]
    <span style="color: #fd971f;">imported_module</span> = importlib.import_module(module_name)
    jojo_define(module, as_name, <span style="color: #a6e22e;">getattr</span>(imported_module, name))
</pre>
</div>
</div>
</div>

<div id="outline-container-org600f12e" class="outline-4">
<h4 id="org600f12e">k_from_as_syntax_check</h4>
<div class="outline-text-4" id="text-org600f12e">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_from_as_syntax_check</span>(body):
    <span style="color: #fd971f;">vect_body</span> = list_to_vect(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(vect_body) == 5:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[1] == <span style="color: #e6db74;">'import'</span>:
        <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">if</span> vect_body[3] == <span style="color: #e6db74;">'as'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (from) syntax error"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  syntax for (from import as) should be :"</span>)
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  (from &lt;module-name&gt; import &lt;name&gt; as &lt;name&gt;)"</span>)
    p_print (<span style="color: #e6db74;">"  import body : "</span>)
    sexp_list_print(body)
    newline()
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org78637af" class="outline-3">
<h3 id="org78637af">(+jojo)</h3>
<div class="outline-text-3" id="text-org78637af">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+jojo"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_jojo</span>(module, body):
    <span style="color: #f92672; font-weight: bold;">if</span> list_length(body) == 0:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (+jojo) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  body of (+jojo) can not be empty"</span>)
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">jojo_name</span> = car(body)
    <span style="color: #a6e22e;">setattr</span>(module, jojo_name,
            JOJO(sexp_list_emit(module, cdr(body))))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf3ecddc" class="outline-3">
<h3 id="orgf3ecddc">(+data)</h3>
<div class="outline-text-3" id="text-orgf3ecddc">
</div><div id="outline-container-org490a794" class="outline-4">
<h4 id="org490a794">plus_data</h4>
<div class="outline-text-4" id="text-org490a794">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+data"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_data</span>(module, body):
    <span style="color: #fd971f;">data_name</span> = car(body)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> data_name_string_p(data_name):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (+data) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  data_name must be of form &lt;...&gt;"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  data_name : {}"</span>.<span style="color: #a6e22e;">format</span>(data_name))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">field_name_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> string <span style="color: #f92672; font-weight: bold;">in</span> list_to_vect(cdr(body)):
        <span style="color: #f92672; font-weight: bold;">if</span> message_string_p(string):
            <span style="color: #fd971f;">string</span> = string[1:]
            field_name_vect.append(string)

    <span style="color: #fd971f;">data_class</span> = create_data_class(data_name, field_name_vect)
    <span style="color: #fd971f;">data_class.__module__</span> = module

    jojo_define(module, data_name, data_class)

    <span style="color: #fd971f;">constructor_name</span> = data_name[1:-1]
    jojo_define(module, constructor_name, JOJO([data_class, NEW]))

    <span style="color: #fd971f;">predicate_name</span> = <span style="color: #e6db74;">""</span>.join([constructor_name, <span style="color: #e6db74;">"?"</span>])
    jojo_define(module, predicate_name, DATA_PRED(data_class))

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbc8515" class="outline-4">
<h4 id="orgcbc8515">data_name_string_p</h4>
<div class="outline-text-4" id="text-orgcbc8515">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">data_name_string_p</span>(string):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(string) &lt; 3: <span style="color: #FF8888;"># </span><span style="color: #FF8888;">example : '&lt;n&gt;'</span>
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[0] != <span style="color: #e6db74;">'&lt;'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string[-1] != <span style="color: #e6db74;">'&gt;'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'&lt;'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'&gt;'</span>) != 1:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">'.'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">elif</span> string.count(<span style="color: #e6db74;">':'</span>) != 0:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">False</span>
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #ae81ff;">True</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org32f0e2d" class="outline-4">
<h4 id="org32f0e2d">JOJO_DATA</h4>
<div class="outline-text-4" id="text-org32f0e2d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">JOJO_DATA</span>:
    <span style="color: #f92672; font-weight: bold;">pass</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5eff2b6" class="outline-4">
<h4 id="org5eff2b6">create_data_class</h4>
<div class="outline-text-4" id="text-org5eff2b6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">create_data_class</span>(data_name, field_name_vect):
    <span style="color: #fd971f;">rev</span> = vect_copy(field_name_vect)
    rev.reverse()
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">init</span>(<span style="color: #f92672; font-weight: bold;">self</span>, kwargs):
        <span style="color: #f92672; font-weight: bold;">self</span>.__dict__.update(kwargs)
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">update_ns</span>(ns):
        ns.update({
            <span style="color: #e6db74;">'__init__'</span> : init,
            <span style="color: #e6db74;">'field_name_vect'</span>: field_name_vect,
            <span style="color: #e6db74;">'reversed_field_name_vect'</span>: rev,
        })
    <span style="color: #f92672; font-weight: bold;">return</span> types.new_class(
        data_name,
        bases = (JOJO_DATA, ),
        kwds = <span style="color: #ae81ff;">None</span>,
        exec_body = update_ns)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5aeab3c" class="outline-3">
<h3 id="org5aeab3c">(+union)</h3>
<div class="outline-text-3" id="text-org5aeab3c">
</div><div id="outline-container-org91b9311" class="outline-4">
<h4 id="org91b9311">plus_union</h4>
<div class="outline-text-4" id="text-org91b9311">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+union"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_union</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, rest)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    jojo_define(module, name, UNION(jojo))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd312a3d" class="outline-4">
<h4 id="orgd312a3d">UNION</h4>
<div class="outline-text-4" id="text-orgd312a3d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">class</span> <span style="color: #66d9ef; font-weight: bold;">UNION</span>:
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">__init__</span>(<span style="color: #f92672; font-weight: bold;">self</span>, jojo):
        <span style="color: #f92672; font-weight: bold;">self</span>.jojo = jojo

    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">get_type_vect</span>(<span style="color: #f92672; font-weight: bold;">self</span>):
        <span style="color: #fd971f;">vm</span> = VM([], [RP(<span style="color: #f92672; font-weight: bold;">self</span>.jojo)])
        vm.exe()
        <span style="color: #f92672; font-weight: bold;">return</span> vm.ds
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8138b08" class="outline-3">
<h3 id="org8138b08"><span class="todo _note_">[note]</span> gene and disp</h3>
<div class="outline-text-3" id="text-org8138b08">
<ul class="org-ul">
<li><p>a gene in a module maintains a dict</p><p>form tuple of type to disp</p></li>

<li><p><p></p><p>suppose</p><p></p></p><p></p><p><p></p><p>in module m1 we have (+gene g1 &#x2026;)</p><p></p></p><p></p><p><p></p><p>in module m2 we (import m1) and</p><p>(+disp m1.g1 &#x2026;) for data in m2</p><p></p></p><p></p><p><p></p><p>this means the the global state g1 of module m1</p><p>can be changed by module m2</p><p></p></p></li>

<li><p>in such a hopelessly dynamic language,</p><p>this is the only place we make use of the dynamic type.</p></li></ul>
</div>
</div>

<div id="outline-container-orgf46fe02" class="outline-3">
<h3 id="orgf46fe02">(+gene)</h3>
<div class="outline-text-3" id="text-orgf46fe02">
</div><div id="outline-container-org26718f8" class="outline-4">
<h4 id="org26718f8">plus_gene</h4>
<div class="outline-text-4" id="text-org26718f8">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+gene"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_gene</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">arrow</span> = car(rest)
    <span style="color: #fd971f;">arity</span> = arrow_get_arity(arrow)
    <span style="color: #f92672; font-weight: bold;">if</span> arity == 0:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (+gene) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  arity of arrow is zero"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  gene dispatches on types of arguments"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  can not define gene over nothing"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        p_print (<span style="color: #e6db74;">"  arrow : "</span>)
        sexp_print(arrow)
        newline()
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">default_jojo</span> = JOJO(sexp_list_emit(module, rest))
    jojo_define(module, name, GENE(arity, default_jojo))
    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c7f6d" class="outline-4">
<h4 id="org7c7f6d">arrow_get_arity</h4>
<div class="outline-text-4" id="text-org7c7f6d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_arity</span>(arrow):
    <span style="color: #fd971f;">arity</span> = 0
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(cdr(arrow))
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> local_string_p(sexp):
            <span style="color: #fd971f;">arity</span> = arity + 1
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">pass</span>

    <span style="color: #f92672; font-weight: bold;">return</span> arity
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge0e158c" class="outline-3">
<h3 id="orge0e158c">(+disp)</h3>
<div class="outline-text-3" id="text-orge0e158c">
</div><div id="outline-container-org5c20d06" class="outline-4">
<h4 id="org5c20d06">plus_disp</h4>
<div class="outline-text-4" id="text-org5c20d06">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@keyword</span>(<span style="color: #e6db74;">"+disp"</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">plus_disp</span>(module, body):
    <span style="color: #fd971f;">name</span> = car(body)
    <span style="color: #fd971f;">rest</span> = cdr(body)
    <span style="color: #fd971f;">arrow</span> = car(rest)
    <span style="color: #fd971f;">type_tuple_vect</span> = arrow_get_type_tuple_vect(module, arrow)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> <span style="color: #a6e22e;">hasattr</span>(module, name):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (+disp) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  name is undefined"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">gene</span> = <span style="color: #a6e22e;">getattr</span>(module, name)
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(gene) != GENE:
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (+disp) syntax error"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  type of name must be a gene"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  type of name : {}"</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">type</span>(name)))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #fd971f;">jojo</span> = JOJO(sexp_list_emit(module, rest))
    <span style="color: #f92672; font-weight: bold;">for</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> type_tuple_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> type_tuple <span style="color: #f92672; font-weight: bold;">in</span> gene.disp_dict:
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- (+disp) fail"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  type_tuple for gene is already defined"</span>)
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  type_tuple : {}"</span>.<span style="color: #a6e22e;">format</span>(type_tuple))
            <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  gene name : {}"</span>.<span style="color: #a6e22e;">format</span>(name))
            p_print (<span style="color: #e6db74;">"  arrow : "</span>)
            sexp_print(arrow)
            newline()
            <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">gene.disp_dict</span>[type_tuple] = jojo

    <span style="color: #f92672; font-weight: bold;">return</span> []
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1382fc" class="outline-4">
<h4 id="orgb1382fc">arrow_get_type_vect</h4>
<div class="outline-text-4" id="text-orgb1382fc">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_type_vect</span>(module, arrow):
    <span style="color: #fd971f;">sexp_vect</span> = list_to_vect(cdr(arrow))
    <span style="color: #fd971f;">new_sexp_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> sexp <span style="color: #f92672; font-weight: bold;">in</span> sexp_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> local_string_p(sexp):
            <span style="color: #f92672; font-weight: bold;">pass</span>
        <span style="color: #f92672; font-weight: bold;">elif</span> sexp == <span style="color: #e6db74;">'--'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            new_sexp_vect.append(sexp)

    <span style="color: #fd971f;">new_sexp_list</span> = vect_to_list(new_sexp_vect)
    <span style="color: #fd971f;">jo_vect</span> = sexp_list_emit(module, new_sexp_list)
    <span style="color: #fd971f;">jojo</span> = JOJO(jo_vect)
    <span style="color: #fd971f;">vm</span> = VM([], [RP(jojo)])
    vm.exe()

    <span style="color: #f92672; font-weight: bold;">return</span> vm.ds
</pre>
</div>
</div>
</div>

<div id="outline-container-org536e4ea" class="outline-4">
<h4 id="org536e4ea">type_vect_to_type_vect_vect</h4>
<div class="outline-text-4" id="text-org536e4ea">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">type_vect_to_type_vect_vect</span>(type_vect):
    <span style="color: #fd971f;">type_vect_vect</span> = []
    <span style="color: #f92672; font-weight: bold;">for</span> t <span style="color: #f92672; font-weight: bold;">in</span> type_vect:
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">type</span>(t) == UNION:
            type_vect_vect.append(t.get_type_vect())
        <span style="color: #f92672; font-weight: bold;">else</span>:
            type_vect_vect.append([t])

    <span style="color: #f92672; font-weight: bold;">return</span> type_vect_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org82e69b7" class="outline-4">
<h4 id="org82e69b7">arrow_get_type_tuple_vect</h4>
<div class="outline-text-4" id="text-org82e69b7">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">arrow_get_type_tuple_vect</span>(module, arrow):
    <span style="color: #fd971f;">type_vect</span> = arrow_get_type_vect(module, arrow)
    <span style="color: #fd971f;">type_vect_vect</span> = type_vect_to_type_vect_vect(type_vect)
    <span style="color: #f92672; font-weight: bold;">return</span> Vect(itertools.product(*type_vect_vect))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb870cbf" class="outline-2">
<h2 id="orgb870cbf">key_jo_dict</h2>
<div class="outline-text-2" id="text-orgb870cbf">
</div><div id="outline-container-org51c1cd8" class="outline-3">
<h3 id="org51c1cd8"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-org51c1cd8">
<ul class="org-ul">
<li><p>keyword : (-&gt; module &#x2013; jo vect)</p></li></ul>
</div>
</div>

<div id="outline-container-org123ff08" class="outline-3">
<h3 id="org123ff08">key_jo_dict</h3>
<div class="outline-text-3" id="text-org123ff08">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">key_jo_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1d5d79" class="outline-3">
<h3 id="orge1d5d79">key_jo</h3>
<div class="outline-text-3" id="text-orge1d5d79">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">key_jo</span>(name, jo_vect):
    <span style="color: #fd971f;">key_jo_dict</span>[name] = jo_vect
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c50a61" class="outline-3">
<h3 id="org2c50a61">key_jo s</h3>
<div class="outline-text-3" id="text-org2c50a61">
<div class="org-src-container">

<pre class="src src-python">key_jo(<span style="color: #e6db74;">'apply'</span>, [APPLY])
key_jo(<span style="color: #e6db74;">'ifte'</span>, [IFTE])
key_jo(<span style="color: #e6db74;">'new'</span>, [NEW])
key_jo(<span style="color: #e6db74;">','</span>, [])

key_jo(<span style="color: #e6db74;">'mark'</span>, [MARK])
key_jo(<span style="color: #e6db74;">'collect-vect'</span>, [COLLECT_VECT])
key_jo(<span style="color: #e6db74;">'vect-spread'</span>, [VECT_SPREAD])
key_jo(<span style="color: #e6db74;">'collect-list'</span>, [COLLECT_LIST])
key_jo(<span style="color: #e6db74;">'list-spread'</span>, [LIST_SPREAD])
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org172c00" class="outline-2">
<h2 id="org172c00">macro_dict</h2>
<div class="outline-text-2" id="text-org172c00">
</div><div id="outline-container-orgc5cc2e7" class="outline-3">
<h3 id="orgc5cc2e7"><span class="todo _note_">[note]</span> type</h3>
<div class="outline-text-3" id="text-orgc5cc2e7">
<ul class="org-ul">
<li><p>macro : (-&gt; body &#x2013; sexp)</p><p>where body is sexp_list</p></li></ul>
</div>
</div>

<div id="outline-container-org5dc5529" class="outline-3">
<h3 id="org5dc5529">macro_dict</h3>
<div class="outline-text-3" id="text-org5dc5529">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">macro_dict</span> = {}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c27c19" class="outline-3">
<h3 id="org1c27c19">@macro</h3>
<div class="outline-text-3" id="text-org1c27c19">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">macro</span>(name):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">decorator</span>(fun):
        <span style="color: #fd971f;">macro_dict</span>[name] = fun
        <span style="color: #f92672; font-weight: bold;">return</span> fun
    <span style="color: #f92672; font-weight: bold;">return</span> decorator
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb945bc4" class="outline-3">
<h3 id="orgb945bc4">(cond)</h3>
<div class="outline-text-3" id="text-orgb945bc4">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #66d9ef; font-weight: bold;">@macro</span>(<span style="color: #e6db74;">'cond'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">k_cond</span>(body):
    <span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">recur</span>(rest):
        <span style="color: #f92672; font-weight: bold;">if</span> list_length(rest) == 2:
            <span style="color: #fd971f;">q</span> = list_ref(rest, 0)
            <span style="color: #fd971f;">a</span> = list_ref(rest, 1)
            <span style="color: #f92672; font-weight: bold;">if</span> q == <span style="color: #e6db74;">'else'</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> a
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
                    [<span style="color: #e6db74;">'begin'</span>,
                     q, [<span style="color: #e6db74;">'clo'</span>, a],
                     [<span style="color: #e6db74;">'clo'</span>,
                      [<span style="color: #e6db74;">'quote'</span>, body],
                      <span style="color: #e6db74;">'report-cond-mismatch'</span>],
                     <span style="color: #e6db74;">'ifte'</span>])
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #fd971f;">q</span> = list_ref(rest, 0)
            <span style="color: #fd971f;">a</span> = list_ref(rest, 1)
            <span style="color: #f92672; font-weight: bold;">return</span> vect_to_sexp(
                [<span style="color: #e6db74;">'begin'</span>,
                 q, [<span style="color: #e6db74;">'clo'</span>, a],
                 [<span style="color: #e6db74;">'clo'</span>, recur(cdr(cdr(rest)))],
                 <span style="color: #e6db74;">'ifte'</span>])
    <span style="color: #f92672; font-weight: bold;">return</span> recur(body)

<span style="color: #66d9ef; font-weight: bold;">@prim</span>(<span style="color: #e6db74;">'report-cond-mismatch'</span>)
<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">report_cond_mismatch</span>(body):
    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- cond mismatch"</span>)
    p_print (<span style="color: #e6db74;">"  body : "</span>)
    sexp_print(body)
    newline()
    <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org97963f2" class="outline-2">
<h2 id="org97963f2">------</h2>
</div>
<div id="outline-container-orgf394ad6" class="outline-2">
<h2 id="orgf394ad6">epilog &#x2013; interface</h2>
<div class="outline-text-2" id="text-orgf394ad6">
</div><div id="outline-container-org138d81a" class="outline-3">
<h3 id="org138d81a">maybe_drop_shebang</h3>
<div class="outline-text-3" id="text-org138d81a">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">maybe_drop_shebang</span>(code):
    <span style="color: #fd971f;">length</span> = <span style="color: #a6e22e;">len</span>(code)
    <span style="color: #f92672; font-weight: bold;">if</span> length &lt; 3:
        <span style="color: #f92672; font-weight: bold;">return</span> code
    <span style="color: #f92672; font-weight: bold;">elif</span> code[0:2] != <span style="color: #e6db74;">'#!'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> code
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">end_of_first_line</span> = code.find(<span style="color: #e6db74;">'\n'</span>)
        <span style="color: #f92672; font-weight: bold;">if</span> end_of_first_line == -1:
            <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">return</span> code[end_of_first_line:]
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d64cfa" class="outline-3">
<h3 id="org1d64cfa">load</h3>
<div class="outline-text-3" id="text-org1d64cfa">
<ul class="org-ul">
<li><p>path is used as module name</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">load</span>(path):
    <span style="color: #fd971f;">path</span> = os.path.abspath(path)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.exists(path):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- load fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path does not exist"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.isfile(path):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- load fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path is not file"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #f92672; font-weight: bold;">with</span> <span style="color: #a6e22e;">open</span>(path, <span style="color: #e6db74;">"r"</span>) <span style="color: #f92672; font-weight: bold;">as</span> f:
        <span style="color: #fd971f;">code</span> = f.read()
        <span style="color: #fd971f;">code</span> = maybe_drop_shebang(code)
        <span style="color: #fd971f;">sexp_vect</span> = parse_sexp_vect(scan_string_vect(code))
        <span style="color: #fd971f;">module</span> = compile_module(path, sexp_vect)

    <span style="color: #fd971f;">module.__file__</span> = path

    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf70dbe" class="outline-3">
<h3 id="orgf70dbe">run</h3>
<div class="outline-text-3" id="text-orgf70dbe">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">run</span>(data_stack, jojo_vect):
    <span style="color: #fd971f;">data_stack</span> = vect_copy(data_stack)
    <span style="color: #f92672; font-weight: bold;">for</span> jojo <span style="color: #f92672; font-weight: bold;">in</span> jojo_vect:
        run_one(data_stack, jojo)
    <span style="color: #f92672; font-weight: bold;">return</span> data_stack

<span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">run_one</span>(data_stack, jojo):
    <span style="color: #fd971f;">vm</span> = VM(data_stack,
            [RP(jojo)])
    vm.exe()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee00fca" class="outline-3">
<h3 id="orgee00fca">core_module</h3>
<div class="outline-text-3" id="text-orgee00fca">
</div><div id="outline-container-org4c11a3f" class="outline-4">
<h4 id="org4c11a3f">load_core</h4>
<div class="outline-text-4" id="text-org4c11a3f">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">load_core</span>(path):
    <span style="color: #fd971f;">path</span> = os.path.abspath(path)

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.exists(path):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- load_core fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path does not exist"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> os.path.isfile(path):
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- load_core fail"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path is not file"</span>)
        <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  path : {}"</span>.<span style="color: #a6e22e;">format</span>(path))
        <span style="color: #f92672; font-weight: bold;">raise</span> JOJO_ERROR()

    <span style="color: #f92672; font-weight: bold;">with</span> <span style="color: #a6e22e;">open</span>(path, <span style="color: #e6db74;">"r"</span>) <span style="color: #f92672; font-weight: bold;">as</span> f:
        <span style="color: #fd971f;">code</span> = f.read()
        <span style="color: #fd971f;">sexp_vect</span> = parse_sexp_vect(scan_string_vect(code))
        <span style="color: #fd971f;">module</span> = compile_core_module(path, sexp_vect)

    <span style="color: #fd971f;">module.__file__</span> = path

    <span style="color: #f92672; font-weight: bold;">return</span> module
</pre>
</div>
</div>
</div>

<div id="outline-container-org463234c" class="outline-4">
<h4 id="org463234c">core_module</h4>
<div class="outline-text-4" id="text-org463234c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #fd971f;">current_module</span> = sys.modules[<span style="color: #a6e22e;">__name__</span>]
<span style="color: #fd971f;">current_module_dir</span> = os.path.dirname(current_module.__file__)
<span style="color: #fd971f;">core_path</span> = <span style="color: #e6db74;">"/"</span>.join([current_module_dir, <span style="color: #e6db74;">"core.jo"</span>])
<span style="color: #fd971f;">core_module</span> = load_core(core_path)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2e9c0e3" class="outline-3">
<h3 id="org2e9c0e3">repl</h3>
<div class="outline-text-3" id="text-org2e9c0e3">
</div><div id="outline-container-org1c55310" class="outline-4">
<h4 id="org1c55310">read_char</h4>
<div class="outline-text-4" id="text-org1c55310">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_char</span>(char_stack):
    <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #a6e22e;">len</span>(char_stack) == 0:
        <span style="color: #f92672; font-weight: bold;">return</span> sys.stdin.read(1)
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> char_stack.pop()
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9f144c" class="outline-4">
<h4 id="orgc9f144c">read_string</h4>
<div class="outline-text-4" id="text-orgc9f144c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_string</span>(char_stack):
    <span style="color: #fd971f;">char_vect</span> = []
    <span style="color: #fd971f;">collecting_bytes_p</span> = <span style="color: #ae81ff;">False</span>

    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
        <span style="color: #fd971f;">char</span> = read_char(char_stack)
        <span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #f92672; font-weight: bold;">not</span> collecting_bytes_p:
            <span style="color: #f92672; font-weight: bold;">if</span> space_p(char):
                <span style="color: #f92672; font-weight: bold;">pass</span>
            <span style="color: #f92672; font-weight: bold;">elif</span> doublequote_p(char):
                <span style="color: #f92672; font-weight: bold;">return</span> read_doublequoted_string(char_stack)
            <span style="color: #f92672; font-weight: bold;">elif</span> delimiter_p(char):
                char_vect.append(char)
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                char_vect.append(char)
                <span style="color: #fd971f;">collecting_bytes_p</span> = <span style="color: #ae81ff;">True</span>

        <span style="color: #f92672; font-weight: bold;">else</span>:
            <span style="color: #f92672; font-weight: bold;">if</span> (doublequote_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
                delimiter_p(char) <span style="color: #f92672; font-weight: bold;">or</span>
                space_p(char)):
                char_stack.append(char)
                <span style="color: #f92672; font-weight: bold;">break</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                char_vect.append(char)

    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join(char_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org12bff7d" class="outline-4">
<h4 id="org12bff7d">read_doublequoted_string</h4>
<div class="outline-text-4" id="text-org12bff7d">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_doublequoted_string</span>(char_stack):
    <span style="color: #fd971f;">char_vect</span> = []
    char_vect.append(<span style="color: #e6db74;">'"'</span>)
    <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
        <span style="color: #fd971f;">char</span> = read_char(char_stack)
        <span style="color: #f92672; font-weight: bold;">if</span> char == <span style="color: #e6db74;">'"'</span>:
            <span style="color: #f92672; font-weight: bold;">break</span>
        <span style="color: #f92672; font-weight: bold;">else</span>:
            char_vect.append(char)
    char_vect.append(<span style="color: #e6db74;">'"'</span>)
    <span style="color: #f92672; font-weight: bold;">return</span> <span style="color: #e6db74;">""</span>.join(char_vect)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ec6349" class="outline-4">
<h4 id="org1ec6349">read_sexp</h4>
<div class="outline-text-4" id="text-org1ec6349">
<ul class="org-ul">
<li><p>with a char_stack,</p><p>read a sexp from stdin.</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_sexp</span>(char_stack):
    <span style="color: #fd971f;">string</span> = read_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> string == <span style="color: #e6db74;">'('</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">')'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> sexp_list
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'['</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">']'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'begin'</span>, sexp_list)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'{'</span>:
        <span style="color: #fd971f;">sexp_list</span> = read_sexp_list_until_ket(char_stack, <span style="color: #e6db74;">'}'</span>)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'clo'</span>, sexp_list)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">'"'</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> read_doublequoted_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"'"</span>:
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'quote'</span>, cons(sexp, null))
    <span style="color: #f92672; font-weight: bold;">elif</span> string == <span style="color: #e6db74;">"`"</span>:
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(<span style="color: #e6db74;">'partquote'</span>, cons(sexp, null))
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #f92672; font-weight: bold;">return</span> string
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdaa8260" class="outline-4">
<h4 id="orgdaa8260">read_sexp_list_until_ket</h4>
<div class="outline-text-4" id="text-orgdaa8260">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">read_sexp_list_until_ket</span>(char_stack, ket):
    <span style="color: #fd971f;">string</span> = read_string(char_stack)
    <span style="color: #f92672; font-weight: bold;">if</span> string == ket:
        <span style="color: #f92672; font-weight: bold;">return</span> null
    <span style="color: #f92672; font-weight: bold;">else</span>:
        <span style="color: #fd971f;">char_vect</span> = Vect(string)
        char_vect.reverse()
        char_stack.extend(char_vect)
        <span style="color: #fd971f;">sexp</span> = read_sexp(char_stack)
        <span style="color: #fd971f;">recur</span> = read_sexp_list_until_ket(char_stack, ket)
        <span style="color: #f92672; font-weight: bold;">return</span> cons(sexp, recur)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde1488c" class="outline-4">
<h4 id="orgde1488c">print_data_stack</h4>
<div class="outline-text-4" id="text-orgde1488c">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">print_data_stack</span>(ds):
    p_print (<span style="color: #e6db74;">"  * {} *  "</span>.<span style="color: #a6e22e;">format</span>(<span style="color: #a6e22e;">len</span>(ds)))
    <span style="color: #f92672; font-weight: bold;">print</span> (ds)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf88bab6" class="outline-4">
<h4 id="orgf88bab6">print_return_stack</h4>
<div class="outline-text-4" id="text-orgf88bab6">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">print_return_stack</span>(rs):
    <span style="color: #f92672; font-weight: bold;">print</span> (rs)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e87414" class="outline-4">
<h4 id="org9e87414">repl</h4>
<div class="outline-text-4" id="text-org9e87414">
<ul class="org-ul">
<li><p>each instance of repl has its own module,</p><p>and a repl_char_stack for reading sexp one by one.</p></li></ul>

<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">repl</span>():
    <span style="color: #fd971f;">module</span> = new_module(<span style="color: #e6db74;">'repl'</span>)
    merge_prim_dict(module)
    merge_module(module, core_module)
    <span style="color: #fd971f;">module.repl_char_stack</span> = []

    print_data_stack(module.vm.ds)
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            <span style="color: #fd971f;">sexp</span> = read_sexp(module.repl_char_stack)
            <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'exit'</span>:
                <span style="color: #f92672; font-weight: bold;">return</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">try</span>:
                    merge_sexp_vect(module, [sexp])
                    print_data_stack(module.vm.ds)
                <span style="color: #f92672; font-weight: bold;">except</span> JOJO_ERROR:
                    <span style="color: #f92672; font-weight: bold;">pass</span>
                <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">SystemExit</span>:
                    sys.<span style="color: #ae81ff;">exit</span>()
                <span style="color: #f92672; font-weight: bold;">except</span>:
                    <span style="color: #fd971f;">error_type</span> = sys.exc_info()[0]
                    <span style="color: #fd971f;">error_name</span> = error_type.<span style="color: #a6e22e;">__name__</span>
                    <span style="color: #fd971f;">error_info</span> = sys.exc_info()[1]
                    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- error : {}"</span>.<span style="color: #a6e22e;">format</span>(error_name))
                    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  info : {}"</span>.<span style="color: #a6e22e;">format</span>(error_info))
                    debug_repl()
                    <span style="color: #f92672; font-weight: bold;">pass</span>

    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyboardInterrupt</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2caa409" class="outline-4">
<h4 id="org2caa409">debug_repl</h4>
<div class="outline-text-4" id="text-org2caa409">
<div class="org-src-container">

<pre class="src src-python"><span style="color: #f92672; font-weight: bold;">def</span> <span style="color: #a6e22e;">debug_repl</span>():
    <span style="color: #fd971f;">module</span> = new_module(<span style="color: #e6db74;">'debug_repl'</span>)
    merge_prim_dict(module)
    merge_module(module, core_module)
    <span style="color: #fd971f;">module.repl_char_stack</span> = []

    print_data_stack(module.vm.ds)
    print_return_stack(module.vm.rs)
    <span style="color: #f92672; font-weight: bold;">try</span>:
        <span style="color: #f92672; font-weight: bold;">while</span> <span style="color: #ae81ff;">True</span>:
            p_print(<span style="color: #e6db74;">"debug&gt; "</span>)
            sys.stdout.flush()
            <span style="color: #fd971f;">sexp</span> = read_sexp(module.repl_char_stack)
            <span style="color: #f92672; font-weight: bold;">if</span> sexp == <span style="color: #e6db74;">'abort'</span>:
                <span style="color: #fd971f;">module.vm.ds</span> = []
                <span style="color: #fd971f;">module.vm.rs</span> = []
                <span style="color: #FF8888;"># </span><span style="color: #FF8888;">clear pytron stack</span>
                <span style="color: #f92672; font-weight: bold;">return</span>
            <span style="color: #f92672; font-weight: bold;">else</span>:
                <span style="color: #f92672; font-weight: bold;">try</span>:
                    merge_sexp_vect(module, [sexp])
                    print_data_stack(module.vm.ds)
                <span style="color: #f92672; font-weight: bold;">except</span> JOJO_ERROR:
                    <span style="color: #f92672; font-weight: bold;">pass</span>
                <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">SystemExit</span>:
                    sys.<span style="color: #ae81ff;">exit</span>()
                <span style="color: #f92672; font-weight: bold;">except</span>:
                    <span style="color: #fd971f;">error_type</span> = sys.exc_info()[0]
                    <span style="color: #fd971f;">error_name</span> = error_type.<span style="color: #a6e22e;">__name__</span>
                    <span style="color: #fd971f;">error_info</span> = sys.exc_info()[1]
                    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"- error : {}"</span>.<span style="color: #a6e22e;">format</span>(error_name))
                    <span style="color: #f92672; font-weight: bold;">print</span> (<span style="color: #e6db74;">"  info : {}"</span>.<span style="color: #a6e22e;">format</span>(error_info))
                    debug_repl()
                    <span style="color: #f92672; font-weight: bold;">pass</span>
    <span style="color: #f92672; font-weight: bold;">except</span> <span style="color: #66d9ef; font-weight: bold;">KeyboardInterrupt</span>:
        <span style="color: #f92672; font-weight: bold;">return</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org87da58b" class="outline-2">
<h2 id="org87da58b">------</h2>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: xieyuheng</p>
<p class="date">Created: 2017-10-14 Sat 01:31</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
